{"version":3,"sources":["../../../../src/components/CustomSelect/CustomSelect.tsx"],"names":["findIndexAfter","options","startIndex","length","findIndex","option","i","disabled","findIndexBefore","endIndex","result","undefined","warn","checkOptionsValueType","Set","map","item","value","size","CustomSelect","props","React","createRef","keyboardInput","state","selectedOptionIndex","inputValue","filterFn","filter","setState","opened","focusedOptionIndex","isValidIndex","scrollToElement","onOpen","resetKeyboardInput","onClose","select","index","nativeSelectValue","event","Event","bubbles","selectEl","dispatchEvent","close","open","scrollTo","type","nextIndex","beforeIndex","focusOptionByIndex","e","Array","prototype","indexOf","call","currentTarget","parentNode","children","preventDefault","selectFocused","key","fullInput","optionIndex","label","toLowerCase","includes","scrollBoxRef","current","contains","target","newSelectedOptionIndex","findSelectedIndex","isControlledOutside","onChange","onInputChange","process","env","NODE_ENV","areOptionsShown","focusOption","onKeyboardInput","renderOption","hovered","selected","onClick","handleOptionClick","onMouseDown","handleOptionDown","onMouseEnter","handleOptionHover","element","getRef","placement","popperPlacement","defaultValue","initialValue","Number","center","dropdown","dropdownHeight","offsetHeight","scrollTop","itemTop","offsetTop","itemHeight","prevProps","searchable","stateOptions","name","className","getRootRef","popupDirection","sizeY","platform","style","onBlur","onFocus","emptyText","renderDropdown","fetching","restProps","getSelectedItem","defaultDropdownContent","resolvedContent","isPopperDirectionTop","containerRef","onLabelClick","CustomSelect__open","onInputKeyDown","placeholder","handleKeyDownSelect","handleKeyUp","selectRef","onNativeSelectChange","onPlacementChange","resetFocusedOption","Component","defaultFilterFn"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport SelectMimicry from \"../SelectMimicry/SelectMimicry\";\nimport { debounce, setRef, multiRef } from \"../../lib/utils\";\nimport { classNames } from \"../../lib/classNames\";\nimport { NativeSelectProps } from \"../NativeSelect/NativeSelect\";\nimport { withAdaptivity } from \"../../hoc/withAdaptivity\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport CustomSelectOption, {\n  CustomSelectOptionProps,\n} from \"../CustomSelectOption/CustomSelectOption\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { FormFieldProps } from \"../FormField/FormField\";\nimport { HasPlatform } from \"../../types\";\nimport Input from \"../Input/Input\";\nimport { DropdownIcon } from \"../DropdownIcon/DropdownIcon\";\nimport Caption from \"../Typography/Caption/Caption\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { defaultFilterFn } from \"../../lib/select\";\nimport { is } from \"../../lib/is\";\nimport { Placement } from \"../Popper/Popper\";\nimport { CustomSelectDropdown } from \"../CustomSelectDropdown/CustomSelectDropdown\";\nimport \"./CustomSelect.css\";\n\nconst findIndexAfter = (\n  options: CustomSelectOptionInterface[] = [],\n  startIndex = -1\n) => {\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n  return options.findIndex((option, i) => i > startIndex && !option.disabled);\n};\n\nconst findIndexBefore = (\n  options: CustomSelectOptionInterface[] = [],\n  endIndex: number = options.length\n) => {\n  let result = -1;\n  if (options === undefined || endIndex <= 0) {\n    return result;\n  }\n  for (let i = endIndex - 1; i >= 0; i--) {\n    let option = options[i];\n\n    if (!option.disabled) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n};\n\nconst warn = warnOnce(\"CustomSelect\");\n\nconst checkOptionsValueType = (options: CustomSelectOptionInterface[]) => {\n  if (new Set(options.map((item) => typeof item.value)).size > 1) {\n    warn(\n      \"Some values of your options have different types. CustomSelect onChange always returns a string type.\"\n    );\n  }\n};\n\ntype SelectValue = React.SelectHTMLAttributes<HTMLSelectElement>[\"value\"];\n\nexport interface CustomSelectOptionInterface {\n  value: SelectValue;\n  label: string;\n  disabled?: boolean;\n  [index: string]: any;\n}\n\ninterface CustomSelectState {\n  inputValue?: string;\n  opened?: boolean;\n  focusedOptionIndex?: number;\n  selectedOptionIndex?: number;\n  nativeSelectValue?: SelectValue;\n  options?: CustomSelectOptionInterface[];\n  popperPlacement?: Placement;\n}\n\nexport interface CustomSelectProps\n  extends NativeSelectProps,\n    HasPlatform,\n    FormFieldProps {\n  /**\n   * Если `true`, то при клике на селект в нём появится текстовое поле для поиска по `options`. По умолчанию поиск\n   * производится по `option.label`.\n   */\n  searchable?: boolean;\n  /**\n   * Текст, который будет отображен, если приходит пустой `options`\n   */\n  emptyText?: string;\n  onInputChange?: (\n    e: React.ChangeEvent,\n    options: CustomSelectOptionInterface[]\n  ) => void | CustomSelectOptionInterface[];\n  options: Array<{\n    value: SelectValue;\n    label: string;\n    [index: string]: any;\n  }>;\n  /**\n   * Функция для кастомной фильтрации. По-умолчанию поиск производится по option.label.\n   */\n  filterFn?:\n    | false\n    | ((\n        value: string,\n        option: CustomSelectOptionInterface,\n        getOptionLabel?: (\n          option: Partial<CustomSelectOptionInterface>\n        ) => string\n      ) => boolean);\n  popupDirection?: \"top\" | \"bottom\";\n  /**\n   * Рендер-проп для кастомного рендера опции.\n   * В объекте аргумента приходят [свойства опции](#/CustomSelectOption?id=props)\n   */\n  renderOption?: (props: CustomSelectOptionProps) => React.ReactNode;\n  /**\n   * Рендер-проп для кастомного рендера содержимого дропдауна.\n   * В defaultDropdownContent содержится список опций в виде скроллящегося блока.\n   */\n  renderDropdown?: ({\n    defaultDropdownContent,\n  }: {\n    defaultDropdownContent: React.ReactNode;\n  }) => React.ReactNode;\n  /**\n   * Если true, то в дропдауне вместо списка опций рисуется спиннер. При переданных renderDropdown и fetching: true,\n   * \"победит\" renderDropdown\n   */\n  fetching?: boolean;\n  onClose?: VoidFunction;\n  onOpen?: VoidFunction;\n}\n\ntype MouseEventHandler = (event: React.MouseEvent<HTMLElement>) => void;\n\nclass CustomSelect extends React.Component<\n  CustomSelectProps,\n  CustomSelectState\n> {\n  static defaultProps: Partial<CustomSelectProps> = {\n    searchable: false,\n    renderOption({ option, ...props }): React.ReactNode {\n      return <CustomSelectOption {...props} />;\n    },\n    options: [],\n    emptyText: \"Ничего не найдено\",\n    filterFn: defaultFilterFn,\n  };\n\n  public constructor(props: CustomSelectProps) {\n    super(props);\n\n    const { value, defaultValue } = props;\n\n    const initialValue = value !== undefined ? value : defaultValue;\n\n    this.keyboardInput = \"\";\n\n    if (process.env.NODE_ENV === \"development\") {\n      checkOptionsValueType(props.options);\n    }\n\n    this.state = {\n      opened: false,\n      focusedOptionIndex: -1,\n      selectedOptionIndex: this.findSelectedIndex(props.options, initialValue),\n      nativeSelectValue: initialValue,\n      options: props.options,\n      inputValue: \"\",\n    };\n\n    if (props.value !== undefined) {\n      this.isControlledOutside = true;\n    }\n  }\n\n  private keyboardInput: string;\n  private isControlledOutside = false;\n  private selectEl: HTMLSelectElement | null = null;\n  private readonly scrollBoxRef = React.createRef<HTMLDivElement>();\n  private readonly containerRef = React.createRef<HTMLLabelElement>();\n\n  private readonly resetKeyboardInput = () => {\n    this.keyboardInput = \"\";\n  };\n\n  private readonly getSelectedItem = () => {\n    const { selectedOptionIndex, options } = this.state;\n\n    if (!options?.length) {\n      return null;\n    }\n\n    return selectedOptionIndex !== undefined\n      ? options[selectedOptionIndex]\n      : undefined;\n  };\n\n  get areOptionsShown() {\n    return this.scrollBoxRef.current !== null;\n  }\n\n  filter = (\n    options: CustomSelectProps[\"options\"],\n    inputValue: string,\n    filterFn: CustomSelectProps[\"filterFn\"]\n  ) => {\n    return typeof filterFn === \"function\"\n      ? options.filter((option) => filterFn(inputValue, option))\n      : options;\n  };\n\n  findSelectedIndex(\n    options: CustomSelectOptionInterface[] | undefined,\n    value: SelectValue\n  ) {\n    return (\n      options?.findIndex((item) => {\n        value = typeof item.value === \"number\" ? Number(value) : value;\n        return item.value === value;\n      }) ?? -1\n    );\n  }\n\n  open = () => {\n    this.setState(\n      ({ selectedOptionIndex }) => ({\n        opened: true,\n        focusedOptionIndex: selectedOptionIndex,\n      }),\n      () => {\n        const { selectedOptionIndex } = this.state;\n\n        if (\n          selectedOptionIndex !== undefined &&\n          this.isValidIndex(selectedOptionIndex)\n        ) {\n          this.scrollToElement(selectedOptionIndex, true);\n        }\n      }\n    );\n    typeof this.props.onOpen === \"function\" && this.props.onOpen();\n  };\n\n  close = () => {\n    this.resetKeyboardInput();\n\n    this.setState(() => ({\n      inputValue: \"\",\n      opened: false,\n      focusedOptionIndex: -1,\n      options: this.props.options,\n    }));\n    typeof this.props.onClose === \"function\" && this.props.onClose();\n  };\n\n  private isValidIndex(index: number) {\n    return index >= 0 && index < (this.state.options?.length ?? 0);\n  }\n\n  selectFocused = () => {\n    const { focusedOptionIndex } = this.state;\n\n    if (focusedOptionIndex !== undefined) {\n      this.select(focusedOptionIndex);\n    }\n  };\n\n  select = (index: number) => {\n    if (!this.isValidIndex(index)) {\n      return;\n    }\n\n    const item = this.state.options?.[index];\n\n    this.setState(\n      {\n        nativeSelectValue: item?.value,\n      },\n      () => {\n        const event = new Event(\"change\", { bubbles: true });\n        this.selectEl?.dispatchEvent(event);\n      }\n    );\n    this.close();\n  };\n\n  onClick = () => {\n    this.state.opened ? this.close() : this.open();\n  };\n\n  onFocus = () => {\n    const event = new Event(\"focus\");\n    this.selectEl?.dispatchEvent(event);\n  };\n\n  onBlur = () => {\n    this.close();\n    const event = new Event(\"blur\");\n    this.selectEl?.dispatchEvent(event);\n  };\n\n  private scrollToElement(index: number, center = false) {\n    const dropdown = this.scrollBoxRef.current;\n    const item = dropdown ? (dropdown.children[index] as HTMLElement) : null;\n\n    if (!item || !dropdown) {\n      return;\n    }\n\n    const dropdownHeight = dropdown.offsetHeight;\n    const scrollTop = dropdown.scrollTop;\n    const itemTop = item.offsetTop;\n    const itemHeight = item.offsetHeight;\n\n    if (center) {\n      dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n      dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n    } else if (itemTop < scrollTop) {\n      dropdown.scrollTop = itemTop;\n    }\n  }\n\n  focusOptionByIndex = (index: number | undefined, scrollTo = true) => {\n    if (\n      index === undefined ||\n      index < 0 ||\n      index > (this.state.options?.length ?? 0) - 1\n    ) {\n      return;\n    }\n\n    const option = this.state.options?.[index];\n\n    if (option?.disabled) {\n      return;\n    }\n\n    scrollTo && this.scrollToElement(index);\n\n    this.setState(() => ({\n      focusedOptionIndex: index,\n    }));\n  };\n\n  focusOption = (type: \"next\" | \"prev\") => {\n    const { focusedOptionIndex } = this.state;\n    let index = focusedOptionIndex;\n\n    if (type === \"next\") {\n      const nextIndex = findIndexAfter(this.state.options, index);\n      index = nextIndex === -1 ? findIndexAfter(this.state.options) : nextIndex; // Следующий за index или первый валидный до index\n    } else if (type === \"prev\") {\n      const beforeIndex = findIndexBefore(this.state.options, index);\n      index =\n        beforeIndex === -1 ? findIndexBefore(this.state.options) : beforeIndex; // Предшествующий index или последний валидный после index\n    }\n\n    this.focusOptionByIndex(index);\n  };\n\n  handleOptionHover: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n    this.focusOptionByIndex(\n      Array.prototype.indexOf.call(\n        e.currentTarget.parentNode?.children,\n        e.currentTarget\n      ),\n      false\n    );\n  };\n\n  handleOptionDown: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n    e.preventDefault();\n  };\n\n  handleOptionClick: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n    const index = Array.prototype.indexOf.call(\n      e.currentTarget.parentNode?.children,\n      e.currentTarget\n    );\n    const option = this.state.options?.[index];\n\n    if (option && !option.disabled) {\n      this.selectFocused();\n    }\n  };\n\n  resetFocusedOption = () => {\n    this.setState({ focusedOptionIndex: -1 });\n  };\n\n  onKeyboardInput = (key: string) => {\n    const fullInput = this.keyboardInput + key;\n\n    const optionIndex = this.state.options?.findIndex((option) => {\n      return option.label.toLowerCase().includes(fullInput);\n    });\n\n    if (optionIndex !== undefined && optionIndex > -1) {\n      this.focusOptionByIndex(optionIndex);\n    }\n\n    this.keyboardInput = fullInput;\n  };\n\n  /**\n   * Нужен для правильного поведения обработчика onClick на select. Фильтрует клики, которые были сделаны по\n   * выпадающему списку.\n   */\n  onLabelClick = (e: React.MouseEvent<HTMLLabelElement>) => {\n    if (this.scrollBoxRef.current?.contains(e.target as Node)) {\n      e.preventDefault();\n    }\n  };\n\n  onNativeSelectChange: React.ChangeEventHandler<HTMLSelectElement> = (e) => {\n    const newSelectedOptionIndex = this.findSelectedIndex(\n      this.state.options,\n      e.currentTarget.value\n    );\n\n    if (this.state.selectedOptionIndex !== newSelectedOptionIndex) {\n      if (!this.isControlledOutside) {\n        this.setState({\n          selectedOptionIndex: newSelectedOptionIndex,\n        });\n      }\n      this.props.onChange?.(e);\n    }\n  };\n\n  onInputChange: React.ChangeEventHandler<HTMLInputElement> = (e) => {\n    if (this.props.onInputChange) {\n      const options = this.props.onInputChange(e, this.props.options);\n      if (options) {\n        if (process.env.NODE_ENV === \"development\") {\n          warn(\n            \"This filtration method is deprecated. Return value of onInputChange will\" +\n              \" be ignored in v5.0.0. For custom filtration please update props.options by yourself or use filterFn property\"\n          );\n        }\n        this.setState({\n          options,\n          selectedOptionIndex: this.findSelectedIndex(\n            options,\n            this.state.nativeSelectValue\n          ),\n          inputValue: e.target.value,\n        });\n      } else {\n        this.setState({ inputValue: e.target.value });\n      }\n    } else {\n      const options = this.filter(\n        this.props.options,\n        e.target.value,\n        this.props.filterFn\n      );\n      this.setState({\n        options,\n        selectedOptionIndex: this.findSelectedIndex(\n          options,\n          this.state.nativeSelectValue\n        ),\n        inputValue: e.target.value,\n      });\n    }\n  };\n\n  onInputKeyDown: React.KeyboardEventHandler<HTMLInputElement> = (event) => {\n    [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) &&\n      this.areOptionsShown &&\n      event.preventDefault();\n\n    switch (event.key) {\n      case \"ArrowUp\":\n        this.areOptionsShown && this.focusOption(\"prev\");\n        break;\n      case \"ArrowDown\":\n        this.areOptionsShown && this.focusOption(\"next\");\n        break;\n      case \"Escape\":\n        this.close();\n        break;\n      case \"Enter\":\n        this.areOptionsShown && this.selectFocused();\n        break;\n    }\n  };\n\n  handleKeyDownSelect = (event: React.KeyboardEvent) => {\n    const { opened } = this.state;\n\n    if (event.key.length === 1 && event.key !== \" \") {\n      this.onKeyboardInput(event.key);\n      return;\n    }\n\n    [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) &&\n      this.areOptionsShown &&\n      event.preventDefault();\n\n    switch (event.key) {\n      case \"ArrowUp\":\n        if (opened) {\n          this.areOptionsShown && this.focusOption(\"prev\");\n        } else {\n          this.open();\n        }\n        break;\n      case \"ArrowDown\":\n        if (opened) {\n          this.areOptionsShown && this.focusOption(\"next\");\n        } else {\n          this.open();\n        }\n        break;\n      case \"Escape\":\n        this.close();\n        break;\n      case \"Enter\":\n      case \"Spacebar\":\n      case \" \":\n        if (opened) {\n          this.areOptionsShown && this.selectFocused();\n        } else {\n          this.open();\n        }\n        break;\n    }\n  };\n\n  handleKeyUp = debounce(this.resetKeyboardInput, 1000);\n\n  componentDidUpdate(prevProps: CustomSelectProps) {\n    // Внутри useEffect и так is, можно убрать\n    if (\n      !is(prevProps.value, this.props.value) ||\n      prevProps.options !== this.props.options\n    ) {\n      if (process.env.NODE_ENV === \"development\") {\n        checkOptionsValueType(this.props.options);\n      }\n\n      this.isControlledOutside = this.props.value !== undefined;\n      const value =\n        this.props.value === undefined\n          ? this.state.nativeSelectValue\n          : this.props.value;\n      const options =\n        this.props.searchable && this.state.inputValue !== undefined\n          ? this.filter(\n              this.props.options,\n              this.state.inputValue,\n              this.props.filterFn\n            )\n          : this.props.options;\n      this.setState({\n        nativeSelectValue: value,\n        selectedOptionIndex: this.findSelectedIndex(options, value),\n        options,\n      });\n    }\n  }\n\n  renderOption = (option: CustomSelectOptionInterface, index: number) => {\n    const { focusedOptionIndex, selectedOptionIndex } = this.state;\n    const { renderOption } = this.props;\n    const hovered = index === focusedOptionIndex;\n    const selected = index === selectedOptionIndex;\n\n    return (\n      <React.Fragment key={`${option.value}`}>\n        {renderOption!({\n          option,\n          hovered,\n          children: option.label,\n          selected,\n          disabled: option.disabled,\n          onClick: this.handleOptionClick,\n          onMouseDown: this.handleOptionDown,\n          onMouseEnter: this.handleOptionHover,\n        })}\n      </React.Fragment>\n    );\n  };\n\n  selectRef = (element: HTMLSelectElement) => {\n    this.selectEl = element;\n    if (this.props.getRef) {\n      setRef(element, this.props.getRef);\n    }\n  };\n\n  onPlacementChange = (placement?: Placement) => {\n    this.setState(() => ({\n      popperPlacement: placement,\n    }));\n  };\n\n  render() {\n    const { opened, nativeSelectValue, options: stateOptions } = this.state;\n    const {\n      searchable,\n      name,\n      className,\n      getRef,\n      getRootRef,\n      popupDirection,\n      options,\n      sizeY,\n      platform,\n      style,\n      onChange,\n      onBlur,\n      onFocus,\n      onClick,\n      renderOption,\n      children,\n      emptyText,\n      onInputChange,\n      filterFn,\n      renderDropdown,\n      onOpen,\n      onClose,\n      fetching,\n      ...restProps\n    } = this.props;\n    const selected = this.getSelectedItem();\n    const label = selected ? selected.label : undefined;\n\n    const defaultDropdownContent =\n      stateOptions !== undefined && stateOptions.length > 0 ? (\n        stateOptions.map(this.renderOption)\n      ) : (\n        <Caption level=\"1\" weight=\"regular\" vkuiClass=\"CustomSelect__empty\">\n          {this.props.emptyText}\n        </Caption>\n      );\n\n    let resolvedContent;\n\n    if (typeof renderDropdown === \"function\") {\n      resolvedContent = renderDropdown({ defaultDropdownContent });\n    } else {\n      resolvedContent = defaultDropdownContent;\n    }\n\n    const isPopperDirectionTop = this.state.popperPlacement?.includes(\"top\");\n\n    return (\n      <label\n        vkuiClass={getClassName(\"CustomSelect\", platform)}\n        className={className}\n        style={style}\n        ref={multiRef(this.containerRef, getRootRef)}\n        onClick={this.onLabelClick}\n      >\n        {opened && searchable ? (\n          <Input\n            {...restProps}\n            autoFocus\n            onBlur={this.onBlur}\n            vkuiClass={classNames({\n              CustomSelect__open: opened,\n              \"CustomSelect__open--popupDirectionTop\": isPopperDirectionTop,\n            })}\n            value={this.state.inputValue}\n            onKeyDown={this.onInputKeyDown}\n            onChange={this.onInputChange}\n            // TODO Ожидается, что клик поймает нативный select, но его перехвает Input. К сожалению, это приводит конфликтам типизации.\n            // TODO Нужно перестать пытаться превратить CustomSelect в select. Тогда эта проблема уйдёт.\n            // @ts-ignore\n            onClick={onClick}\n            after={<DropdownIcon />}\n            placeholder={restProps.placeholder}\n          />\n        ) : (\n          <SelectMimicry\n            {...restProps}\n            aria-hidden={true}\n            onClick={this.onClick}\n            onKeyDown={this.handleKeyDownSelect}\n            onKeyUp={this.handleKeyUp}\n            onFocus={this.onFocus}\n            onBlur={this.onBlur}\n            vkuiClass={classNames({\n              CustomSelect__open: opened,\n              \"CustomSelect__open--popupDirectionTop\": isPopperDirectionTop,\n            })}\n          >\n            {label}\n          </SelectMimicry>\n        )}\n        <select\n          ref={this.selectRef}\n          name={name}\n          onChange={this.onNativeSelectChange}\n          onBlur={onBlur}\n          onFocus={onFocus}\n          onClick={onClick}\n          value={nativeSelectValue}\n          aria-hidden={true}\n          vkuiClass=\"CustomSelect__control\"\n        >\n          {options.map((item) => (\n            <option key={`${item.value}`} value={item.value} />\n          ))}\n        </select>\n        {opened && (\n          <CustomSelectDropdown\n            targetRef={this.containerRef}\n            placement={popupDirection}\n            scrollBoxRef={this.scrollBoxRef}\n            onPlacementChange={this.onPlacementChange}\n            onMouseLeave={this.resetFocusedOption}\n            fetching={fetching}\n          >\n            {resolvedContent}\n          </CustomSelectDropdown>\n        )}\n      </label>\n    );\n  }\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default withPlatform(\n  withAdaptivity(CustomSelect, {\n    sizeY: true,\n  })\n);\n"],"file":"CustomSelect.js"}