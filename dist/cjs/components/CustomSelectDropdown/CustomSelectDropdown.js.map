{"version":3,"file":"CustomSelectDropdown.js","names":["calcIsTop","placement","includes","getObserverModifier","element","name","enabled","phase","fn","noop","effect","instance","observer","MutationObserver","forceUpdate","observe","childList","subtree","disconnect","CustomSelectDropdown","children","targetRef","scrollBoxRef","forcePlacement","fetching","parentOnPlacementChange","onPlacementChange","offsetDistance","sameWidth","forcePortal","autoHideScrollbar","autoHideScrollbarDelay","observableRefs","restProps","React","useState","isTop","setIsTop","customModifiers","setCustomModifiers","useIsomorphicLayoutEffect","Array","isArray","ref","current","push","useCallback","classNames","startsWith"],"sources":["../../../../src/components/CustomSelectDropdown/CustomSelectDropdown.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Modifier } from \"react-popper\";\nimport { CustomScrollView } from \"../CustomScrollView/CustomScrollView\";\nimport { TrackerOptionsProps } from \"../CustomScrollView/useTrackerVisibility\";\nimport { classNames } from \"../../lib/classNames\";\nimport { Popper, Placement } from \"../Popper/Popper\";\nimport { Spinner } from \"../Spinner/Spinner\";\nimport { HasRef } from \"../../types\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { noop } from \"../../lib/utils\";\nimport \"./CustomSelectDropdown.css\";\n\nexport interface CustomSelectDropdownProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasRef<HTMLDivElement>,\n    TrackerOptionsProps {\n  targetRef: React.RefObject<HTMLElement>;\n  placement?: Placement;\n  forcePlacement?: Placement;\n  scrollBoxRef?: React.RefObject<HTMLDivElement>;\n  observableRefs?:\n    | Array<React.RefObject<HTMLElement>>\n    | React.RefObject<HTMLElement>;\n  fetching?: boolean;\n  offsetDistance?: number;\n  sameWidth?: boolean;\n  forcePortal?: boolean;\n  onPlacementChange?: (placement?: Placement) => void;\n}\n\nconst calcIsTop = (placement?: Placement) => placement?.includes(\"top\");\n\nfunction getObserverModifier<T extends HTMLElement>(\n  element: T\n): Modifier<string> {\n  return {\n    name: \"customSelectChildrenChange\",\n    enabled: true,\n    phase: \"main\",\n    fn: noop,\n    effect: ({ instance }) => {\n      const observer = new MutationObserver(instance.forceUpdate);\n\n      observer.observe(element, {\n        childList: true,\n        subtree: true,\n      });\n\n      return () => {\n        observer.disconnect();\n      };\n    },\n  };\n}\n\nexport const CustomSelectDropdown = ({\n  children,\n  targetRef,\n  scrollBoxRef,\n  placement,\n  forcePlacement,\n  fetching,\n  onPlacementChange: parentOnPlacementChange,\n  offsetDistance = 0,\n  sameWidth = true,\n  forcePortal = true,\n  autoHideScrollbar,\n  autoHideScrollbarDelay,\n  observableRefs,\n  ...restProps\n}: CustomSelectDropdownProps) => {\n  const [isTop, setIsTop] = React.useState(() => calcIsTop(placement));\n  const [customModifiers, setCustomModifiers] = React.useState<\n    Array<Modifier<string>>\n  >([]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!observableRefs) {\n      return;\n    }\n    const customModifiers: Array<Modifier<string>> = [];\n\n    if (Array.isArray(observableRefs)) {\n      for (const ref of observableRefs) {\n        if (ref?.current) {\n          customModifiers.push(getObserverModifier(ref.current));\n        }\n      }\n    } else if (observableRefs.current) {\n      customModifiers.push(getObserverModifier(observableRefs.current));\n    }\n\n    setCustomModifiers(customModifiers);\n  }, [observableRefs]);\n\n  const onPlacementChange = React.useCallback(\n    ({ placement }: { placement?: Placement }) => {\n      setIsTop(calcIsTop(placement));\n      parentOnPlacementChange?.(placement);\n    },\n    [parentOnPlacementChange, setIsTop]\n  );\n\n  return (\n    <Popper\n      targetRef={targetRef}\n      offsetDistance={offsetDistance}\n      sameWidth={sameWidth}\n      onPlacementChange={onPlacementChange}\n      placement={placement}\n      data-test=\"custom-select-dropdown\"\n      vkuiClass={classNames(\n        \"CustomSelectDropdown\",\n        !forcePlacement && offsetDistance === 0 &&\n          (isTop\n            ? \"CustomSelectDropdown--top\"\n            : \"CustomSelectDropdown--bottom\"),\n        sameWidth && \"CustomSelectDropdown--wide\",\n        forcePlacement?.startsWith('top') ? \"CustomSelectDropdown--top\" : \"\",\n        forcePlacement?.startsWith('bottom') ? \"CustomSelectDropdown--bottom\" : \"\",\n      )}\n      forcePortal={forcePortal}\n      customModifiers={customModifiers}\n      {...restProps}\n    >\n      <CustomScrollView\n        boxRef={scrollBoxRef}\n        vkuiClass=\"CustomSelectDropdown__in\"\n        autoHideScrollbar={autoHideScrollbar}\n        autoHideScrollbarDelay={autoHideScrollbarDelay}\n      >\n        {fetching ? (\n          <div vkuiClass=\"CustomSelectDropdown__fetching\">\n            <Spinner size=\"small\" />\n          </div>\n        ) : (\n          children\n        )}\n      </CustomScrollView>\n    </Popper>\n  );\n};\n"],"mappings":";;;;;;;;;;;;;AAAA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAAuC;AAqBvC,IAAMA,SAAS,GAAG,SAAZA,SAAS,CAAIC,SAAqB;EAAA,OAAKA,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEC,QAAQ,CAAC,KAAK,CAAC;AAAA;AAEvE,SAASC,mBAAmB,CAC1BC,OAAU,EACQ;EAClB,OAAO;IACLC,IAAI,EAAE,4BAA4B;IAClCC,OAAO,EAAE,IAAI;IACbC,KAAK,EAAE,MAAM;IACbC,EAAE,EAAEC,WAAI;IACRC,MAAM,EAAE,sBAAkB;MAAA,IAAfC,QAAQ,QAARA,QAAQ;MACjB,IAAMC,QAAQ,GAAG,IAAIC,gBAAgB,CAACF,QAAQ,CAACG,WAAW,CAAC;MAE3DF,QAAQ,CAACG,OAAO,CAACX,OAAO,EAAE;QACxBY,SAAS,EAAE,IAAI;QACfC,OAAO,EAAE;MACX,CAAC,CAAC;MAEF,OAAO,YAAM;QACXL,QAAQ,CAACM,UAAU,EAAE;MACvB,CAAC;IACH;EACF,CAAC;AACH;AAEO,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAoB,QAeA;EAAA,IAd/BC,QAAQ,SAARA,QAAQ;IACRC,SAAS,SAATA,SAAS;IACTC,YAAY,SAAZA,YAAY;IACZrB,SAAS,SAATA,SAAS;IACTsB,cAAc,SAAdA,cAAc;IACdC,QAAQ,SAARA,QAAQ;IACWC,uBAAuB,SAA1CC,iBAAiB;IAAA,6BACjBC,cAAc;IAAdA,cAAc,qCAAG,CAAC;IAAA,wBAClBC,SAAS;IAATA,SAAS,gCAAG,IAAI;IAAA,0BAChBC,WAAW;IAAXA,WAAW,kCAAG,IAAI;IAClBC,iBAAiB,SAAjBA,iBAAiB;IACjBC,sBAAsB,SAAtBA,sBAAsB;IACtBC,cAAc,SAAdA,cAAc;IACXC,SAAS;EAEZ,sBAA0BC,KAAK,CAACC,QAAQ,CAAC;MAAA,OAAMnC,SAAS,CAACC,SAAS,CAAC;IAAA,EAAC;IAAA;IAA7DmC,KAAK;IAAEC,QAAQ;EACtB,uBAA8CH,KAAK,CAACC,QAAQ,CAE1D,EAAE,CAAC;IAAA;IAFEG,eAAe;IAAEC,kBAAkB;EAI1C,IAAAC,oDAAyB,EAAC,YAAM;IAC9B,IAAI,CAACR,cAAc,EAAE;MACnB;IACF;IACA,IAAMM,eAAwC,GAAG,EAAE;IAEnD,IAAIG,KAAK,CAACC,OAAO,CAACV,cAAc,CAAC,EAAE;MAAA,yDACfA,cAAc;QAAA;MAAA;QAAhC,oDAAkC;UAAA,IAAvBW,GAAG;UACZ,IAAIA,GAAG,aAAHA,GAAG,eAAHA,GAAG,CAAEC,OAAO,EAAE;YAChBN,eAAe,CAACO,IAAI,CAAC1C,mBAAmB,CAACwC,GAAG,CAACC,OAAO,CAAC,CAAC;UACxD;QACF;MAAC;QAAA;MAAA;QAAA;MAAA;IACH,CAAC,MAAM,IAAIZ,cAAc,CAACY,OAAO,EAAE;MACjCN,eAAe,CAACO,IAAI,CAAC1C,mBAAmB,CAAC6B,cAAc,CAACY,OAAO,CAAC,CAAC;IACnE;IAEAL,kBAAkB,CAACD,eAAe,CAAC;EACrC,CAAC,EAAE,CAACN,cAAc,CAAC,CAAC;EAEpB,IAAMN,iBAAiB,GAAGQ,KAAK,CAACY,WAAW,CACzC,iBAA8C;IAAA,IAA3C7C,SAAS,SAATA,SAAS;IACVoC,QAAQ,CAACrC,SAAS,CAACC,SAAS,CAAC,CAAC;IAC9BwB,uBAAuB,aAAvBA,uBAAuB,uBAAvBA,uBAAuB,CAAGxB,SAAS,CAAC;EACtC,CAAC,EACD,CAACwB,uBAAuB,EAAEY,QAAQ,CAAC,CACpC;EAED,OACE,qCAAC,cAAM;IACL,SAAS,EAAEhB,SAAU;IACrB,cAAc,EAAEM,cAAe;IAC/B,SAAS,EAAEC,SAAU;IACrB,iBAAiB,EAAEF,iBAAkB;IACrC,SAAS,EAAEzB,SAAU;IACrB,aAAU,wBAAwB;IAClC,SAAS,EAAE,IAAA8C,sBAAU,EACnB,sBAAsB,EACtB,CAACxB,cAAc,IAAII,cAAc,KAAK,CAAC,KACpCS,KAAK,GACF,2BAA2B,GAC3B,8BAA8B,CAAC,EACrCR,SAAS,IAAI,4BAA4B,EACzCL,cAAc,aAAdA,cAAc,eAAdA,cAAc,CAAEyB,UAAU,CAAC,KAAK,CAAC,GAAG,2BAA2B,GAAG,EAAE,EACpEzB,cAAc,aAAdA,cAAc,eAAdA,cAAc,CAAEyB,UAAU,CAAC,QAAQ,CAAC,GAAG,8BAA8B,GAAG,EAAE,CAC1E;IACF,WAAW,EAAEnB,WAAY;IACzB,eAAe,EAAES;EAAgB,GAC7BL,SAAS,GAEb,qCAAC,kCAAgB;IACf,MAAM,EAAEX,YAAa;IACrB,SAAS,EAAC,0BAA0B;IACpC,iBAAiB,EAAEQ,iBAAkB;IACrC,sBAAsB,EAAEC;EAAuB,GAE9CP,QAAQ,GACP;IAAK,SAAS,EAAC;EAAgC,GAC7C,qCAAC,gBAAO;IAAC,IAAI,EAAC;EAAO,EAAG,CACpB,GAENJ,QACD,CACgB,CACZ;AAEb,CAAC;AAAC"}