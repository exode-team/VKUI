{"version":3,"sources":["../../../../src/components/Gallery/Gallery.tsx"],"names":["Gallery","initialSlideIndex","children","timeout","onChange","bullets","props","React","useState","localSlideIndex","setSlideIndex","isControlled","slideIndex","isDraggable","Boolean","slides","useMemo","Children","toArray","filter","item","childCount","length","handleChange","useCallback","current","autoplay","useEffect","set","clear","safeSlideIndex"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAQA;AACA;AACA;AACO,IAAMA,OAAO,GAAG,SAAVA,OAAU,OAOH;AAAA;;AAAA,mCANlBC,iBAMkB;AAAA,MANlBA,iBAMkB,sCANE,CAMF;AAAA,MALlBC,QAKkB,QALlBA,QAKkB;AAAA,0BAJlBC,OAIkB;AAAA,MAJlBA,OAIkB,6BAJR,CAIQ;AAAA,MAHlBC,QAGkB,QAHlBA,QAGkB;AAAA,MAFlBC,OAEkB,QAFlBA,OAEkB;AAAA,MADfC,KACe;;AAClB,wBAAyCC,KAAK,CAACC,QAAN,CAAeP,iBAAf,CAAzC;AAAA;AAAA,MAAOQ,eAAP;AAAA,MAAwBC,aAAxB;;AACA,MAAMC,YAAY,GAAG,OAAOL,KAAK,CAACM,UAAb,KAA4B,QAAjD;AACA,MAAMA,UAAU,GAAGD,YAAY,wBAAGL,KAAK,CAACM,UAAT,iEAAuB,CAAvB,GAA2BH,eAA1D;AACA,MAAMI,WAAW,GAAG,CAACF,YAAD,IAAiBG,OAAO,CAACV,QAAD,CAA5C;AACA,MAAMW,MAAM,GAAGR,KAAK,CAACS,OAAN,CACb;AAAA,WAAMT,KAAK,CAACU,QAAN,CAAeC,OAAf,CAAuBhB,QAAvB,EAAiCiB,MAAjC,CAAwC,UAACC,IAAD;AAAA,aAAUN,OAAO,CAACM,IAAD,CAAjB;AAAA,KAAxC,CAAN;AAAA,GADa,EAEb,CAAClB,QAAD,CAFa,CAAf;AAIA,MAAMmB,UAAU,GAAGN,MAAM,CAACO,MAA1B;AAEA,MAAMC,YAAsC,GAAGhB,KAAK,CAACiB,WAAN,CAC7C,UAACC,OAAD,EAAa;AACX,QAAIA,OAAO,KAAKb,UAAhB,EAA4B;AAC1B;AACD;;AACD,KAACD,YAAD,IAAiBD,aAAa,CAACe,OAAD,CAA9B;AACArB,IAAAA,QAAQ,IAAIA,QAAQ,CAACqB,OAAD,CAApB;AACD,GAP4C,EAQ7C,CAACd,YAAD,EAAeP,QAAf,EAAyBQ,UAAzB,CAR6C,CAA/C;AAWA,MAAMc,QAAQ,GAAG,4BACf;AAAA,WAAMH,YAAY,CAAC,CAACX,UAAU,GAAG,CAAd,IAAmBS,UAApB,CAAlB;AAAA,GADe,EAEflB,OAFe,CAAjB;AAIAI,EAAAA,KAAK,CAACoB,SAAN,CACE;AAAA,WAAOxB,OAAO,GAAGuB,QAAQ,CAACE,GAAT,EAAH,GAAoBF,QAAQ,CAACG,KAAT,EAAlC;AAAA,GADF,EAEE,CAAC1B,OAAD,EAAUS,UAAV,EAAsBc,QAAtB,CAFF,EA1BkB,CA+BlB;AACA;;AACA,MAAMI,cAAc,GAClBT,UAAU,GAAG,CAAb,GAAiB,iBAAMT,UAAN,EAAkB,CAAlB,EAAqBS,UAAU,GAAG,CAAlC,CAAjB,GAAwDT,UAD1D,CAjCkB,CAmClB;;AACAL,EAAAA,KAAK,CAACoB,SAAN,CAAgB,YAAM;AACpB,QAAIvB,QAAQ,IAAI0B,cAAc,KAAKlB,UAAnC,EAA+C;AAC7CR,MAAAA,QAAQ,CAAC0B,cAAD,CAAR;AACD;AACF,GAJD,EAIG,CAAC1B,QAAD,EAAW0B,cAAX,EAA2BlB,UAA3B,CAJH;AAMA,SACE,qCAAC,wBAAD;AACE,IAAA,WAAW,EAAEC;AADf,KAEMP,KAFN;AAGE,IAAA,OAAO,EAAEe,UAAU,GAAG,CAAb,IAAkBhB,OAH7B;AAIE,IAAA,UAAU,EAAEyB,cAJd;AAKE,IAAA,QAAQ,EAAEP;AALZ,MAOGR,MAPH,CADF;AAWD,CA5DM","sourcesContent":["import * as React from \"react\";\nimport { clamp } from \"../../helpers/math\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { BaseGallery } from \"../BaseGallery/BaseGallery\";\nimport { BaseGalleryProps } from \"../BaseGallery/types\";\n\nexport interface GalleryProps extends BaseGalleryProps {\n  initialSlideIndex?: number;\n  timeout?: number;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Gallery\n */\nexport const Gallery = ({\n  initialSlideIndex = 0,\n  children,\n  timeout = 0,\n  onChange,\n  bullets,\n  ...props\n}: GalleryProps) => {\n  const [localSlideIndex, setSlideIndex] = React.useState(initialSlideIndex);\n  const isControlled = typeof props.slideIndex === \"number\";\n  const slideIndex = isControlled ? props.slideIndex ?? 0 : localSlideIndex;\n  const isDraggable = !isControlled || Boolean(onChange);\n  const slides = React.useMemo(\n    () => React.Children.toArray(children).filter((item) => Boolean(item)),\n    [children]\n  );\n  const childCount = slides.length;\n\n  const handleChange: GalleryProps[\"onChange\"] = React.useCallback(\n    (current) => {\n      if (current === slideIndex) {\n        return;\n      }\n      !isControlled && setSlideIndex(current);\n      onChange && onChange(current);\n    },\n    [isControlled, onChange, slideIndex]\n  );\n\n  const autoplay = useTimeout(\n    () => handleChange((slideIndex + 1) % childCount),\n    timeout\n  );\n  React.useEffect(\n    () => (timeout ? autoplay.set() : autoplay.clear()),\n    [timeout, slideIndex, autoplay]\n  );\n\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  const safeSlideIndex =\n    childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(() => {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n  }, [onChange, safeSlideIndex, slideIndex]);\n\n  return (\n    <BaseGallery\n      isDraggable={isDraggable}\n      {...props}\n      bullets={childCount > 0 && bullets}\n      slideIndex={safeSlideIndex}\n      onChange={handleChange}\n    >\n      {slides}\n    </BaseGallery>\n  );\n};\n"],"file":"Gallery.js"}