{"version":3,"file":"AdaptivityProvider.js","names":["DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","React","useRef","useState","updateAdaptivity","bridge","useBridgeAdaptivity","useDOM","window","current","calculateAdaptivity","useEffect","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","hasMouse","deviceHasHover","addEventListener","removeEventListener","children","windowWidth","windowHeight","type","viewportWidth","viewportHeight","innerWidth","innerHeight","ViewWidth","SMALL_MOBILE","ViewHeight","SMALL","SizeType","REGULAR","_hasMouse","_hasHover","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"sources":["../../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { hasMouse as _hasMouse, hasHover as _hasHover } from \"@vkontakte/vkjs\";\nimport {\n  AdaptivityContext,\n  AdaptivityProps,\n  SizeType,\n  ViewHeight,\n  ViewWidth,\n} from \"./AdaptivityContext\";\nimport { useDOM } from \"../../lib/dom\";\nimport {\n  useBridgeAdaptivity,\n  BridgeAdaptivity,\n} from \"../../hooks/useBridgeAdaptivity\";\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\nexport interface AdaptivityProviderProps extends AdaptivityProps {\n  children?: React.ReactNode;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AdaptivityProvider\n */\nexport const AdaptivityProvider = (props: AdaptivityProviderProps) => {\n  const adaptivityRef = React.useRef<ReturnType<\n    typeof calculateAdaptivity\n  > | null>(null);\n  const [, updateAdaptivity] = React.useState({});\n  const bridge = useBridgeAdaptivity();\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(props, bridge, window);\n  }\n\n  React.useEffect(() => {\n    function onResize() {\n      if (adaptivityRef.current === null) {\n        return;\n      }\n\n      const calculated = calculateAdaptivity(props, bridge, window);\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover } =\n        adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse ||\n        deviceHasHover !== calculated.deviceHasHover\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window!.addEventListener(\"resize\", onResize, false);\n\n    return () => {\n      window!.removeEventListener(\"resize\", onResize, false);\n    };\n  }, [\n    props.viewWidth,\n    props.viewHeight,\n    props.sizeX,\n    props.sizeY,\n    props.hasMouse,\n    props.deviceHasHover,\n    window,\n    props,\n    bridge,\n  ]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n};\n\nfunction calculateAdaptivity(\n  props: AdaptivityProps,\n  bridge: BridgeAdaptivity,\n  window?: Window\n) {\n  let windowWidth = 0;\n  let windowHeight = 0;\n\n  if (bridge.type === \"adaptive\") {\n    windowWidth = bridge.viewportWidth;\n    windowHeight = bridge.viewportHeight;\n  } else if (window) {\n    windowWidth = window.innerWidth;\n    windowHeight = window.innerHeight;\n  }\n\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = _hasMouse;\n  let deviceHasHover = _hasHover;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  if (!bridge.type) {\n    props.viewWidth && (viewWidth = props.viewWidth);\n    props.viewHeight && (viewHeight = props.viewHeight);\n\n    hasMouse = props.hasMouse ?? hasMouse;\n    deviceHasHover = props.deviceHasHover ?? deviceHasHover;\n  }\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (\n    (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse) ||\n    viewHeight <= ViewHeight.EXTRA_SMALL\n  ) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  if (!bridge.type) {\n    props.sizeX && (sizeX = props.sizeX);\n    props.sizeY && (sizeY = props.sizeY);\n  }\n\n  if (\n    bridge.type === \"force_mobile\" ||\n    bridge.type === \"force_mobile_compact\"\n  ) {\n    viewWidth = ViewWidth.MOBILE;\n    sizeX = SizeType.COMPACT;\n\n    if (bridge.type === \"force_mobile_compact\") {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  }\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover };\n}\n"],"mappings":"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"}