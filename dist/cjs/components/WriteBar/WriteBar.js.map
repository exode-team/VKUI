{"version":3,"sources":["../../../../src/components/WriteBar/WriteBar.tsx"],"names":["WriteBar","className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange","shadow","restProps","platform","isControlledOutside","textareaRef","currentScrollHeight","React","useRef","resize","useCallback","textareaEl","current","offsetParent","height","scrollHeight","onTextareaChange","event","useEffect","IOS"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Headline } from \"../Typography/Headline/Headline\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { hasReactNode, isFunction } from \"../../lib/utils\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS } from \"../../lib/platform\";\nimport { HasRef, HasRootRef } from \"../../types\";\nimport \"./WriteBar.css\";\n\nexport interface WriteBarProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слева от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n  /**\n   * Добавляет тень вокруг поля ввода\n   */\n  shadow?: boolean;\n\n  children?: never;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport const WriteBar = ({\n  className,\n  style,\n  before,\n  inlineAfter,\n  after,\n  value,\n  onChange,\n  getRootRef,\n  getRef,\n  onHeightChange,\n  shadow = false,\n  ...restProps\n}: WriteBarProps) => {\n  const platform = usePlatform();\n\n  const isControlledOutside = value != null;\n\n  const textareaRef = useExternRef(getRef);\n  const currentScrollHeight = React.useRef<number>();\n\n  const resize = React.useCallback(() => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = \"\";\n      textareaEl.style.height = `${textareaEl.scrollHeight}px`;\n\n      if (\n        textareaEl.scrollHeight !== currentScrollHeight.current &&\n        onHeightChange\n      ) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n\n  const onTextareaChange: React.ChangeEventHandler<HTMLTextAreaElement> = (\n    event\n  ) => {\n    if (isFunction(onChange)) {\n      onChange(event);\n    }\n\n    if (!isControlledOutside) {\n      resize();\n    }\n  };\n\n  React.useEffect(() => {\n    resize();\n  }, [resize, value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      vkuiClass={classNames(\n        \"WriteBar\",\n        platform === IOS && \"WriteBar--ios\",\n        shadow && \"WriteBar--shadow\"\n      )}\n      className={className}\n      style={style}\n    >\n      <div vkuiClass=\"WriteBar__form\">\n        {hasReactNode(before) && (\n          <div vkuiClass=\"WriteBar__before\">{before}</div>\n        )}\n\n        <div vkuiClass=\"WriteBar__formIn\">\n          <Headline\n            {...restProps}\n            Component=\"textarea\"\n            vkuiClass=\"WriteBar__textarea\"\n            onChange={onTextareaChange}\n            getRootRef={textareaRef}\n            value={value}\n          />\n          {hasReactNode(inlineAfter) && (\n            <div vkuiClass=\"WriteBar__inlineAfter\">{inlineAfter}</div>\n          )}\n        </div>\n\n        {hasReactNode(after) && <div vkuiClass=\"WriteBar__after\">{after}</div>}\n      </div>\n    </div>\n  );\n};\n"],"file":"WriteBar.js"}