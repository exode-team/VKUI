{"version":3,"file":"CustomScrollView.js","names":["CustomScrollView","className","children","externalBoxRef","boxRef","windowResize","autoHideScrollbar","autoHideScrollbarDelay","useDOM","document","window","ratio","React","useRef","NaN","lastTrackerTop","clientHeight","trackerHeight","scrollHeight","transformProp","startY","trackerTop","useExternRef","barY","trackerY","setTrackerPosition","scrollTop","current","style","setTrackerPositionFromScroll","progress","resize","localClientHeight","localScrollHeight","localRatio","localTrackerHeight","Math","max","display","height","resizeHandler","useEventListener","useIsomorphicLayoutEffect","add","prop","undefined","setScrollPositionFromTracker","onMove","e","preventDefault","diff","clientY","position","min","useTrackerVisibility","trackerVisible","onTargetScroll","onTrackerDragStart","onTrackerDragStop","onTrackerMouseEnter","onTrackerMouseLeave","onUp","unsubscribe","scroll","listeners","subscribe","el","forEach","l","remove","onDragStart","stopPropagation","classNames"],"sources":["../../../../src/components/CustomScrollView/CustomScrollView.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { DOMProps, useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEventListener } from \"../../hooks/useEventListener\";\nimport {\n  TrackerOptionsProps,\n  useTrackerVisibility,\n} from \"./useTrackerVisibility\";\nimport { stopPropagation } from \"../../lib/utils\";\nimport \"./CustomScrollView.css\";\n\nexport interface CustomScrollViewProps extends DOMProps, TrackerOptionsProps {\n  windowResize?: boolean;\n  boxRef?: React.Ref<HTMLDivElement>;\n  className?: HTMLDivElement[\"className\"];\n  children: React.ReactNode;\n}\n\nexport const CustomScrollView = ({\n  className,\n  children,\n  boxRef: externalBoxRef,\n  windowResize,\n  autoHideScrollbar = false,\n  autoHideScrollbarDelay,\n}: CustomScrollViewProps) => {\n  const { document, window } = useDOM();\n\n  const ratio = React.useRef(NaN);\n  const lastTrackerTop = React.useRef(0);\n  const clientHeight = React.useRef(0);\n  const trackerHeight = React.useRef(0);\n  const scrollHeight = React.useRef(0);\n  const transformProp = React.useRef(\"\");\n  const startY = React.useRef(0);\n  const trackerTop = React.useRef(0);\n\n  const boxRef = useExternRef(externalBoxRef);\n\n  const barY = React.useRef<HTMLDivElement>(null);\n  const trackerY = React.useRef<HTMLDivElement>(null);\n\n  const setTrackerPosition = (scrollTop: number) => {\n    lastTrackerTop.current = scrollTop;\n    if (trackerY.current !== null) {\n      (trackerY.current.style as any)[\n        transformProp.current\n      ] = `translate(0, ${scrollTop}px)`;\n    }\n  };\n\n  const setTrackerPositionFromScroll = (scrollTop: number) => {\n    const progress = scrollTop / (scrollHeight.current - clientHeight.current);\n    setTrackerPosition(\n      (clientHeight.current - trackerHeight.current) * progress\n    );\n  };\n\n  const resize = () => {\n    if (!boxRef.current || !barY.current || !trackerY.current) {\n      return;\n    }\n    const localClientHeight = boxRef.current.clientHeight;\n    const localScrollHeight = boxRef.current.scrollHeight;\n    const localRatio = localClientHeight / localScrollHeight;\n    const localTrackerHeight = Math.max(localClientHeight * localRatio, 40);\n\n    ratio.current = localRatio;\n    clientHeight.current = localClientHeight;\n    scrollHeight.current = localScrollHeight;\n    trackerHeight.current = localTrackerHeight;\n\n    if (localRatio >= 1) {\n      barY.current.style.display = \"none\";\n    } else {\n      barY.current.style.display = \"\";\n      trackerY.current.style.height = `${localTrackerHeight}px`;\n      setTrackerPositionFromScroll(boxRef.current.scrollTop);\n    }\n  };\n\n  const resizeHandler = useEventListener(\"resize\", resize);\n\n  useIsomorphicLayoutEffect(() => {\n    if (windowResize && window) {\n      resizeHandler.add(window);\n    }\n  }, [windowResize, window]);\n\n  useIsomorphicLayoutEffect(() => {\n    let style = trackerY.current?.style;\n    let prop = \"\";\n    if (style !== undefined) {\n      if (\"transform\" in style) {\n        prop = \"transform\";\n      } else if (\"webkitTransform\" in style) {\n        prop = \"webkitTransform\";\n      }\n    }\n    transformProp.current = prop;\n  }, []);\n\n  useIsomorphicLayoutEffect(resize);\n\n  const setScrollPositionFromTracker = (trackerTop: number) => {\n    const progress =\n      trackerTop / (clientHeight.current - trackerHeight.current);\n    if (boxRef.current !== null) {\n      boxRef.current.scrollTop =\n        (scrollHeight.current - clientHeight.current) * progress;\n    }\n  };\n\n  const onMove = (e: MouseEvent) => {\n    e.preventDefault();\n    const diff = e.clientY - startY.current;\n    const position = Math.min(\n      Math.max(trackerTop.current + diff, 0),\n      clientHeight.current - trackerHeight.current\n    );\n\n    setScrollPositionFromTracker(position);\n  };\n\n  const {\n    trackerVisible,\n    onTargetScroll,\n    onTrackerDragStart,\n    onTrackerDragStop,\n    onTrackerMouseEnter,\n    onTrackerMouseLeave,\n  } = useTrackerVisibility(autoHideScrollbar, autoHideScrollbarDelay);\n\n  const onUp = (e: MouseEvent) => {\n    e.preventDefault();\n\n    if (autoHideScrollbar) {\n      onTrackerDragStop();\n    }\n\n    unsubscribe();\n  };\n\n  const scroll = () => {\n    if (ratio.current >= 1 || !boxRef.current) {\n      return;\n    }\n\n    if (autoHideScrollbar) {\n      onTargetScroll();\n    }\n\n    setTrackerPositionFromScroll(boxRef.current.scrollTop);\n  };\n\n  const listeners = [\n    useEventListener(\"mousemove\", onMove),\n    useEventListener(\"mouseup\", onUp),\n  ];\n\n  function subscribe(el: Document | undefined) {\n    if (el) {\n      listeners.forEach((l) => l.add(el));\n    }\n  }\n\n  function unsubscribe() {\n    listeners.forEach((l) => l.remove());\n  }\n\n  const onDragStart = (e: React.MouseEvent) => {\n    e.preventDefault();\n    startY.current = e.clientY;\n    trackerTop.current = lastTrackerTop.current;\n\n    if (autoHideScrollbar) {\n      onTrackerDragStart();\n    }\n\n    subscribe(document);\n  };\n\n  return (\n    <div vkuiClass=\"CustomScrollView\" className={className}>\n      <div\n        vkuiClass=\"CustomScrollView__barY\"\n        ref={barY}\n        onClick={stopPropagation}\n      >\n        <div\n          vkuiClass={classNames(\n            \"CustomScrollView__trackerY\",\n            !trackerVisible && `CustomScrollView__trackerY--hidden`\n          )}\n          onMouseEnter={autoHideScrollbar ? onTrackerMouseEnter : undefined}\n          onMouseLeave={autoHideScrollbar ? onTrackerMouseLeave : undefined}\n          ref={trackerY}\n          onMouseDown={onDragStart}\n        />\n      </div>\n\n      <div\n        vkuiClass=\"CustomScrollView__box\"\n        tabIndex={-1}\n        ref={boxRef}\n        onScroll={scroll}\n      >\n        {children}\n      </div>\n    </div>\n  );\n};\n"],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAUO,IAAMA,gBAAgB,GAAG,SAAnBA,gBAAgB,OAOA;EAAA,IAN3BC,SAAS,QAATA,SAAS;IACTC,QAAQ,QAARA,QAAQ;IACAC,cAAc,QAAtBC,MAAM;IACNC,YAAY,QAAZA,YAAY;IAAA,6BACZC,iBAAiB;IAAjBA,iBAAiB,sCAAG,KAAK;IACzBC,sBAAsB,QAAtBA,sBAAsB;EAEtB,cAA6B,IAAAC,WAAM,GAAE;IAA7BC,QAAQ,WAARA,QAAQ;IAAEC,MAAM,WAANA,MAAM;EAExB,IAAMC,KAAK,GAAGC,KAAK,CAACC,MAAM,CAACC,GAAG,CAAC;EAC/B,IAAMC,cAAc,GAAGH,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC;EACtC,IAAMG,YAAY,GAAGJ,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC;EACpC,IAAMI,aAAa,GAAGL,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC;EACrC,IAAMK,YAAY,GAAGN,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC;EACpC,IAAMM,aAAa,GAAGP,KAAK,CAACC,MAAM,CAAC,EAAE,CAAC;EACtC,IAAMO,MAAM,GAAGR,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC;EAC9B,IAAMQ,UAAU,GAAGT,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC;EAElC,IAAMT,MAAM,GAAG,IAAAkB,0BAAY,EAACnB,cAAc,CAAC;EAE3C,IAAMoB,IAAI,GAAGX,KAAK,CAACC,MAAM,CAAiB,IAAI,CAAC;EAC/C,IAAMW,QAAQ,GAAGZ,KAAK,CAACC,MAAM,CAAiB,IAAI,CAAC;EAEnD,IAAMY,kBAAkB,GAAG,SAArBA,kBAAkB,CAAIC,SAAiB,EAAK;IAChDX,cAAc,CAACY,OAAO,GAAGD,SAAS;IAClC,IAAIF,QAAQ,CAACG,OAAO,KAAK,IAAI,EAAE;MAC5BH,QAAQ,CAACG,OAAO,CAACC,KAAK,CACrBT,aAAa,CAACQ,OAAO,CACtB,0BAAmBD,SAAS,QAAK;IACpC;EACF,CAAC;EAED,IAAMG,4BAA4B,GAAG,SAA/BA,4BAA4B,CAAIH,SAAiB,EAAK;IAC1D,IAAMI,QAAQ,GAAGJ,SAAS,IAAIR,YAAY,CAACS,OAAO,GAAGX,YAAY,CAACW,OAAO,CAAC;IAC1EF,kBAAkB,CAChB,CAACT,YAAY,CAACW,OAAO,GAAGV,aAAa,CAACU,OAAO,IAAIG,QAAQ,CAC1D;EACH,CAAC;EAED,IAAMC,MAAM,GAAG,SAATA,MAAM,GAAS;IACnB,IAAI,CAAC3B,MAAM,CAACuB,OAAO,IAAI,CAACJ,IAAI,CAACI,OAAO,IAAI,CAACH,QAAQ,CAACG,OAAO,EAAE;MACzD;IACF;IACA,IAAMK,iBAAiB,GAAG5B,MAAM,CAACuB,OAAO,CAACX,YAAY;IACrD,IAAMiB,iBAAiB,GAAG7B,MAAM,CAACuB,OAAO,CAACT,YAAY;IACrD,IAAMgB,UAAU,GAAGF,iBAAiB,GAAGC,iBAAiB;IACxD,IAAME,kBAAkB,GAAGC,IAAI,CAACC,GAAG,CAACL,iBAAiB,GAAGE,UAAU,EAAE,EAAE,CAAC;IAEvEvB,KAAK,CAACgB,OAAO,GAAGO,UAAU;IAC1BlB,YAAY,CAACW,OAAO,GAAGK,iBAAiB;IACxCd,YAAY,CAACS,OAAO,GAAGM,iBAAiB;IACxChB,aAAa,CAACU,OAAO,GAAGQ,kBAAkB;IAE1C,IAAID,UAAU,IAAI,CAAC,EAAE;MACnBX,IAAI,CAACI,OAAO,CAACC,KAAK,CAACU,OAAO,GAAG,MAAM;IACrC,CAAC,MAAM;MACLf,IAAI,CAACI,OAAO,CAACC,KAAK,CAACU,OAAO,GAAG,EAAE;MAC/Bd,QAAQ,CAACG,OAAO,CAACC,KAAK,CAACW,MAAM,aAAMJ,kBAAkB,OAAI;MACzDN,4BAA4B,CAACzB,MAAM,CAACuB,OAAO,CAACD,SAAS,CAAC;IACxD;EACF,CAAC;EAED,IAAMc,aAAa,GAAG,IAAAC,kCAAgB,EAAC,QAAQ,EAAEV,MAAM,CAAC;EAExD,IAAAW,oDAAyB,EAAC,YAAM;IAC9B,IAAIrC,YAAY,IAAIK,MAAM,EAAE;MAC1B8B,aAAa,CAACG,GAAG,CAACjC,MAAM,CAAC;IAC3B;EACF,CAAC,EAAE,CAACL,YAAY,EAAEK,MAAM,CAAC,CAAC;EAE1B,IAAAgC,oDAAyB,EAAC,YAAM;IAAA;IAC9B,IAAId,KAAK,wBAAGJ,QAAQ,CAACG,OAAO,sDAAhB,kBAAkBC,KAAK;IACnC,IAAIgB,IAAI,GAAG,EAAE;IACb,IAAIhB,KAAK,KAAKiB,SAAS,EAAE;MACvB,IAAI,WAAW,IAAIjB,KAAK,EAAE;QACxBgB,IAAI,GAAG,WAAW;MACpB,CAAC,MAAM,IAAI,iBAAiB,IAAIhB,KAAK,EAAE;QACrCgB,IAAI,GAAG,iBAAiB;MAC1B;IACF;IACAzB,aAAa,CAACQ,OAAO,GAAGiB,IAAI;EAC9B,CAAC,EAAE,EAAE,CAAC;EAEN,IAAAF,oDAAyB,EAACX,MAAM,CAAC;EAEjC,IAAMe,4BAA4B,GAAG,SAA/BA,4BAA4B,CAAIzB,UAAkB,EAAK;IAC3D,IAAMS,QAAQ,GACZT,UAAU,IAAIL,YAAY,CAACW,OAAO,GAAGV,aAAa,CAACU,OAAO,CAAC;IAC7D,IAAIvB,MAAM,CAACuB,OAAO,KAAK,IAAI,EAAE;MAC3BvB,MAAM,CAACuB,OAAO,CAACD,SAAS,GACtB,CAACR,YAAY,CAACS,OAAO,GAAGX,YAAY,CAACW,OAAO,IAAIG,QAAQ;IAC5D;EACF,CAAC;EAED,IAAMiB,MAAM,GAAG,SAATA,MAAM,CAAIC,CAAa,EAAK;IAChCA,CAAC,CAACC,cAAc,EAAE;IAClB,IAAMC,IAAI,GAAGF,CAAC,CAACG,OAAO,GAAG/B,MAAM,CAACO,OAAO;IACvC,IAAMyB,QAAQ,GAAGhB,IAAI,CAACiB,GAAG,CACvBjB,IAAI,CAACC,GAAG,CAAChB,UAAU,CAACM,OAAO,GAAGuB,IAAI,EAAE,CAAC,CAAC,EACtClC,YAAY,CAACW,OAAO,GAAGV,aAAa,CAACU,OAAO,CAC7C;IAEDmB,4BAA4B,CAACM,QAAQ,CAAC;EACxC,CAAC;EAED,4BAOI,IAAAE,2CAAoB,EAAChD,iBAAiB,EAAEC,sBAAsB,CAAC;IANjEgD,cAAc,yBAAdA,cAAc;IACdC,cAAc,yBAAdA,cAAc;IACdC,kBAAkB,yBAAlBA,kBAAkB;IAClBC,iBAAiB,yBAAjBA,iBAAiB;IACjBC,mBAAmB,yBAAnBA,mBAAmB;IACnBC,mBAAmB,yBAAnBA,mBAAmB;EAGrB,IAAMC,IAAI,GAAG,SAAPA,IAAI,CAAIb,CAAa,EAAK;IAC9BA,CAAC,CAACC,cAAc,EAAE;IAElB,IAAI3C,iBAAiB,EAAE;MACrBoD,iBAAiB,EAAE;IACrB;IAEAI,WAAW,EAAE;EACf,CAAC;EAED,IAAMC,MAAM,GAAG,SAATA,MAAM,GAAS;IACnB,IAAIpD,KAAK,CAACgB,OAAO,IAAI,CAAC,IAAI,CAACvB,MAAM,CAACuB,OAAO,EAAE;MACzC;IACF;IAEA,IAAIrB,iBAAiB,EAAE;MACrBkD,cAAc,EAAE;IAClB;IAEA3B,4BAA4B,CAACzB,MAAM,CAACuB,OAAO,CAACD,SAAS,CAAC;EACxD,CAAC;EAED,IAAMsC,SAAS,GAAG,CAChB,IAAAvB,kCAAgB,EAAC,WAAW,EAAEM,MAAM,CAAC,EACrC,IAAAN,kCAAgB,EAAC,SAAS,EAAEoB,IAAI,CAAC,CAClC;EAED,SAASI,SAAS,CAACC,EAAwB,EAAE;IAC3C,IAAIA,EAAE,EAAE;MACNF,SAAS,CAACG,OAAO,CAAC,UAACC,CAAC;QAAA,OAAKA,CAAC,CAACzB,GAAG,CAACuB,EAAE,CAAC;MAAA,EAAC;IACrC;EACF;EAEA,SAASJ,WAAW,GAAG;IACrBE,SAAS,CAACG,OAAO,CAAC,UAACC,CAAC;MAAA,OAAKA,CAAC,CAACC,MAAM,EAAE;IAAA,EAAC;EACtC;EAEA,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAItB,CAAmB,EAAK;IAC3CA,CAAC,CAACC,cAAc,EAAE;IAClB7B,MAAM,CAACO,OAAO,GAAGqB,CAAC,CAACG,OAAO;IAC1B9B,UAAU,CAACM,OAAO,GAAGZ,cAAc,CAACY,OAAO;IAE3C,IAAIrB,iBAAiB,EAAE;MACrBmD,kBAAkB,EAAE;IACtB;IAEAQ,SAAS,CAACxD,QAAQ,CAAC;EACrB,CAAC;EAED,OACE;IAAK,SAAS,EAAC,kBAAkB;IAAC,SAAS,EAAER;EAAU,GACrD;IACE,SAAS,EAAC,wBAAwB;IAClC,GAAG,EAAEsB,IAAK;IACV,OAAO,EAAEgD;EAAgB,GAEzB;IACE,SAAS,EAAE,IAAAC,sBAAU,EACnB,4BAA4B,EAC5B,CAACjB,cAAc,wCAAwC,CACvD;IACF,YAAY,EAAEjD,iBAAiB,GAAGqD,mBAAmB,GAAGd,SAAU;IAClE,YAAY,EAAEvC,iBAAiB,GAAGsD,mBAAmB,GAAGf,SAAU;IAClE,GAAG,EAAErB,QAAS;IACd,WAAW,EAAE8C;EAAY,EACzB,CACE,EAEN;IACE,SAAS,EAAC,uBAAuB;IACjC,QAAQ,EAAE,CAAC,CAAE;IACb,GAAG,EAAElE,MAAO;IACZ,QAAQ,EAAE2D;EAAO,GAEhB7D,QAAQ,CACL,CACF;AAEV,CAAC;AAAC"}