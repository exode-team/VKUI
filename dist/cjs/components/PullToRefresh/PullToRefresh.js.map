{"version":3,"sources":["../../../../src/components/PullToRefresh/PullToRefresh.tsx"],"names":["cancelEvent","event","originalEvent","preventDefault","cancelable","stopPropagation","TOUCH_MOVE_EVENT_PARAMS","passive","PullToRefresh","children","isFetching","onRefresh","restProps","platform","scroll","document","prevIsFetching","initParams","React","useMemo","start","IOS","max","maxY","refreshing","positionMultiplier","useState","spinnerY","setSpinnerY","watching","setWatching","setRefreshing","canRefresh","setCanRefresh","touchDown","setTouchDown","prevTouchDown","touchY","useRef","contentShift","setContentShift","spinnerProgress","setSpinnerProgress","onWindowTouchMove","resetRefreshingState","useCallback","onRefreshingFinish","setWaitFetchingTimeout","set","clearWaitFetchingTimeout","clear","undefined","runRefreshing","prevSpinnerY","onTouchStart","e","onTouchMove","isY","shiftY","pageYOffset","getScroll","y","shift","Math","current","currentY","min","progress","abs","onTouchEnd","spinnerTransform","contentTransform","transform","WebkitTransform","opacity"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { AnyFunction, HasPlatform } from \"../../types\";\nimport { DOMProps, useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS } from \"../../lib/platform\";\nimport { runTapticImpactOccurred } from \"../../lib/taptic\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { ScrollContextInterface, useScroll } from \"../AppRoot/ScrollContext\";\nimport { Touch, TouchEvent, TouchProps } from \"../Touch/Touch\";\nimport { FixedLayout } from \"../FixedLayout/FixedLayout\";\nimport { PullToRefreshSpinner } from \"./PullToRefreshSpinner\";\nimport TouchRootContext from \"../Touch/TouchContext\";\nimport { usePrevious } from \"../../hooks/usePrevious\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\n\nfunction cancelEvent(event: any) {\n  if (!event) {\n    return false;\n  }\n  while (event.originalEvent) {\n    event = event.originalEvent;\n  }\n  if (event.preventDefault && event.cancelable) {\n    event.preventDefault();\n  }\n  if (event.stopPropagation) {\n    event.stopPropagation();\n  }\n  return false;\n}\n\nexport interface PullToRefreshProps extends DOMProps, TouchProps, HasPlatform {\n  /**\n   * Будет вызвана для обновления контента (прим.: функция должна быть мемоизированным коллбэком)\n   */\n  onRefresh: AnyFunction;\n  /**\n   * Определяет, выполняется ли обновление. Для скрытия спиннера после получения контента необходимо передать `false`\n   */\n  isFetching?: boolean;\n  /** @ignore */\n  scroll?: ScrollContextInterface;\n  children?: React.ReactNode;\n}\n\nconst TOUCH_MOVE_EVENT_PARAMS = {\n  cancelable: true,\n  passive: false,\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PullToRefresh\n */\nexport const PullToRefresh = ({\n  children,\n  isFetching,\n  onRefresh,\n  ...restProps\n}: PullToRefreshProps) => {\n  const platform = usePlatform();\n  const scroll = useScroll();\n  const { document } = useDOM();\n  const prevIsFetching = usePrevious(isFetching);\n\n  const initParams = React.useMemo(\n    () => ({\n      start: platform === IOS ? -10 : -45,\n      max: platform === IOS ? 50 : 80,\n      maxY: platform === IOS ? 400 : 80,\n      refreshing: platform === IOS ? 36 : 50,\n      positionMultiplier: platform === IOS ? 0.21 : 1,\n    }),\n    [platform]\n  );\n\n  const [spinnerY, setSpinnerY] = React.useState(initParams.start);\n  const [watching, setWatching] = React.useState(false);\n  const [refreshing, setRefreshing] = React.useState(false);\n  const [canRefresh, setCanRefresh] = React.useState(false);\n  const [touchDown, setTouchDown] = React.useState(false);\n  const prevTouchDown = usePrevious(touchDown);\n\n  const touchY = React.useRef(0);\n  const [contentShift, setContentShift] = React.useState(0);\n  const [spinnerProgress, setSpinnerProgress] = React.useState(0);\n\n  const onWindowTouchMove = (event: Event) => {\n    if (refreshing) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  useGlobalEventListener(\n    document,\n    \"touchmove\",\n    onWindowTouchMove,\n    TOUCH_MOVE_EVENT_PARAMS\n  );\n\n  const resetRefreshingState = React.useCallback(() => {\n    setWatching(false);\n    setCanRefresh(false);\n    setRefreshing(false);\n    setSpinnerY(initParams.start);\n    setSpinnerProgress(0);\n    setContentShift(0);\n  }, [initParams]);\n\n  const onRefreshingFinish = React.useCallback(() => {\n    if (!touchDown) {\n      resetRefreshingState();\n    }\n  }, [touchDown, resetRefreshingState]);\n\n  const { set: setWaitFetchingTimeout, clear: clearWaitFetchingTimeout } =\n    useTimeout(onRefreshingFinish, 1000);\n\n  useIsomorphicLayoutEffect(() => {\n    if (prevIsFetching !== undefined && prevIsFetching && !isFetching) {\n      onRefreshingFinish();\n    }\n  }, [prevIsFetching, isFetching, onRefreshingFinish]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (prevIsFetching !== undefined && !prevIsFetching && isFetching) {\n      clearWaitFetchingTimeout();\n    }\n  }, [isFetching, prevIsFetching, clearWaitFetchingTimeout]);\n\n  const runRefreshing = React.useCallback(() => {\n    if (!refreshing && onRefresh) {\n      // cleanup if the consumer does not start fetching in 1s\n      setWaitFetchingTimeout();\n\n      setRefreshing(true);\n      setSpinnerY((prevSpinnerY) =>\n        platform === IOS ? prevSpinnerY : initParams.refreshing\n      );\n\n      onRefresh();\n      runTapticImpactOccurred(\"light\");\n    }\n  }, [\n    refreshing,\n    onRefresh,\n    setWaitFetchingTimeout,\n    platform,\n    initParams.refreshing,\n  ]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (prevTouchDown !== undefined && prevTouchDown && !touchDown) {\n      if (!refreshing && canRefresh) {\n        runRefreshing();\n      } else if (refreshing && !isFetching) {\n        // only iOS can start refresh before gesture end\n        resetRefreshingState();\n      } else {\n        // refreshing && isFetching: refresh in progress\n        // OR !refreshing && !canRefresh: pull was not strong enough\n        setSpinnerY(refreshing ? initParams.refreshing : initParams.start);\n        setSpinnerProgress(0);\n        setContentShift(0);\n      }\n    }\n  }, [\n    initParams,\n    prevIsFetching,\n    isFetching,\n    onRefreshingFinish,\n    prevTouchDown,\n    touchDown,\n    refreshing,\n    canRefresh,\n    runRefreshing,\n  ]);\n\n  const onTouchStart = (e: TouchEvent) => {\n    if (refreshing) {\n      cancelEvent(e);\n    }\n    setTouchDown(true);\n  };\n\n  const onTouchMove = (e: TouchEvent) => {\n    const { isY, shiftY } = e;\n    const { start, max } = initParams;\n    const pageYOffset = scroll?.getScroll().y;\n\n    if (watching && touchDown) {\n      cancelEvent(e);\n\n      const { positionMultiplier, maxY } = initParams;\n\n      const shift = Math.max(0, shiftY - touchY.current);\n\n      const currentY = Math.max(\n        start,\n        Math.min(maxY, start + shift * positionMultiplier)\n      );\n      const progress =\n        currentY > -10 ? Math.abs((currentY + 10) / max) * 80 : 0;\n\n      setSpinnerY(currentY);\n      setSpinnerProgress(Math.min(80, Math.max(0, progress)));\n      setCanRefresh(progress > 80);\n      setContentShift((currentY + 10) * 2.3);\n\n      if (progress > 85 && !refreshing && platform === IOS) {\n        runRefreshing();\n      }\n    } else if (\n      isY &&\n      pageYOffset === 0 &&\n      shiftY > 0 &&\n      !refreshing &&\n      touchDown\n    ) {\n      cancelEvent(e);\n\n      touchY.current = shiftY;\n      setWatching(true);\n      setSpinnerY(start);\n      setSpinnerProgress(0);\n    }\n  };\n\n  const onTouchEnd = () => {\n    setWatching(false);\n    setTouchDown(false);\n  };\n\n  const spinnerTransform = `translate3d(0, ${spinnerY}px, 0)`;\n  let contentTransform = \"\";\n\n  if (platform === IOS && refreshing && !touchDown) {\n    contentTransform = \"translate3d(0, 100px, 0)\";\n  } else if (platform === IOS && (contentShift || refreshing)) {\n    contentTransform = `translate3d(0, ${contentShift}px, 0)`;\n  }\n\n  return (\n    <TouchRootContext.Provider value={true}>\n      <Touch\n        {...restProps}\n        onStart={onTouchStart}\n        onMove={onTouchMove}\n        onEnd={onTouchEnd}\n        vkuiClass={classNames(\n          \"PullToRefresh\",\n          platform === IOS && \"PullToRefresh--ios\",\n          watching && \"PullToRefresh--watching\",\n          refreshing && \"PullToRefresh--refreshing\"\n        )}\n      >\n        <FixedLayout vkuiClass=\"PullToRefresh__controls\">\n          <PullToRefreshSpinner\n            style={{\n              transform: spinnerTransform,\n              WebkitTransform: spinnerTransform,\n              opacity: watching || refreshing || canRefresh ? 1 : 0,\n            }}\n            on={refreshing}\n            progress={refreshing ? undefined : spinnerProgress}\n          />\n        </FixedLayout>\n\n        <div\n          vkuiClass=\"PullToRefresh__content\"\n          style={{\n            transform: contentTransform,\n            WebkitTransform: contentTransform,\n          }}\n        >\n          {children}\n        </div>\n      </Touch>\n    </TouchRootContext.Provider>\n  );\n};\n"],"file":"PullToRefresh.js"}