{"version":3,"sources":["../../../../src/components/Dropdown/Dropdown.tsx"],"names":["Dropdown","action","shownProp","shown","showDelay","hideDelay","offsetDistance","content","children","style","getRef","onShownChange","restProps","document","hoverable","hovered","React","useRef","useState","computedShown","setComputedShown","dropdownNode","setPopperNode","styles","patchedPopperRef","childRef","child","setShown","value","showTimeout","hideTimeout","handleTargetEnter","current","clear","set","handleTargetClick","handleTargetLeave","handleContentKeyDownEscape","handleOutsideClick","e","contains","target","targetEnterListener","targetClickEvent","targetLeaveListener","useEffect","add","className","undefined"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAgDA;AACA;AACA;AACA;AACA;AACO,IAAMA,QAAQ,GAAG,SAAXA,QAAW,OAYH;AAAA,yBAXnBC,MAWmB;AAAA,MAXnBA,MAWmB,4BAXV,OAWU;AAAA,MAVZC,SAUY,QAVnBC,KAUmB;AAAA,4BATnBC,SASmB;AAAA,MATnBA,SASmB,+BATP,GASO;AAAA,4BARnBC,SAQmB;AAAA,MARnBA,SAQmB,+BARP,GAQO;AAAA,iCAPnBC,cAOmB;AAAA,MAPnBA,cAOmB,oCAPF,CAOE;AAAA,MANnBC,OAMmB,QANnBA,OAMmB;AAAA,MALnBC,QAKmB,QALnBA,QAKmB;AAAA,MAJnBC,KAImB,QAJnBA,KAImB;AAAA,MAHnBC,MAGmB,QAHnBA,MAGmB;AAAA,MAFnBC,aAEmB,QAFnBA,aAEmB;AAAA,MADhBC,SACgB;;AACnB,gBAAqB,kBAArB;AAAA,MAAQC,QAAR,WAAQA,QAAR;;AAEA,MAAMC,SAAS,GAAGb,MAAM,KAAK,OAA7B;AACA,MAAMc,OAAO,GAAGC,KAAK,CAACC,MAAN,CAAa,KAAb,CAAhB;;AACA,wBAA0CD,KAAK,CAACE,QAAN,CAAehB,SAAS,IAAI,KAA5B,CAA1C;AAAA;AAAA,MAAOiB,aAAP;AAAA,MAAsBC,gBAAtB;;AACA,yBAAsCJ,KAAK,CAACE,QAAN,CACpC,IADoC,CAAtC;AAAA;AAAA,MAAOG,YAAP;AAAA,MAAqBC,aAArB,uBANmB,CAUnB;AACA;;;AACA,MAAMC,MAAM,+DACPd,KADO;AAEV,6CAAkCH,cAAlC;AAFU,IAAZ;AAKA,MAAMH,KAAK,GAAG,OAAOD,SAAP,KAAqB,SAArB,GAAiCA,SAAjC,GAA6CiB,aAA3D;AAEA,MAAMK,gBAAgB,GAAG,gCAA6BF,aAA7B,EAA4CZ,MAA5C,CAAzB;;AAEA,6BAA0B,+CAAoBF,QAApB,CAA1B;AAAA;AAAA,MAAOiB,QAAP;AAAA,MAAiBC,KAAjB;;AAEA,MAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,KAAD,EAAoB;AACnC,QAAI,OAAO1B,SAAP,KAAqB,SAAzB,EAAoC;AAClCkB,MAAAA,gBAAgB,CAACQ,KAAD,CAAhB;AACD;;AACD,WAAOjB,aAAP,KAAyB,UAAzB,IAAuCA,aAAa,CAACiB,KAAD,CAApD;AACD,GALD;;AAOA,MAAMC,WAAW,GAAG,4BAAW;AAAA,WAAMF,QAAQ,CAAC,IAAD,CAAd;AAAA,GAAX,EAAiCvB,SAAjC,CAApB;AAEA,MAAM0B,WAAW,GAAG,4BAAW;AAAA,WAAMH,QAAQ,CAAC,KAAD,CAAd;AAAA,GAAX,EAAkCtB,SAAlC,CAApB;;AAEA,MAAM0B,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9BhB,IAAAA,OAAO,CAACiB,OAAR,GAAkB,IAAlB;AACAF,IAAAA,WAAW,CAACG,KAAZ;AACAJ,IAAAA,WAAW,CAACK,GAAZ;AACD,GAJD;;AAMA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9B,QAAIpB,OAAO,CAACiB,OAAR,IAAmB7B,KAAvB,EAA8B;AAC5B;AACD;;AACDwB,IAAAA,QAAQ,CAAC,CAACxB,KAAF,CAAR;AACD,GALD;;AAOA,MAAMiC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9BrB,IAAAA,OAAO,CAACiB,OAAR,GAAkB,KAAlB;AACAH,IAAAA,WAAW,CAACI,KAAZ;AACAH,IAAAA,WAAW,CAACI,GAAZ;AACD,GAJD;;AAMA,MAAMG,0BAA0B,GAAG,SAA7BA,0BAA6B,GAAM;AACvCV,IAAAA,QAAQ,CAAC,KAAD,CAAR;AACD,GAFD;;AAIA,MAAMW,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,CAAD,EAAmB;AAAA;;AAC5C,QACElB,YAAY,IACZ,uBAACI,QAAQ,CAACO,OAAV,8CAAC,kBAAkBQ,QAAlB,CAA2BD,CAAC,CAACE,MAA7B,CAAD,CADA,IAEA,CAACpB,YAAY,CAACmB,QAAb,CAAsBD,CAAC,CAACE,MAAxB,CAHH,EAIE;AACAd,MAAAA,QAAQ,CAAC,KAAD,CAAR;AACD;AACF,GARD;;AAUA,sDAAuBd,QAAvB,EAAiC,OAAjC,EAA0CyB,kBAA1C;AACA,MAAMI,mBAAmB,GAAG,wCAAiB,YAAjB,EAA+BX,iBAA/B,CAA5B;AACA,MAAMY,gBAAgB,GAAG,wCAAiB,OAAjB,EAA0BR,iBAA1B,CAAzB;AACA,MAAMS,mBAAmB,GAAG,wCAAiB,YAAjB,EAA+BR,iBAA/B,CAA5B;AAEApB,EAAAA,KAAK,CAAC6B,SAAN,CAAgB,YAAM;AACpB,QAAI,CAACpB,QAAQ,CAACO,OAAd,EAAuB;AACrB;AACD;;AAEDW,IAAAA,gBAAgB,CAACG,GAAjB,CAAqBrB,QAAQ,CAACO,OAA9B;;AAEA,QAAIlB,SAAJ,EAAe;AACb4B,MAAAA,mBAAmB,CAACI,GAApB,CAAwBrB,QAAQ,CAACO,OAAjC;AACAY,MAAAA,mBAAmB,CAACE,GAApB,CAAwBrB,QAAQ,CAACO,OAAjC;AACD;AACF,GAXD,EAWG,CACDP,QADC,EAEDX,SAFC,EAGD6B,gBAHC,EAIDD,mBAJC,EAKDE,mBALC,CAXH;AAmBA,SACE,qCAAC,KAAD,CAAO,QAAP,QACGlB,KADH,EAEGvB,KAAK,IACJ,qCAAC,cAAD,6BACMS,SADN;AAEE,IAAA,SAAS,EAAC,UAFZ;AAGE,IAAA,SAAS,EAAEa,QAHb;AAIE,IAAA,MAAM,EAAED,gBAJV;AAKE,IAAA,cAAc,EAAElB,cALlB;AAME,IAAA,KAAK,EAAEiB,MANT;AAOE,IAAA,aAAa,EAAE;AAAA,UAAGwB,SAAH,SAAGA,SAAH;AAAA,aACb,qCAAC,oBAAD;AACE,QAAA,SAAS,EAAEA,SADb;AAEE,QAAA,OAAO,EAAEV;AAFX,SAIG9B,OAJH,CADa;AAAA,KAPjB;AAeE,IAAA,WAAW,EAAEO,SAAS,GAAGgB,WAAW,CAACG,KAAf,GAAuBe,SAf/C;AAgBE,IAAA,UAAU,EAAElC,SAAS,GAAGsB,iBAAH,GAAuBY;AAhB9C,KAHJ,CADF;AAyBD,CAhIM","sourcesContent":["import * as React from \"react\";\nimport { useDOM } from \"../../lib/dom\";\nimport { PopperCommonProps, Popper } from \"../Popper/Popper\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEventListener } from \"../../hooks/useEventListener\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { usePatchChildrenRef } from \"../../hooks/usePatchChildrenRef\";\nimport \"./Dropdown.css\";\n\nexport interface DropdownProps\n  extends Omit<PopperCommonProps, \"arrow\" | \"arrowClassName\"> {\n  /**\n   * Механика вызова всплывающего окна.\n   *\n   * - `\"click\"` – показывается/скрывается только при нажатии.\n   * - `\"hover\"` – помимо нажатия, будет показываться/скрывается при наведении/отведении мыши.\n   *\n   * > ⚠️`\"hover\"` на тач-устройствах будет работать как `\"click\"`, с одним лишь нюансом, что не будет закрываться\n   * > при повторном нажатии на целевой элемент. Для закрытия необходимо нажать на область вне целевого элемента\n   * > и выпадающего окна.\n   */\n  action?: \"click\" | \"hover\";\n  /**\n   * Если передан, то всплывающее окно будет показан/скрыт в зависимости от значения свойства.\n   */\n  shown?: boolean;\n  /**\n   * Количество миллисекунд, после которых произойдёт показ всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  showDelay?: number;\n  /**\n   * Количество миллисекунд, после которых произойдёт скрытие всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  hideDelay?: number;\n  /**\n   * Содержимое всплывающего окна.\n   */\n  content?: React.ReactNode;\n  /**\n   * Целевой элемент. Всплывающее окно появится возле него.\n   *\n   * > ⚠️ Если это пользовательский компонент, то он должен предоставлять параметры либо `getRootRef`, либо `ref` для получения ссылки на DOM-узел.\n   */\n  children?: React.ReactElement;\n  /**\n   * Вызывается при каждом изменении видимости всплывающего окна.\n   */\n  onShownChange?(shown: boolean): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Dropdown\n *\n * TODO v5.0.0 Переименовать в `Popover` (см. https://github.com/VKCOM/VKUI/issues/2523)\n */\nexport const Dropdown = ({\n  action = \"click\",\n  shown: shownProp,\n  showDelay = 150,\n  hideDelay = 150,\n  offsetDistance = 8,\n  content,\n  children,\n  style,\n  getRef,\n  onShownChange,\n  ...restProps\n}: DropdownProps) => {\n  const { document } = useDOM();\n\n  const hoverable = action === \"hover\";\n  const hovered = React.useRef(false);\n  const [computedShown, setComputedShown] = React.useState(shownProp || false);\n  const [dropdownNode, setPopperNode] = React.useState<HTMLElement | null>(\n    null\n  );\n\n  // Reason: Typescript ругается на CSS Custom Properties в объекте\n  // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n  const styles = {\n    ...style,\n    \"--popover-safe-zone-padding\": `${offsetDistance}px`,\n  } as React.CSSProperties;\n\n  const shown = typeof shownProp === \"boolean\" ? shownProp : computedShown;\n\n  const patchedPopperRef = useExternRef<HTMLDivElement>(setPopperNode, getRef);\n\n  const [childRef, child] = usePatchChildrenRef(children);\n\n  const setShown = (value: boolean) => {\n    if (typeof shownProp !== \"boolean\") {\n      setComputedShown(value);\n    }\n    typeof onShownChange === \"function\" && onShownChange(value);\n  };\n\n  const showTimeout = useTimeout(() => setShown(true), showDelay);\n\n  const hideTimeout = useTimeout(() => setShown(false), hideDelay);\n\n  const handleTargetEnter = () => {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n\n  const handleTargetClick = () => {\n    if (hovered.current && shown) {\n      return;\n    }\n    setShown(!shown);\n  };\n\n  const handleTargetLeave = () => {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n\n  const handleContentKeyDownEscape = () => {\n    setShown(false);\n  };\n\n  const handleOutsideClick = (e: MouseEvent) => {\n    if (\n      dropdownNode &&\n      !childRef.current?.contains(e.target as Node) &&\n      !dropdownNode.contains(e.target as Node)\n    ) {\n      setShown(false);\n    }\n  };\n\n  useGlobalEventListener(document, \"click\", handleOutsideClick);\n  const targetEnterListener = useEventListener(\"mouseenter\", handleTargetEnter);\n  const targetClickEvent = useEventListener(\"click\", handleTargetClick);\n  const targetLeaveListener = useEventListener(\"mouseleave\", handleTargetLeave);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    targetClickEvent.add(childRef.current);\n\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n  }, [\n    childRef,\n    hoverable,\n    targetClickEvent,\n    targetEnterListener,\n    targetLeaveListener,\n  ]);\n\n  return (\n    <React.Fragment>\n      {child}\n      {shown && (\n        <Popper\n          {...restProps}\n          vkuiClass=\"Dropdown\"\n          targetRef={childRef}\n          getRef={patchedPopperRef}\n          offsetDistance={offsetDistance}\n          style={styles}\n          renderContent={({ className }) => (\n            <FocusTrap\n              vkuiClass={className}\n              onClose={handleContentKeyDownEscape}\n            >\n              {content}\n            </FocusTrap>\n          )}\n          onMouseOver={hoverable ? hideTimeout.clear : undefined}\n          onMouseOut={hoverable ? handleTargetLeave : undefined}\n        />\n      )}\n    </React.Fragment>\n  );\n};\n"],"file":"Dropdown.js"}