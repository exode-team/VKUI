{"version":3,"file":"ConfigProvider.js","names":["warn","warnOnce","useSchemeDetector","node","_scheme","inherit","getScheme","React","useCallback","canUseDOM","undefined","getAttribute","useState","resolvedScheme","setScheme","useEffect","noop","observer","MutationObserver","observe","attributes","attributeFilter","disconnect","deriveAppearance","scheme","Scheme","SPACE_GRAY","VKCOM_DARK","ConfigProvider","props","parentLocale","useContext","LocaleProviderContext","parentConfig","ConfigProviderContext","children","webviewType","isWebView","transitionMotionEnabled","platform","hasNewTokens","appearance","locale","normalizedScheme","normalizeScheme","useDOM","document","target","body","useIsomorphicLayoutEffect","process","env","NODE_ENV","hasAttribute","setAttribute","removeAttribute","realScheme","derivedAppearance","VKUITokensClassName","generateVKUITokensClassName","classList","add","remove","configContext","useObjectMemo"],"sources":["../../../../src/components/ConfigProvider/ConfigProvider.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { AppearanceType } from \"@vkontakte/vk-bridge\";\nimport { canUseDOM, useDOM } from \"../../lib/dom\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n} from \"./ConfigProviderContext\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport {\n  normalizeScheme,\n  AppearanceScheme,\n  Scheme,\n} from \"../../helpers/scheme\";\nimport {\n  AppearanceProvider,\n  generateVKUITokensClassName,\n} from \"../AppearanceProvider/AppearanceProvider\";\nimport { LocaleProviderContext } from \"../LocaleProviderContext/LocaleProviderContext\";\n\nexport interface ConfigProviderProps\n  extends Partial<ConfigProviderContextInterface> {\n  /**\n   * @deprecated будет удалено в 5.0.0, устанавливать тему следует через appearance\n   * Цветовая схема приложения\n   */\n  scheme?: AppearanceScheme;\n  /**\n    Локаль ([список](https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry))\n   */\n  locale?: string;\n  children?: React.ReactNode;\n}\n\nconst warn = warnOnce(\"ConfigProvider\");\n\nfunction useSchemeDetector(\n  node: HTMLElement | undefined | null,\n  _scheme: Scheme | \"inherit\"\n) {\n  const inherit = _scheme === \"inherit\";\n  const getScheme = React.useCallback(() => {\n    if (!inherit || !canUseDOM || !node) {\n      return undefined;\n    }\n    return node.getAttribute(\"scheme\") as Scheme;\n  }, [inherit, node]);\n  const [resolvedScheme, setScheme] = React.useState(getScheme());\n\n  React.useEffect(() => {\n    if (!inherit || !node) {\n      return noop;\n    }\n    setScheme(getScheme());\n    const observer = new MutationObserver(() => setScheme(getScheme()));\n    observer.observe(node, { attributes: true, attributeFilter: [\"scheme\"] });\n    return () => observer.disconnect();\n  }, [getScheme, inherit, node]);\n\n  return _scheme === \"inherit\" ? resolvedScheme : _scheme;\n}\n\nconst deriveAppearance = (scheme: Scheme | undefined): AppearanceType =>\n  scheme === Scheme.SPACE_GRAY || scheme === Scheme.VKCOM_DARK\n    ? \"dark\"\n    : \"light\";\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ConfigProvider\n */\nexport const ConfigProvider = (props: ConfigProviderProps) => {\n  const parentLocale = React.useContext(LocaleProviderContext);\n  const parentConfig = React.useContext(ConfigProviderContext);\n\n  const {\n    children,\n    webviewType = parentConfig.webviewType,\n    isWebView = parentConfig.isWebView,\n    transitionMotionEnabled = parentConfig.transitionMotionEnabled,\n    platform = parentConfig.platform,\n    hasNewTokens = parentConfig.hasNewTokens,\n    appearance = parentConfig.appearance,\n    scheme,\n    locale = parentLocale ?? \"ru\",\n  } = props;\n\n  const normalizedScheme = normalizeScheme({\n    scheme,\n    platform,\n    appearance,\n  });\n  const { document } = useDOM();\n  const target = document?.body;\n\n  useIsomorphicLayoutEffect(() => {\n    if (normalizedScheme === \"inherit\") {\n      return noop;\n    }\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      target?.hasAttribute(\"scheme\") &&\n      parentConfig.appearance === undefined // appearance не была вычислена в родительском конфиге, @deprecated будет удалено в 5.0.0\n    ) {\n      warn(\n        '<body scheme> был установлен перед монтированием VKUI - вы не забыли scheme=\"inherit\"?'\n      );\n    }\n    target?.setAttribute(\"scheme\", normalizedScheme);\n    return () => target?.removeAttribute(\"scheme\");\n  }, [normalizedScheme]);\n\n  const realScheme = useSchemeDetector(target, normalizedScheme);\n  const derivedAppearance = deriveAppearance(realScheme);\n\n  useIsomorphicLayoutEffect(() => {\n    const VKUITokensClassName = generateVKUITokensClassName(\n      platform,\n      derivedAppearance\n    );\n\n    // eslint-disable-next-line no-restricted-properties\n    target?.classList.add(VKUITokensClassName);\n\n    return () => {\n      // eslint-disable-next-line no-restricted-properties\n      target?.classList.remove(VKUITokensClassName);\n    };\n  }, [platform, derivedAppearance]);\n\n  const configContext = useObjectMemo({\n    webviewType,\n    isWebView,\n    transitionMotionEnabled,\n    hasNewTokens,\n    platform,\n    scheme,\n    appearance: appearance || derivedAppearance,\n  });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      <LocaleProviderContext.Provider value={locale}>\n        <AppearanceProvider appearance={configContext.appearance}>\n          {children}\n        </AppearanceProvider>\n      </LocaleProviderContext.Provider>\n    </ConfigProviderContext.Provider>\n  );\n};\n"],"mappings":";;;;;;;;;;AAAA;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AAKA;AAIA;AAgBA,IAAMA,IAAI,GAAG,IAAAC,kBAAQ,EAAC,gBAAgB,CAAC;AAEvC,SAASC,iBAAiB,CACxBC,IAAoC,EACpCC,OAA2B,EAC3B;EACA,IAAMC,OAAO,GAAGD,OAAO,KAAK,SAAS;EACrC,IAAME,SAAS,GAAGC,KAAK,CAACC,WAAW,CAAC,YAAM;IACxC,IAAI,CAACH,OAAO,IAAI,CAACI,cAAS,IAAI,CAACN,IAAI,EAAE;MACnC,OAAOO,SAAS;IAClB;IACA,OAAOP,IAAI,CAACQ,YAAY,CAAC,QAAQ,CAAC;EACpC,CAAC,EAAE,CAACN,OAAO,EAAEF,IAAI,CAAC,CAAC;EACnB,sBAAoCI,KAAK,CAACK,QAAQ,CAACN,SAAS,EAAE,CAAC;IAAA;IAAxDO,cAAc;IAAEC,SAAS;EAEhCP,KAAK,CAACQ,SAAS,CAAC,YAAM;IACpB,IAAI,CAACV,OAAO,IAAI,CAACF,IAAI,EAAE;MACrB,OAAOa,WAAI;IACb;IACAF,SAAS,CAACR,SAAS,EAAE,CAAC;IACtB,IAAMW,QAAQ,GAAG,IAAIC,gBAAgB,CAAC;MAAA,OAAMJ,SAAS,CAACR,SAAS,EAAE,CAAC;IAAA,EAAC;IACnEW,QAAQ,CAACE,OAAO,CAAChB,IAAI,EAAE;MAAEiB,UAAU,EAAE,IAAI;MAAEC,eAAe,EAAE,CAAC,QAAQ;IAAE,CAAC,CAAC;IACzE,OAAO;MAAA,OAAMJ,QAAQ,CAACK,UAAU,EAAE;IAAA;EACpC,CAAC,EAAE,CAAChB,SAAS,EAAED,OAAO,EAAEF,IAAI,CAAC,CAAC;EAE9B,OAAOC,OAAO,KAAK,SAAS,GAAGS,cAAc,GAAGT,OAAO;AACzD;AAEA,IAAMmB,gBAAgB,GAAG,SAAnBA,gBAAgB,CAAIC,MAA0B;EAAA,OAClDA,MAAM,KAAKC,eAAM,CAACC,UAAU,IAAIF,MAAM,KAAKC,eAAM,CAACE,UAAU,GACxD,MAAM,GACN,OAAO;AAAA;;AAEb;AACA;AACA;AACO,IAAMC,cAAc,GAAG,SAAjBA,cAAc,CAAIC,KAA0B,EAAK;EAC5D,IAAMC,YAAY,GAAGvB,KAAK,CAACwB,UAAU,CAACC,4CAAqB,CAAC;EAC5D,IAAMC,YAAY,GAAG1B,KAAK,CAACwB,UAAU,CAACG,4CAAqB,CAAC;EAE5D,IACEC,QAAQ,GASNN,KAAK,CATPM,QAAQ;IAAA,qBASNN,KAAK,CARPO,WAAW;IAAXA,WAAW,mCAAGH,YAAY,CAACG,WAAW;IAAA,mBAQpCP,KAAK,CAPPQ,SAAS;IAATA,SAAS,iCAAGJ,YAAY,CAACI,SAAS;IAAA,wBAOhCR,KAAK,CANPS,uBAAuB;IAAvBA,uBAAuB,sCAAGL,YAAY,CAACK,uBAAuB;IAAA,kBAM5DT,KAAK,CALPU,QAAQ;IAARA,QAAQ,gCAAGN,YAAY,CAACM,QAAQ;IAAA,sBAK9BV,KAAK,CAJPW,YAAY;IAAZA,YAAY,oCAAGP,YAAY,CAACO,YAAY;IAAA,oBAItCX,KAAK,CAHPY,UAAU;IAAVA,UAAU,kCAAGR,YAAY,CAACQ,UAAU;IACpCjB,MAAM,GAEJK,KAAK,CAFPL,MAAM;IAAA,gBAEJK,KAAK,CADPa,MAAM;IAANA,MAAM,8BAAGZ,YAAY,aAAZA,YAAY,cAAZA,YAAY,GAAI,IAAI;EAG/B,IAAMa,gBAAgB,GAAG,IAAAC,wBAAe,EAAC;IACvCpB,MAAM,EAANA,MAAM;IACNe,QAAQ,EAARA,QAAQ;IACRE,UAAU,EAAVA;EACF,CAAC,CAAC;EACF,cAAqB,IAAAI,WAAM,GAAE;IAArBC,QAAQ,WAARA,QAAQ;EAChB,IAAMC,MAAM,GAAGD,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEE,IAAI;EAE7B,IAAAC,oDAAyB,EAAC,YAAM;IAC9B,IAAIN,gBAAgB,KAAK,SAAS,EAAE;MAClC,OAAO3B,WAAI;IACb;IACA,IACEkC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,IACtCL,MAAM,aAANA,MAAM,eAANA,MAAM,CAAEM,YAAY,CAAC,QAAQ,CAAC,IAC9BpB,YAAY,CAACQ,UAAU,KAAK/B,SAAS,CAAC;IAAA,EACtC;MACAV,IAAI,CACF,wFAAwF,CACzF;IACH;IACA+C,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEO,YAAY,CAAC,QAAQ,EAAEX,gBAAgB,CAAC;IAChD,OAAO;MAAA,OAAMI,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEQ,eAAe,CAAC,QAAQ,CAAC;IAAA;EAChD,CAAC,EAAE,CAACZ,gBAAgB,CAAC,CAAC;EAEtB,IAAMa,UAAU,GAAGtD,iBAAiB,CAAC6C,MAAM,EAAEJ,gBAAgB,CAAC;EAC9D,IAAMc,iBAAiB,GAAGlC,gBAAgB,CAACiC,UAAU,CAAC;EAEtD,IAAAP,oDAAyB,EAAC,YAAM;IAC9B,IAAMS,mBAAmB,GAAG,IAAAC,+CAA2B,EACrDpB,QAAQ,EACRkB,iBAAiB,CAClB;;IAED;IACAV,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEa,SAAS,CAACC,GAAG,CAACH,mBAAmB,CAAC;IAE1C,OAAO,YAAM;MACX;MACAX,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEa,SAAS,CAACE,MAAM,CAACJ,mBAAmB,CAAC;IAC/C,CAAC;EACH,CAAC,EAAE,CAACnB,QAAQ,EAAEkB,iBAAiB,CAAC,CAAC;EAEjC,IAAMM,aAAa,GAAG,IAAAC,4BAAa,EAAC;IAClC5B,WAAW,EAAXA,WAAW;IACXC,SAAS,EAATA,SAAS;IACTC,uBAAuB,EAAvBA,uBAAuB;IACvBE,YAAY,EAAZA,YAAY;IACZD,QAAQ,EAARA,QAAQ;IACRf,MAAM,EAANA,MAAM;IACNiB,UAAU,EAAEA,UAAU,IAAIgB;EAC5B,CAAC,CAAC;EAEF,OACE,qCAAC,4CAAqB,CAAC,QAAQ;IAAC,KAAK,EAAEM;EAAc,GACnD,qCAAC,4CAAqB,CAAC,QAAQ;IAAC,KAAK,EAAErB;EAAO,GAC5C,qCAAC,sCAAkB;IAAC,UAAU,EAAEqB,aAAa,CAACtB;EAAW,GACtDN,QAAQ,CACU,CACU,CACF;AAErC,CAAC;AAAC"}