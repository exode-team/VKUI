{"version":3,"sources":["../../../../src/components/ConfigProvider/ConfigProvider.tsx"],"names":["warn","useSchemeDetector","node","_scheme","inherit","getScheme","React","useCallback","canUseDOM","undefined","getAttribute","useState","resolvedScheme","setScheme","useEffect","noop","observer","MutationObserver","observe","attributes","attributeFilter","disconnect","deriveAppearance","scheme","Scheme","SPACE_GRAY","VKCOM_DARK","ConfigProvider","props","parentLocale","useContext","LocaleProviderContext","parentConfig","ConfigProviderContext","children","webviewType","isWebView","transitionMotionEnabled","platform","hasNewTokens","appearance","locale","normalizedScheme","document","target","body","process","env","NODE_ENV","hasAttribute","setAttribute","removeAttribute","realScheme","derivedAppearance","VKUITokensClassName","classList","add","remove","configContext"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { AppearanceType } from \"@vkontakte/vk-bridge\";\nimport { canUseDOM, useDOM } from \"../../lib/dom\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n} from \"./ConfigProviderContext\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport {\n  normalizeScheme,\n  AppearanceScheme,\n  Scheme,\n} from \"../../helpers/scheme\";\nimport {\n  AppearanceProvider,\n  generateVKUITokensClassName,\n} from \"../AppearanceProvider/AppearanceProvider\";\nimport { LocaleProviderContext } from \"../LocaleProviderContext/LocaleProviderContext\";\n\nexport interface ConfigProviderProps\n  extends Partial<ConfigProviderContextInterface> {\n  /**\n   * @deprecated будет удалено в 5.0.0, устанавливать тему следует через appearance\n   * Цветовая схема приложения\n   */\n  scheme?: AppearanceScheme;\n  /**\n    Локаль ([список](https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry))\n   */\n  locale?: string;\n  children?: React.ReactNode;\n}\n\nconst warn = warnOnce(\"ConfigProvider\");\n\nfunction useSchemeDetector(\n  node: HTMLElement | undefined | null,\n  _scheme: Scheme | \"inherit\"\n) {\n  const inherit = _scheme === \"inherit\";\n  const getScheme = React.useCallback(() => {\n    if (!inherit || !canUseDOM || !node) {\n      return undefined;\n    }\n    return node.getAttribute(\"scheme\") as Scheme;\n  }, [inherit, node]);\n  const [resolvedScheme, setScheme] = React.useState(getScheme());\n\n  React.useEffect(() => {\n    if (!inherit || !node) {\n      return noop;\n    }\n    setScheme(getScheme());\n    const observer = new MutationObserver(() => setScheme(getScheme()));\n    observer.observe(node, { attributes: true, attributeFilter: [\"scheme\"] });\n    return () => observer.disconnect();\n  }, [getScheme, inherit, node]);\n\n  return _scheme === \"inherit\" ? resolvedScheme : _scheme;\n}\n\nconst deriveAppearance = (scheme: Scheme | undefined): AppearanceType =>\n  scheme === Scheme.SPACE_GRAY || scheme === Scheme.VKCOM_DARK\n    ? \"dark\"\n    : \"light\";\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ConfigProvider\n */\nexport const ConfigProvider = (props: ConfigProviderProps) => {\n  const parentLocale = React.useContext(LocaleProviderContext);\n  const parentConfig = React.useContext(ConfigProviderContext);\n\n  const {\n    children,\n    webviewType = parentConfig.webviewType,\n    isWebView = parentConfig.isWebView,\n    transitionMotionEnabled = parentConfig.transitionMotionEnabled,\n    platform = parentConfig.platform,\n    hasNewTokens = parentConfig.hasNewTokens,\n    appearance = parentConfig.appearance,\n    scheme,\n    locale = parentLocale ?? \"ru\",\n  } = props;\n\n  const normalizedScheme = normalizeScheme({\n    scheme,\n    platform,\n    appearance,\n  });\n  const { document } = useDOM();\n  const target = document?.body;\n\n  useIsomorphicLayoutEffect(() => {\n    if (normalizedScheme === \"inherit\") {\n      return noop;\n    }\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      target?.hasAttribute(\"scheme\") &&\n      parentConfig.appearance === undefined // appearance не была вычислена в родительском конфиге, @deprecated будет удалено в 5.0.0\n    ) {\n      warn(\n        '<body scheme> был установлен перед монтированием VKUI - вы не забыли scheme=\"inherit\"?'\n      );\n    }\n    target?.setAttribute(\"scheme\", normalizedScheme);\n    return () => target?.removeAttribute(\"scheme\");\n  }, [normalizedScheme]);\n\n  const realScheme = useSchemeDetector(target, normalizedScheme);\n  const derivedAppearance = deriveAppearance(realScheme);\n\n  useIsomorphicLayoutEffect(() => {\n    const VKUITokensClassName = generateVKUITokensClassName(\n      platform,\n      derivedAppearance\n    );\n\n    // eslint-disable-next-line no-restricted-properties\n    target?.classList.add(VKUITokensClassName);\n\n    return () => {\n      // eslint-disable-next-line no-restricted-properties\n      target?.classList.remove(VKUITokensClassName);\n    };\n  }, [platform, derivedAppearance]);\n\n  const configContext = useObjectMemo({\n    webviewType,\n    isWebView,\n    transitionMotionEnabled,\n    hasNewTokens,\n    platform,\n    scheme,\n    appearance: appearance || derivedAppearance,\n  });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      <LocaleProviderContext.Provider value={locale}>\n        <AppearanceProvider appearance={configContext.appearance}>\n          {children}\n        </AppearanceProvider>\n      </LocaleProviderContext.Provider>\n    </ConfigProviderContext.Provider>\n  );\n};\n"],"file":"ConfigProvider.js"}