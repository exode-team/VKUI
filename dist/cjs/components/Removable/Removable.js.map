{"version":3,"file":"Removable.js","names":["RemovableIos","onRemove","removePlaceholder","removePlaceholderString","children","useDOM","window","removeButtonRef","React","useRef","disabledRef","useState","removeOffset","updateRemoveOffset","useGlobalEventListener","capture","onRemoveTransitionEnd","current","focus","onRemoveActivateClick","e","stopPropagation","offsetWidth","transform","Removable","getRootRef","noop","align","restProps","platform","usePlatform","useAdaptivity","sizeY","ref","useExternRef","onRemoveClick","preventDefault","getTitleFromChildren","classNames","IOS"],"sources":["../../../../src/components/Removable/Removable.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { HasRootRef } from \"../../types\";\nimport { classNames } from \"../../lib/classNames\";\nimport { getTitleFromChildren, noop } from \"../../lib/utils\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useDOM } from \"../../lib/dom\";\nimport { IOS } from \"../../lib/platform\";\nimport { Icon24Cancel } from \"@vkontakte/icons\";\nimport { IconButton } from \"../IconButton/IconButton\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { Tappable } from \"../Tappable/Tappable\";\nimport \"./Removable.css\";\n\nexport interface RemovableProps {\n  /**\n   * iOS only. Текст в выезжающей кнопке для удаления ячейки.\n   */\n  removePlaceholder?: React.ReactNode;\n  /**\n   * Коллбэк срабатывает при клике на контрол удаления.\n   */\n  onRemove?: (e: React.MouseEvent, rootEl?: HTMLElement | null) => void;\n}\n\ninterface RemovableIosOwnProps extends RemovableProps {\n  removePlaceholderString?: string;\n  children?: React.ReactNode;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/RemovableIos\n */\nconst RemovableIos = ({\n  onRemove,\n  removePlaceholder,\n  removePlaceholderString,\n  children,\n}: RemovableIosOwnProps) => {\n  const { window } = useDOM();\n\n  const removeButtonRef = React.useRef<HTMLElement>(null);\n  const disabledRef = React.useRef(true);\n  const [removeOffset, updateRemoveOffset] = React.useState(0);\n\n  useGlobalEventListener(\n    window,\n    \"click\",\n    () => {\n      if (removeOffset > 0) {\n        updateRemoveOffset(0);\n      }\n    },\n    { capture: true }\n  );\n\n  const onRemoveTransitionEnd = () => {\n    if (removeOffset > 0) {\n      removeButtonRef?.current?.focus();\n    } else {\n      disabledRef.current = true;\n    }\n  };\n\n  const onRemoveActivateClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!removeButtonRef.current) {\n      return;\n    }\n    const { offsetWidth } = removeButtonRef.current;\n    disabledRef.current = false;\n    updateRemoveOffset(offsetWidth);\n  };\n\n  return (\n    <div\n      vkuiClass=\"Removable__content\"\n      style={{ transform: `translateX(-${removeOffset ?? 0}px)` }}\n      onTransitionEnd={onRemoveTransitionEnd}\n    >\n      <IconButton\n        hasActive={false}\n        hasHover={false}\n        aria-label={removePlaceholderString}\n        vkuiClass=\"Removable__action Removable__toggle\"\n        onClick={onRemoveActivateClick}\n        disabled={removeOffset > 0}\n      >\n        <i vkuiClass=\"Removable__toggle-in\" role=\"presentation\" />\n      </IconButton>\n      {children}\n\n      <span vkuiClass=\"Removable__offset\" aria-hidden />\n\n      <Tappable\n        Component=\"button\"\n        hasActive={false}\n        hasHover={false}\n        disabled={disabledRef.current}\n        getRootRef={removeButtonRef}\n        vkuiClass=\"Removable__remove\"\n        onClick={onRemove}\n      >\n        <span vkuiClass=\"Removable__remove-in\">{removePlaceholder}</span>\n      </Tappable>\n    </div>\n  );\n};\n\ninterface RemovableOwnProps\n  extends React.AllHTMLAttributes<HTMLElement>,\n    RemovableProps,\n    HasRootRef<HTMLDivElement> {\n  /**\n   * Расположение кнопки удаления.\n   */\n  align?: \"start\" | \"center\";\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Removable\n */\nexport const Removable = ({\n  getRootRef,\n  children,\n  onRemove = noop,\n  removePlaceholder = \"Удалить\",\n  align = \"center\",\n  ...restProps\n}: RemovableOwnProps) => {\n  const platform = usePlatform();\n  const { sizeY } = useAdaptivity();\n\n  const ref = useExternRef(getRootRef);\n\n  const onRemoveClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    onRemove(e);\n  };\n\n  const removePlaceholderString: string =\n    getTitleFromChildren(removePlaceholder);\n\n  return (\n    <div\n      {...restProps}\n      ref={ref}\n      vkuiClass={classNames(\n        \"Removable\",\n        platform === IOS && \"Removable--ios\",\n        `Removable--${align}`,\n        `Removable--sizeY-${sizeY}`\n      )}\n    >\n      {platform !== IOS && (\n        <div vkuiClass=\"Removable__content\">\n          {children}\n\n          <IconButton\n            activeMode=\"opacity\"\n            hoverMode=\"opacity\"\n            vkuiClass=\"Removable__action\"\n            onClick={onRemoveClick}\n            aria-label={removePlaceholderString}\n          >\n            <Icon24Cancel role=\"presentation\" />\n          </IconButton>\n\n          <span vkuiClass=\"Removable__offset\" aria-hidden />\n        </div>\n      )}\n\n      {platform === IOS && (\n        <RemovableIos\n          onRemove={onRemoveClick}\n          removePlaceholder={removePlaceholder}\n          removePlaceholderString={removePlaceholderString}\n        >\n          {children}\n        </RemovableIos>\n      )}\n    </div>\n  );\n};\n"],"mappings":";;;;;;;;;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAgD;AAmBhD;AACA;AACA;AACA,IAAMA,YAAY,GAAG,SAAfA,YAAY,OAKU;EAAA,IAJ1BC,QAAQ,QAARA,QAAQ;IACRC,iBAAiB,QAAjBA,iBAAiB;IACjBC,uBAAuB,QAAvBA,uBAAuB;IACvBC,QAAQ,QAARA,QAAQ;EAER,cAAmB,IAAAC,WAAM,GAAE;IAAnBC,MAAM,WAANA,MAAM;EAEd,IAAMC,eAAe,GAAGC,KAAK,CAACC,MAAM,CAAc,IAAI,CAAC;EACvD,IAAMC,WAAW,GAAGF,KAAK,CAACC,MAAM,CAAC,IAAI,CAAC;EACtC,sBAA2CD,KAAK,CAACG,QAAQ,CAAC,CAAC,CAAC;IAAA;IAArDC,YAAY;IAAEC,kBAAkB;EAEvC,IAAAC,8CAAsB,EACpBR,MAAM,EACN,OAAO,EACP,YAAM;IACJ,IAAIM,YAAY,GAAG,CAAC,EAAE;MACpBC,kBAAkB,CAAC,CAAC,CAAC;IACvB;EACF,CAAC,EACD;IAAEE,OAAO,EAAE;EAAK,CAAC,CAClB;EAED,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAqB,GAAS;IAClC,IAAIJ,YAAY,GAAG,CAAC,EAAE;MAAA;MACpBL,eAAe,aAAfA,eAAe,gDAAfA,eAAe,CAAEU,OAAO,0DAAxB,sBAA0BC,KAAK,EAAE;IACnC,CAAC,MAAM;MACLR,WAAW,CAACO,OAAO,GAAG,IAAI;IAC5B;EACF,CAAC;EAED,IAAME,qBAAqB,GAAG,SAAxBA,qBAAqB,CAAIC,CAAmB,EAAK;IACrDA,CAAC,CAACC,eAAe,EAAE;IACnB,IAAI,CAACd,eAAe,CAACU,OAAO,EAAE;MAC5B;IACF;IACA,IAAQK,WAAW,GAAKf,eAAe,CAACU,OAAO,CAAvCK,WAAW;IACnBZ,WAAW,CAACO,OAAO,GAAG,KAAK;IAC3BJ,kBAAkB,CAACS,WAAW,CAAC;EACjC,CAAC;EAED,OACE;IACE,SAAS,EAAC,oBAAoB;IAC9B,KAAK,EAAE;MAAEC,SAAS,wBAAiBX,YAAY,aAAZA,YAAY,cAAZA,YAAY,GAAI,CAAC;IAAM,CAAE;IAC5D,eAAe,EAAEI;EAAsB,GAEvC,qCAAC,sBAAU;IACT,SAAS,EAAE,KAAM;IACjB,QAAQ,EAAE,KAAM;IAChB,cAAYb,uBAAwB;IACpC,SAAS,EAAC,qCAAqC;IAC/C,OAAO,EAAEgB,qBAAsB;IAC/B,QAAQ,EAAEP,YAAY,GAAG;EAAE,GAE3B;IAAG,SAAS,EAAC,sBAAsB;IAAC,IAAI,EAAC;EAAc,EAAG,CAC/C,EACZR,QAAQ,EAET;IAAM,SAAS,EAAC,mBAAmB;IAAC;EAAW,EAAG,EAElD,qCAAC,kBAAQ;IACP,SAAS,EAAC,QAAQ;IAClB,SAAS,EAAE,KAAM;IACjB,QAAQ,EAAE,KAAM;IAChB,QAAQ,EAAEM,WAAW,CAACO,OAAQ;IAC9B,UAAU,EAAEV,eAAgB;IAC5B,SAAS,EAAC,mBAAmB;IAC7B,OAAO,EAAEN;EAAS,GAElB;IAAM,SAAS,EAAC;EAAsB,GAAEC,iBAAiB,CAAQ,CACxD,CACP;AAEV,CAAC;AAYD;AACA;AACA;AACO,IAAMsB,SAAS,GAAG,SAAZA,SAAS,QAOG;EAAA,IANvBC,UAAU,SAAVA,UAAU;IACVrB,QAAQ,SAARA,QAAQ;IAAA,uBACRH,QAAQ;IAARA,QAAQ,+BAAGyB,WAAI;IAAA,8BACfxB,iBAAiB;IAAjBA,iBAAiB,sCAAG,SAAS;IAAA,oBAC7ByB,KAAK;IAALA,KAAK,4BAAG,QAAQ;IACbC,SAAS;EAEZ,IAAMC,QAAQ,GAAG,IAAAC,wBAAW,GAAE;EAC9B,qBAAkB,IAAAC,6BAAa,GAAE;IAAzBC,KAAK,kBAALA,KAAK;EAEb,IAAMC,GAAG,GAAG,IAAAC,0BAAY,EAACT,UAAU,CAAC;EAEpC,IAAMU,aAAa,GAAG,SAAhBA,aAAa,CAAIf,CAAmB,EAAK;IAC7CA,CAAC,CAACgB,cAAc,EAAE;IAClBnC,QAAQ,CAACmB,CAAC,CAAC;EACb,CAAC;EAED,IAAMjB,uBAA+B,GACnC,IAAAkC,2BAAoB,EAACnC,iBAAiB,CAAC;EAEzC,OACE,uEACM0B,SAAS;IACb,GAAG,EAAEK,GAAI;IACT,SAAS,EAAE,IAAAK,sBAAU,EACnB,WAAW,EACXT,QAAQ,KAAKU,aAAG,IAAI,gBAAgB,uBACtBZ,KAAK,8BACCK,KAAK;EACzB,IAEDH,QAAQ,KAAKU,aAAG,IACf;IAAK,SAAS,EAAC;EAAoB,GAChCnC,QAAQ,EAET,qCAAC,sBAAU;IACT,UAAU,EAAC,SAAS;IACpB,SAAS,EAAC,SAAS;IACnB,SAAS,EAAC,mBAAmB;IAC7B,OAAO,EAAE+B,aAAc;IACvB,cAAYhC;EAAwB,GAEpC,qCAAC,mBAAY;IAAC,IAAI,EAAC;EAAc,EAAG,CACzB,EAEb;IAAM,SAAS,EAAC,mBAAmB;IAAC;EAAW,EAAG,CAErD,EAEA0B,QAAQ,KAAKU,aAAG,IACf,qCAAC,YAAY;IACX,QAAQ,EAAEJ,aAAc;IACxB,iBAAiB,EAAEjC,iBAAkB;IACrC,uBAAuB,EAAEC;EAAwB,GAEhDC,QAAQ,CAEZ,CACG;AAEV,CAAC;AAAC"}