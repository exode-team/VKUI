{"version":3,"file":"Root.js","names":["warn","warnOnce","Root","popout","modal","children","_activeView","activeView","onTransition","nav","restProps","scroll","React","useContext","ScrollContext","platform","usePlatform","useDOM","document","scrolls","useRef","current","viewNodes","ConfigProviderContext","transitionMotionEnabled","SplitColContext","animate","disableAnimation","views","Children","toArray","useState","transition","prevView","isBack","_setState","transitionTo","panel","viewIds","map","view","getNavId","props","indexOf","getScroll","y","finishTransition","useCallback","useIsomorphicLayoutEffect","activeElement","blur","scrollTo","Boolean","from","to","fallbackTransition","useTimeout","IOS","useEffect","clear","set","onAnimationEnd","e","includes","animationName","process","env","NODE_ENV","classNames","viewId","isTransitionTarget","compensateScroll","undefined","marginTop"],"sources":["../../../../src/components/Root/Root.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS } from \"../../lib/platform\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId, NavIdProps } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport \"./Root.css\";\n\nexport interface RootProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    NavIdProps {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `Alert`, `ActionSheet` и `ScreenSpinner`.\n   */\n  popout?: React.ReactNode;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `ModalRoot`.\n   */\n  modal?: React.ReactNode;\n}\n\nexport interface RootState {\n  activeView: string;\n  transition: boolean;\n  isBack?: boolean;\n  prevView?: string;\n}\n\nconst warn = warnOnce(\"Root\");\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Root\n */\nexport const Root = ({\n  popout = null,\n  modal,\n  children,\n  activeView: _activeView,\n  onTransition,\n  nav,\n  ...restProps\n}: RootProps) => {\n  const scroll = React.useContext(ScrollContext);\n  const platform = usePlatform();\n  const { document } = useDOM();\n  const scrolls = React.useRef<Record<string, number>>({}).current;\n  const viewNodes = React.useRef<Record<string, HTMLElement | null>>(\n    {}\n  ).current;\n\n  const { transitionMotionEnabled = true } = React.useContext(\n    ConfigProviderContext\n  );\n  const { animate } = React.useContext(SplitColContext);\n  const disableAnimation = !transitionMotionEnabled || !animate;\n\n  const views = React.Children.toArray(children) as React.ReactElement[];\n\n  const [{ prevView, activeView, transition, isBack }, _setState] =\n    React.useState<RootState>({\n      activeView: _activeView,\n      transition: false,\n    });\n  const transitionTo = (panel: string) => {\n    if (panel !== activeView) {\n      const viewIds = views.map((view) => getNavId(view.props, warn));\n      const isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: !disableAnimation,\n        isBack,\n      });\n    }\n  };\n  const finishTransition = React.useCallback(\n    () => _setState({ activeView, prevView, isBack, transition: false }),\n    [activeView, isBack, prevView]\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    (document!.activeElement as HTMLElement).blur();\n  }, [!!popout, activeView]);\n\n  // Нужен переход\n  useIsomorphicLayoutEffect(() => transitionTo(_activeView), [_activeView]);\n  useIsomorphicLayoutEffect(() => {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition &&\n        onTransition({\n          isBack: Boolean(isBack),\n          from: prevView,\n          to: activeView,\n        });\n    }\n  }, [transition, prevView]);\n\n  const fallbackTransition = useTimeout(\n    finishTransition,\n    platform === IOS ? 600 : 300\n  );\n  React.useEffect(() => {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n    fallbackTransition.set();\n  }, [fallbackTransition, transition]);\n\n  const onAnimationEnd = (e: React.AnimationEvent) => {\n    if (\n      [\n        \"vkui-root-android-animation-hide-back\",\n        \"vkui-root-android-animation-show-forward\",\n        \"vkui-root-ios-animation-hide-back\",\n        \"vkui-root-ios-animation-show-forward\",\n      ].includes(e.animationName)\n    ) {\n      finishTransition();\n    }\n  };\n\n  if (process.env.NODE_ENV === \"development\") {\n    popout &&\n      warn(\n        \"Свойство popout устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n      );\n    modal &&\n      warn(\n        \"Свойство modal устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n      );\n  }\n\n  return (\n    <div\n      {...restProps}\n      vkuiClass={classNames(\n        \"Root\",\n        platform === IOS && \"Root--ios\",\n        transition && \"Root--transition\"\n      )}\n    >\n      {views.map((view) => {\n        const viewId = getNavId(view.props, warn);\n        if (viewId !== activeView && !(transition && viewId === prevView)) {\n          return null;\n        }\n        const isTransitionTarget =\n          transition && viewId === (isBack ? prevView : activeView);\n        const compensateScroll =\n          transition &&\n          (viewId === prevView || (isBack && viewId === activeView));\n        return (\n          <div\n            key={viewId}\n            ref={(e) => viewId && (viewNodes[viewId] = e)}\n            onAnimationEnd={isTransitionTarget ? onAnimationEnd : undefined}\n            vkuiClass={classNames(\n              \"Root__view\",\n              transition &&\n                viewId === prevView &&\n                isBack &&\n                \"Root__view--hide-back\",\n              transition &&\n                viewId === prevView &&\n                !isBack &&\n                \"Root__view--hide-forward\",\n              transition &&\n                viewId === activeView &&\n                isBack &&\n                \"Root__view--show-back\",\n              transition &&\n                viewId === activeView &&\n                !isBack &&\n                \"Root__view--show-forward\",\n              !transition && viewId === activeView && \"Root__view--active\"\n            )}\n          >\n            <NavTransitionProvider\n              entering={transition && viewId === activeView}\n            >\n              <div\n                vkuiClass=\"Root__scrollCompensation\"\n                style={{\n                  marginTop: compensateScroll\n                    ? viewId && -(scrolls[viewId] ?? 0)\n                    : undefined,\n                }}\n              >\n                {view}\n              </div>\n            </NavTransitionProvider>\n          </div>\n        );\n      })}\n      <AppRootPortal>\n        {!!popout && <div vkuiClass=\"Root__popout\">{popout}</div>}\n        {!!modal && <div vkuiClass=\"Root__modal\">{modal}</div>}\n      </AppRootPortal>\n    </div>\n  );\n};\n"],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAsD;AA6BtD,IAAMA,IAAI,GAAG,IAAAC,kBAAQ,EAAC,MAAM,CAAC;;AAE7B;AACA;AACA;AACO,IAAMC,IAAI,GAAG,SAAPA,IAAI,OAQA;EAAA,uBAPfC,MAAM;IAANA,MAAM,4BAAG,IAAI;IACbC,KAAK,QAALA,KAAK;IACLC,QAAQ,QAARA,QAAQ;IACIC,WAAW,QAAvBC,UAAU;IACVC,YAAY,QAAZA,YAAY;IACZC,GAAG,QAAHA,GAAG;IACAC,SAAS;EAEZ,IAAMC,MAAM,GAAGC,KAAK,CAACC,UAAU,CAACC,4BAAa,CAAC;EAC9C,IAAMC,QAAQ,GAAG,IAAAC,wBAAW,GAAE;EAC9B,cAAqB,IAAAC,WAAM,GAAE;IAArBC,QAAQ,WAARA,QAAQ;EAChB,IAAMC,OAAO,GAAGP,KAAK,CAACQ,MAAM,CAAyB,CAAC,CAAC,CAAC,CAACC,OAAO;EAChE,IAAMC,SAAS,GAAGV,KAAK,CAACQ,MAAM,CAC5B,CAAC,CAAC,CACH,CAACC,OAAO;EAET,wBAA2CT,KAAK,CAACC,UAAU,CACzDU,4CAAqB,CACtB;IAAA,0CAFOC,uBAAuB;IAAvBA,uBAAuB,sCAAG,IAAI;EAGtC,yBAAoBZ,KAAK,CAACC,UAAU,CAACY,yBAAe,CAAC;IAA7CC,OAAO,sBAAPA,OAAO;EACf,IAAMC,gBAAgB,GAAG,CAACH,uBAAuB,IAAI,CAACE,OAAO;EAE7D,IAAME,KAAK,GAAGhB,KAAK,CAACiB,QAAQ,CAACC,OAAO,CAACzB,QAAQ,CAAyB;EAEtE,sBACEO,KAAK,CAACmB,QAAQ,CAAY;MACxBxB,UAAU,EAAED,WAAW;MACvB0B,UAAU,EAAE;IACd,CAAC,CAAC;IAAA;IAAA;IAJKC,QAAQ,qBAARA,QAAQ;IAAE1B,UAAU,qBAAVA,UAAU;IAAEyB,UAAU,qBAAVA,UAAU;IAAEE,MAAM,qBAANA,MAAM;IAAIC,SAAS;EAK9D,IAAMC,YAAY,GAAG,SAAfA,YAAY,CAAIC,KAAa,EAAK;IACtC,IAAIA,KAAK,KAAK9B,UAAU,EAAE;MACxB,IAAM+B,OAAO,GAAGV,KAAK,CAACW,GAAG,CAAC,UAACC,IAAI;QAAA,OAAK,IAAAC,kBAAQ,EAACD,IAAI,CAACE,KAAK,EAAE1C,IAAI,CAAC;MAAA,EAAC;MAC/D,IAAMkC,OAAM,GAAGI,OAAO,CAACK,OAAO,CAACN,KAAK,CAAC,GAAGC,OAAO,CAACK,OAAO,CAACpC,UAAU,CAAC;MACnEY,OAAO,CAACZ,UAAU,CAAC,GAAGI,MAAM,CAACiC,SAAS,EAAE,CAACC,CAAC;MAC1CV,SAAS,CAAC;QACR5B,UAAU,EAAE8B,KAAK;QACjBJ,QAAQ,EAAE1B,UAAU;QACpByB,UAAU,EAAE,CAACL,gBAAgB;QAC7BO,MAAM,EAANA;MACF,CAAC,CAAC;IACJ;EACF,CAAC;EACD,IAAMY,gBAAgB,GAAGlC,KAAK,CAACmC,WAAW,CACxC;IAAA,OAAMZ,SAAS,CAAC;MAAE5B,UAAU,EAAVA,UAAU;MAAE0B,QAAQ,EAARA,QAAQ;MAAEC,MAAM,EAANA,MAAM;MAAEF,UAAU,EAAE;IAAM,CAAC,CAAC;EAAA,GACpE,CAACzB,UAAU,EAAE2B,MAAM,EAAED,QAAQ,CAAC,CAC/B;EAED,IAAAe,oDAAyB,EAAC,YAAM;IAC7B9B,QAAQ,CAAE+B,aAAa,CAAiBC,IAAI,EAAE;EACjD,CAAC,EAAE,CAAC,CAAC,CAAC/C,MAAM,EAAEI,UAAU,CAAC,CAAC;;EAE1B;EACA,IAAAyC,oDAAyB,EAAC;IAAA,OAAMZ,YAAY,CAAC9B,WAAW,CAAC;EAAA,GAAE,CAACA,WAAW,CAAC,CAAC;EACzE,IAAA0C,oDAAyB,EAAC,YAAM;IAC9B,IAAI,CAAChB,UAAU,IAAIC,QAAQ,EAAE;MAC3B;MACAtB,MAAM,CAACwC,QAAQ,CAAC,CAAC,EAAEjB,MAAM,GAAGf,OAAO,CAACZ,UAAU,CAAC,GAAG,CAAC,CAAC;MACpDC,YAAY,IACVA,YAAY,CAAC;QACX0B,MAAM,EAAEkB,OAAO,CAAClB,MAAM,CAAC;QACvBmB,IAAI,EAAEpB,QAAQ;QACdqB,EAAE,EAAE/C;MACN,CAAC,CAAC;IACN;EACF,CAAC,EAAE,CAACyB,UAAU,EAAEC,QAAQ,CAAC,CAAC;EAE1B,IAAMsB,kBAAkB,GAAG,IAAAC,sBAAU,EACnCV,gBAAgB,EAChB/B,QAAQ,KAAK0C,aAAG,GAAG,GAAG,GAAG,GAAG,CAC7B;EACD7C,KAAK,CAAC8C,SAAS,CAAC,YAAM;IACpB,IAAI,CAAC1B,UAAU,EAAE;MACfuB,kBAAkB,CAACI,KAAK,EAAE;MAC1B;IACF;IACAJ,kBAAkB,CAACK,GAAG,EAAE;EAC1B,CAAC,EAAE,CAACL,kBAAkB,EAAEvB,UAAU,CAAC,CAAC;EAEpC,IAAM6B,cAAc,GAAG,SAAjBA,cAAc,CAAIC,CAAuB,EAAK;IAClD,IACE,CACE,uCAAuC,EACvC,0CAA0C,EAC1C,mCAAmC,EACnC,sCAAsC,CACvC,CAACC,QAAQ,CAACD,CAAC,CAACE,aAAa,CAAC,EAC3B;MACAlB,gBAAgB,EAAE;IACpB;EACF,CAAC;EAED,IAAImB,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;IAC1ChE,MAAM,IACJH,IAAI,CACF,mGAAmG,CACpG;IACHI,KAAK,IACHJ,IAAI,CACF,kGAAkG,CACnG;EACL;EAEA,OACE,uEACMU,SAAS;IACb,SAAS,EAAE,IAAA0D,sBAAU,EACnB,MAAM,EACNrD,QAAQ,KAAK0C,aAAG,IAAI,WAAW,EAC/BzB,UAAU,IAAI,kBAAkB;EAChC,IAEDJ,KAAK,CAACW,GAAG,CAAC,UAACC,IAAI,EAAK;IAAA;IACnB,IAAM6B,MAAM,GAAG,IAAA5B,kBAAQ,EAACD,IAAI,CAACE,KAAK,EAAE1C,IAAI,CAAC;IACzC,IAAIqE,MAAM,KAAK9D,UAAU,IAAI,EAAEyB,UAAU,IAAIqC,MAAM,KAAKpC,QAAQ,CAAC,EAAE;MACjE,OAAO,IAAI;IACb;IACA,IAAMqC,kBAAkB,GACtBtC,UAAU,IAAIqC,MAAM,MAAMnC,MAAM,GAAGD,QAAQ,GAAG1B,UAAU,CAAC;IAC3D,IAAMgE,gBAAgB,GACpBvC,UAAU,KACTqC,MAAM,KAAKpC,QAAQ,IAAKC,MAAM,IAAImC,MAAM,KAAK9D,UAAW,CAAC;IAC5D,OACE;MACE,GAAG,EAAE8D,MAAO;MACZ,GAAG,EAAE,aAACP,CAAC;QAAA,OAAKO,MAAM,KAAK/C,SAAS,CAAC+C,MAAM,CAAC,GAAGP,CAAC,CAAC;MAAA,CAAC;MAC9C,cAAc,EAAEQ,kBAAkB,GAAGT,cAAc,GAAGW,SAAU;MAChE,SAAS,EAAE,IAAAJ,sBAAU,EACnB,YAAY,EACZpC,UAAU,IACRqC,MAAM,KAAKpC,QAAQ,IACnBC,MAAM,IACN,uBAAuB,EACzBF,UAAU,IACRqC,MAAM,KAAKpC,QAAQ,IACnB,CAACC,MAAM,IACP,0BAA0B,EAC5BF,UAAU,IACRqC,MAAM,KAAK9D,UAAU,IACrB2B,MAAM,IACN,uBAAuB,EACzBF,UAAU,IACRqC,MAAM,KAAK9D,UAAU,IACrB,CAAC2B,MAAM,IACP,0BAA0B,EAC5B,CAACF,UAAU,IAAIqC,MAAM,KAAK9D,UAAU,IAAI,oBAAoB;IAC5D,GAEF,qCAAC,2CAAqB;MACpB,QAAQ,EAAEyB,UAAU,IAAIqC,MAAM,KAAK9D;IAAW,GAE9C;MACE,SAAS,EAAC,0BAA0B;MACpC,KAAK,EAAE;QACLkE,SAAS,EAAEF,gBAAgB,GACvBF,MAAM,IAAI,qBAAElD,OAAO,CAACkD,MAAM,CAAC,6DAAI,CAAC,CAAC,GACjCG;MACN;IAAE,GAEDhC,IAAI,CACD,CACgB,CACpB;EAEV,CAAC,CAAC,EACF,qCAAC,4BAAa,QACX,CAAC,CAACrC,MAAM,IAAI;IAAK,SAAS,EAAC;EAAc,GAAEA,MAAM,CAAO,EACxD,CAAC,CAACC,KAAK,IAAI;IAAK,SAAS,EAAC;EAAa,GAAEA,KAAK,CAAO,CACxC,CACZ;AAEV,CAAC;AAAC"}