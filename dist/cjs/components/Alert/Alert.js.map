{"version":3,"sources":["../../../../src/components/Alert/Alert.tsx"],"names":["AlertHeader","props","platform","IOS","AlertText","VKCOM","AlertAction","action","onItemClick","restProps","viewWidth","handleItemClick","React","useCallback","Component","href","mode","target","title","ANDROID","ViewWidth","DESKTOP","Alert","actions","actionsLayout","children","className","style","text","header","onClose","dismissLabel","waitTransitionFinish","useState","closing","setClosing","elementRef","useRef","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","timeout","close","current","e","propertyName","item","autoclose","stopPropagation","map","i"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Tappable } from \"../Tappable/Tappable\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { classNames } from \"../../lib/classNames\";\nimport { ANDROID, VKCOM, IOS } from \"../../lib/platform\";\nimport { ViewWidth } from \"../../hoc/withAdaptivity\";\nimport { Button, ButtonProps } from \"../Button/Button\";\nimport { hasReactNode, stopPropagation } from \"../../lib/utils\";\nimport { Title } from \"../Typography/Title/Title\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { Text } from \"../Typography/Text/Text\";\nimport { ModalDismissButton } from \"../ModalDismissButton/ModalDismissButton\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport { useWaitTransitionFinish } from \"../../hooks/useWaitTransitionFinish\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport \"./Alert.css\";\n\nexport type AlertActionInterface = AlertAction &\n  React.AnchorHTMLAttributes<HTMLElement>;\n\nexport interface AlertAction extends Pick<ButtonProps, \"Component\" | \"href\"> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: \"cancel\" | \"destructive\" | \"default\";\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement> {\n  actionsLayout?: \"vertical\" | \"horizontal\";\n  actions?: AlertAction[];\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n\n  /**\n   * `aria-label` для кнопки закрытия. Необходим, чтобы кнопка была доступной.\n   */\n  dismissLabel?: string;\n}\n\ntype ItemClickHandler = (item: AlertActionInterface) => void;\n\ninterface AlertTypography {\n  id: string;\n}\n\nconst AlertHeader: React.FC<AlertTypography> = (props) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case IOS:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"1\" level=\"3\" {...props} />\n      );\n    default:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"2\" level=\"2\" {...props} />\n      );\n  }\n};\n\nconst AlertText: React.FC<AlertTypography> = (props) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case VKCOM:\n      return <Caption vkuiClass=\"Alert__text\" {...props} />;\n    case IOS:\n      return <Caption vkuiClass=\"Alert__text\" level=\"2\" {...props} />;\n    default:\n      return (\n        <Text Component=\"span\" vkuiClass=\"Alert__text\" weight=\"3\" {...props} />\n      );\n  }\n};\n\ninterface AlertActionProps {\n  action: AlertActionInterface;\n  onItemClick: ItemClickHandler;\n}\n\nconst AlertAction: React.FC<AlertActionProps> = ({\n  action,\n  onItemClick,\n  ...restProps\n}) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const handleItemClick = React.useCallback(\n    () => onItemClick(action),\n    [onItemClick, action]\n  );\n\n  if (platform === IOS) {\n    const { Component = \"button\" } = action;\n    return (\n      <Tappable\n        Component={action.href ? \"a\" : Component}\n        vkuiClass={classNames(\"Alert__action\", `Alert__action--${action.mode}`)}\n        onClick={handleItemClick}\n        href={action.href}\n        target={action.target}\n        {...restProps}\n      >\n        {action.title}\n      </Tappable>\n    );\n  }\n\n  let mode: ButtonProps[\"mode\"] =\n    action.mode === \"cancel\" ? \"secondary\" : \"primary\";\n\n  if (platform === ANDROID) {\n    mode = \"tertiary\";\n\n    if (viewWidth === ViewWidth.DESKTOP && action.mode === \"destructive\") {\n      mode = \"destructive\";\n    }\n  }\n\n  return (\n    <Button\n      vkuiClass={classNames(\"Alert__button\", `Alert__button--${action.mode}`)}\n      mode={mode}\n      size=\"m\"\n      onClick={handleItemClick}\n      Component={action.Component}\n      href={action.href}\n      target={action.target}\n    >\n      {action.title}\n    </Button>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Alert\n */\nexport const Alert: React.FC<AlertProps> = ({\n  actions = [],\n  actionsLayout = \"horizontal\",\n  children,\n  className,\n  style,\n  text,\n  header,\n  onClose,\n  dismissLabel = \"Закрыть предупреждение\",\n  ...restProps\n}) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const resolvedActionsLayout: AlertProps[\"actionsLayout\"] =\n    platform === VKCOM ? \"horizontal\" : actionsLayout;\n  const canShowCloseButton =\n    platform === VKCOM ||\n    (platform === ANDROID && viewWidth >= ViewWidth.SMALL_TABLET);\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n\n  const timeout = platform === ANDROID || platform === VKCOM ? 200 : 300;\n\n  const close = React.useCallback(() => {\n    setClosing(true);\n    waitTransitionFinish(\n      elementRef.current,\n      (e?: TransitionEvent) => {\n        if (!e || e.propertyName === \"opacity\") {\n          onClose && onClose();\n        }\n      },\n      timeout\n    );\n  }, [elementRef, waitTransitionFinish, onClose, timeout]);\n\n  const onItemClick: ItemClickHandler = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action, autoclose } = item;\n\n      if (autoclose) {\n        setClosing(true);\n        waitTransitionFinish(\n          elementRef.current,\n          (e?: TransitionEvent) => {\n            if (!e || e.propertyName === \"opacity\") {\n              onClose && onClose();\n              action && action();\n            }\n          },\n          timeout\n        );\n      } else {\n        action && action();\n      }\n    },\n    [elementRef, waitTransitionFinish, onClose, timeout]\n  );\n\n  useScrollLock();\n\n  return (\n    <PopoutWrapper\n      className={className}\n      closing={closing}\n      style={style}\n      onClick={close}\n    >\n      <FocusTrap\n        {...restProps}\n        getRootRef={elementRef}\n        onClick={stopPropagation}\n        onClose={close}\n        timeout={timeout}\n        vkuiClass={classNames(\n          getClassName(\"Alert\", platform),\n          resolvedActionsLayout === \"vertical\" ? \"Alert--v\" : \"Alert--h\",\n          closing && \"Alert--closing\",\n          isDesktop && \"Alert--desktop\"\n        )}\n        role=\"alertdialog\"\n        aria-modal\n        aria-labelledby=\"vkui--alert--title\"\n        aria-describedby=\"vkui--alert--desc\"\n      >\n        <div vkuiClass=\"Alert__content\">\n          {hasReactNode(header) && (\n            <AlertHeader id=\"vkui--alert--title\">{header}</AlertHeader>\n          )}\n          {hasReactNode(text) && (\n            <AlertText id=\"vkui--alert--desc\">{text}</AlertText>\n          )}\n          {children}\n        </div>\n        <div vkuiClass=\"Alert__actions\">\n          {actions.map((action, i) => (\n            <AlertAction key={i} action={action} onItemClick={onItemClick} />\n          ))}\n        </div>\n        {canShowCloseButton && (\n          <ModalDismissButton onClick={close} aria-label={dismissLabel} />\n        )}\n      </FocusTrap>\n    </PopoutWrapper>\n  );\n};\n"],"file":"Alert.js"}