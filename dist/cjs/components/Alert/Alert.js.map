{"version":3,"sources":["../../../../src/components/Alert/Alert.tsx"],"names":["AlertHeader","props","platform","IOS","AlertText","VKCOM","AlertAction","action","onItemClick","restProps","viewWidth","handleItemClick","React","useCallback","Component","href","mode","target","title","ViewWidth","DESKTOP","Alert","actions","actionsLayout","children","className","style","text","header","onClose","dismissLabel","waitTransitionFinish","useState","closing","setClosing","elementRef","useRef","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","timeout","close","current","e","propertyName","item","autoclose","stopPropagation","map","i"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Tappable } from \"../Tappable/Tappable\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { classNames } from \"../../lib/classNames\";\nimport { VKCOM, IOS } from \"../../lib/platform\";\nimport { ViewWidth } from \"../../hoc/withAdaptivity\";\nimport { Button, ButtonProps } from \"../Button/Button\";\nimport { hasReactNode, stopPropagation } from \"../../lib/utils\";\nimport { Title } from \"../Typography/Title/Title\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { Text } from \"../Typography/Text/Text\";\nimport { ModalDismissButton } from \"../ModalDismissButton/ModalDismissButton\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport { useWaitTransitionFinish } from \"../../hooks/useWaitTransitionFinish\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport \"./Alert.css\";\n\nexport type AlertActionInterface = AlertAction &\n  React.AnchorHTMLAttributes<HTMLElement>;\n\nexport interface AlertAction extends Pick<ButtonProps, \"Component\" | \"href\"> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: \"cancel\" | \"destructive\" | \"default\";\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement> {\n  actionsLayout?: \"vertical\" | \"horizontal\";\n  actions?: AlertAction[];\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n\n  /**\n   * `aria-label` для кнопки закрытия. Необходим, чтобы кнопка была доступной.\n   */\n  dismissLabel?: string;\n}\n\ntype ItemClickHandler = (item: AlertActionInterface) => void;\n\ninterface AlertTypography {\n  id: string;\n  children?: React.ReactNode;\n}\n\nconst AlertHeader = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case IOS:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"1\" level=\"3\" {...props} />\n      );\n    default:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"2\" level=\"2\" {...props} />\n      );\n  }\n};\n\nconst AlertText = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case VKCOM:\n      return <Caption vkuiClass=\"Alert__text\" {...props} />;\n    case IOS:\n      return <Caption vkuiClass=\"Alert__text\" level=\"2\" {...props} />;\n    default:\n      return (\n        <Text Component=\"span\" vkuiClass=\"Alert__text\" weight=\"3\" {...props} />\n      );\n  }\n};\n\ninterface AlertActionProps {\n  action: AlertActionInterface;\n  onItemClick: ItemClickHandler;\n}\n\nconst AlertAction = ({\n  action,\n  onItemClick,\n  ...restProps\n}: AlertActionProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const handleItemClick = React.useCallback(\n    () => onItemClick(action),\n    [onItemClick, action]\n  );\n\n  if (platform === IOS) {\n    const { Component = \"button\" } = action;\n    return (\n      <Tappable\n        Component={action.href ? \"a\" : Component}\n        vkuiClass={classNames(\"Alert__action\", `Alert__action--${action.mode}`)}\n        onClick={handleItemClick}\n        href={action.href}\n        target={action.target}\n        {...restProps}\n      >\n        {action.title}\n      </Tappable>\n    );\n  }\n\n  let mode: ButtonProps[\"mode\"] = \"tertiary\";\n\n  // TODO v5.0.0 поправить под новую адаптивность\n  if (viewWidth === ViewWidth.DESKTOP && action.mode === \"destructive\") {\n    mode = \"destructive\";\n  }\n\n  if (platform === VKCOM) {\n    mode = action.mode === \"cancel\" ? \"secondary\" : \"primary\";\n  }\n\n  return (\n    <Button\n      vkuiClass={classNames(\"Alert__button\", `Alert__button--${action.mode}`)}\n      mode={mode}\n      size=\"m\"\n      onClick={handleItemClick}\n      Component={action.Component}\n      href={action.href}\n      target={action.target}\n    >\n      {action.title}\n    </Button>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Alert\n */\nexport const Alert = ({\n  actions = [],\n  actionsLayout = \"horizontal\",\n  children,\n  className,\n  style,\n  text,\n  header,\n  onClose,\n  dismissLabel = \"Закрыть предупреждение\",\n  ...restProps\n}: AlertProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const resolvedActionsLayout: AlertProps[\"actionsLayout\"] =\n    platform === VKCOM ? \"horizontal\" : actionsLayout;\n  const canShowCloseButton =\n    platform !== IOS && viewWidth >= ViewWidth.SMALL_TABLET;\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET; // TODO v5.0.0 поправить под новую адаптивность\n\n  const timeout = platform === IOS ? 300 : 200;\n\n  const close = React.useCallback(() => {\n    setClosing(true);\n    waitTransitionFinish(\n      elementRef.current,\n      (e?: TransitionEvent) => {\n        if (!e || e.propertyName === \"opacity\") {\n          onClose && onClose();\n        }\n      },\n      timeout\n    );\n  }, [elementRef, waitTransitionFinish, onClose, timeout]);\n\n  const onItemClick: ItemClickHandler = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action, autoclose } = item;\n\n      if (autoclose) {\n        setClosing(true);\n        waitTransitionFinish(\n          elementRef.current,\n          (e?: TransitionEvent) => {\n            if (!e || e.propertyName === \"opacity\") {\n              onClose && onClose();\n              action && action();\n            }\n          },\n          timeout\n        );\n      } else {\n        action && action();\n      }\n    },\n    [elementRef, waitTransitionFinish, onClose, timeout]\n  );\n\n  useScrollLock();\n\n  return (\n    <PopoutWrapper\n      className={className}\n      closing={closing}\n      style={style}\n      onClick={close}\n    >\n      <FocusTrap\n        {...restProps}\n        getRootRef={elementRef}\n        onClick={stopPropagation}\n        onClose={close}\n        timeout={timeout}\n        vkuiClass={classNames(\n          \"Alert\",\n          platform === IOS && \"Alert--ios\",\n          platform === VKCOM && \"Alert--vkcom\",\n          resolvedActionsLayout === \"vertical\" ? \"Alert--v\" : \"Alert--h\",\n          closing && \"Alert--closing\",\n          isDesktop && \"Alert--desktop\"\n        )}\n        role=\"alertdialog\"\n        aria-modal\n        aria-labelledby=\"vkui--alert--title\"\n        aria-describedby=\"vkui--alert--desc\"\n      >\n        <div vkuiClass=\"Alert__content\">\n          {hasReactNode(header) && (\n            <AlertHeader id=\"vkui--alert--title\">{header}</AlertHeader>\n          )}\n          {hasReactNode(text) && (\n            <AlertText id=\"vkui--alert--desc\">{text}</AlertText>\n          )}\n          {children}\n        </div>\n        <div vkuiClass=\"Alert__actions\">\n          {actions.map((action, i) => (\n            <AlertAction key={i} action={action} onItemClick={onItemClick} />\n          ))}\n        </div>\n        {canShowCloseButton && (\n          <ModalDismissButton onClick={close} aria-label={dismissLabel} />\n        )}\n      </FocusTrap>\n    </PopoutWrapper>\n  );\n};\n"],"file":"Alert.js"}