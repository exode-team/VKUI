{"version":3,"file":"Alert.js","names":["AlertHeader","props","platform","usePlatform","IOS","AlertText","VKCOM","AlertAction","action","onItemClick","restProps","useAdaptivity","viewWidth","handleItemClick","React","useCallback","Component","href","classNames","mode","target","title","ViewWidth","DESKTOP","Alert","actions","actionsLayout","children","className","style","text","header","onClose","dismissLabel","useWaitTransitionFinish","waitTransitionFinish","useState","closing","setClosing","elementRef","useRef","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","timeout","close","current","e","propertyName","item","autoclose","useScrollLock","stopPropagation","hasReactNode","map","i"],"sources":["../../../../src/components/Alert/Alert.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Tappable } from \"../Tappable/Tappable\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { classNames } from \"../../lib/classNames\";\nimport { VKCOM, IOS } from \"../../lib/platform\";\nimport { ViewWidth } from \"../../hoc/withAdaptivity\";\nimport { Button, ButtonProps } from \"../Button/Button\";\nimport { hasReactNode, stopPropagation } from \"../../lib/utils\";\nimport { Title } from \"../Typography/Title/Title\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { Text } from \"../Typography/Text/Text\";\nimport { ModalDismissButton } from \"../ModalDismissButton/ModalDismissButton\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport { useWaitTransitionFinish } from \"../../hooks/useWaitTransitionFinish\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport \"./Alert.css\";\n\nexport type AlertActionInterface = AlertAction &\n  React.AnchorHTMLAttributes<HTMLElement>;\n\nexport interface AlertAction extends Pick<ButtonProps, \"Component\" | \"href\"> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: \"cancel\" | \"destructive\" | \"default\";\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement> {\n  actionsLayout?: \"vertical\" | \"horizontal\";\n  actions?: AlertAction[];\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n\n  /**\n   * `aria-label` для кнопки закрытия. Необходим, чтобы кнопка была доступной.\n   */\n  dismissLabel?: string;\n}\n\ntype ItemClickHandler = (item: AlertActionInterface) => void;\n\ninterface AlertTypography {\n  id: string;\n  children?: React.ReactNode;\n}\n\nconst AlertHeader = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case IOS:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"1\" level=\"3\" {...props} />\n      );\n    default:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"2\" level=\"2\" {...props} />\n      );\n  }\n};\n\nconst AlertText = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case VKCOM:\n      return <Caption vkuiClass=\"Alert__text\" {...props} />;\n    case IOS:\n      return <Caption vkuiClass=\"Alert__text\" level=\"2\" {...props} />;\n    default:\n      return (\n        <Text Component=\"span\" vkuiClass=\"Alert__text\" weight=\"3\" {...props} />\n      );\n  }\n};\n\ninterface AlertActionProps {\n  action: AlertActionInterface;\n  onItemClick: ItemClickHandler;\n}\n\nconst AlertAction = ({\n  action,\n  onItemClick,\n  ...restProps\n}: AlertActionProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const handleItemClick = React.useCallback(\n    () => onItemClick(action),\n    [onItemClick, action]\n  );\n\n  if (platform === IOS) {\n    const { Component = \"button\" } = action;\n    return (\n      <Tappable\n        Component={action.href ? \"a\" : Component}\n        vkuiClass={classNames(\"Alert__action\", `Alert__action--${action.mode}`)}\n        onClick={handleItemClick}\n        href={action.href}\n        target={action.target}\n        {...restProps}\n      >\n        {action.title}\n      </Tappable>\n    );\n  }\n\n  let mode: ButtonProps[\"mode\"] = \"tertiary\";\n\n  // TODO v5.0.0 поправить под новую адаптивность\n  if (viewWidth === ViewWidth.DESKTOP && action.mode === \"destructive\") {\n    mode = \"destructive\";\n  }\n\n  if (platform === VKCOM) {\n    mode = action.mode === \"cancel\" ? \"secondary\" : \"primary\";\n  }\n\n  return (\n    <Button\n      vkuiClass={classNames(\"Alert__button\", `Alert__button--${action.mode}`)}\n      mode={mode}\n      size=\"m\"\n      onClick={handleItemClick}\n      Component={action.Component}\n      href={action.href}\n      target={action.target}\n    >\n      {action.title}\n    </Button>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Alert\n */\nexport const Alert = ({\n  actions = [],\n  actionsLayout = \"horizontal\",\n  children,\n  className,\n  style,\n  text,\n  header,\n  onClose,\n  dismissLabel = \"Закрыть предупреждение\",\n  ...restProps\n}: AlertProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const resolvedActionsLayout: AlertProps[\"actionsLayout\"] =\n    platform === VKCOM ? \"horizontal\" : actionsLayout;\n  const canShowCloseButton =\n    platform !== IOS && viewWidth >= ViewWidth.SMALL_TABLET;\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET; // TODO v5.0.0 поправить под новую адаптивность\n\n  const timeout = platform === IOS ? 300 : 200;\n\n  const close = React.useCallback(() => {\n    setClosing(true);\n    waitTransitionFinish(\n      elementRef.current,\n      (e?: TransitionEvent) => {\n        if (!e || e.propertyName === \"opacity\") {\n          onClose && onClose();\n        }\n      },\n      timeout\n    );\n  }, [elementRef, waitTransitionFinish, onClose, timeout]);\n\n  const onItemClick: ItemClickHandler = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action, autoclose } = item;\n\n      if (autoclose) {\n        setClosing(true);\n        waitTransitionFinish(\n          elementRef.current,\n          (e?: TransitionEvent) => {\n            if (!e || e.propertyName === \"opacity\") {\n              onClose && onClose();\n              action && action();\n            }\n          },\n          timeout\n        );\n      } else {\n        action && action();\n      }\n    },\n    [elementRef, waitTransitionFinish, onClose, timeout]\n  );\n\n  useScrollLock();\n\n  return (\n    <PopoutWrapper\n      className={className}\n      closing={closing}\n      style={style}\n      onClick={close}\n    >\n      <FocusTrap\n        {...restProps}\n        getRootRef={elementRef}\n        onClick={stopPropagation}\n        onClose={close}\n        timeout={timeout}\n        vkuiClass={classNames(\n          \"Alert\",\n          platform === IOS && \"Alert--ios\",\n          platform === VKCOM && \"Alert--vkcom\",\n          resolvedActionsLayout === \"vertical\" ? \"Alert--v\" : \"Alert--h\",\n          closing && \"Alert--closing\",\n          isDesktop && \"Alert--desktop\"\n        )}\n        role=\"alertdialog\"\n        aria-modal\n        aria-labelledby=\"vkui--alert--title\"\n        aria-describedby=\"vkui--alert--desc\"\n      >\n        <div vkuiClass=\"Alert__content\">\n          {hasReactNode(header) && (\n            <AlertHeader id=\"vkui--alert--title\">{header}</AlertHeader>\n          )}\n          {hasReactNode(text) && (\n            <AlertText id=\"vkui--alert--desc\">{text}</AlertText>\n          )}\n          {children}\n        </div>\n        <div vkuiClass=\"Alert__actions\">\n          {actions.map((action, i) => (\n            <AlertAction key={i} action={action} onItemClick={onItemClick} />\n          ))}\n        </div>\n        {canShowCloseButton && (\n          <ModalDismissButton onClick={close} aria-label={dismissLabel} />\n        )}\n      </FocusTrap>\n    </PopoutWrapper>\n  );\n};\n"],"mappings":"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"}