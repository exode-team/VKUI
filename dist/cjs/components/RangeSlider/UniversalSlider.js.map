{"version":3,"file":"UniversalSlider.js","names":["UniversalSliderDumb","min","max","step","value","defaultValue","onChange","getRootRef","sizeY","disabled","restProps","start","end","isRange","gesture","React","useRef","dragging","startX","containerWidth","current","container","useExternRef","thumbStart","thumbEnd","offsetToValue","absolute","rescale","updateRange","nextValue","snapDirection","pos","target","Math","abs","onStart","e","boundingRect","getBoundingClientRect","width","absolutePosition","left","originalEvent","stopPropagation","onMove","shiftX","preventDefault","onEnd","toPercent","v","draggerStyle","join","classNames","UniversalSlider","withAdaptivity","displayName"],"sources":["../../../../src/components/RangeSlider/UniversalSlider.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Touch, TouchEvent, TouchEventHandler } from \"../Touch/Touch\";\nimport { classNames } from \"../../lib/classNames\";\nimport { HasRootRef } from \"../../types\";\nimport { rescale } from \"../../helpers/math\";\nimport { withAdaptivity, AdaptivityProps } from \"../../hoc/withAdaptivity\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport \"../Slider/Slider.css\";\n\nexport type UniversalValue = [number | null, number];\n\nexport interface UniversalSliderProps<Value>\n  extends HasRootRef<HTMLDivElement>,\n    Omit<\n      React.HTMLAttributes<HTMLDivElement>,\n      \"value\" | \"defaultValue\" | \"onChange\"\n    >,\n    AdaptivityProps {\n  min?: number;\n  max?: number;\n  step?: number;\n  value?: Value;\n  defaultValue?: Value;\n  disabled?: boolean;\n  onChange?(value: Value, e: TouchEvent): void;\n}\n\nconst UniversalSliderDumb = ({\n  min = 0,\n  max = 100,\n  step,\n  value = [0, 0],\n  defaultValue,\n  onChange,\n  getRootRef,\n  sizeY,\n  disabled,\n  ...restProps\n}: UniversalSliderProps<UniversalValue>) => {\n  const [start, end] = value;\n  const isRange = start != null;\n  const gesture = React.useRef({\n    dragging: false as false | \"start\" | \"end\",\n    startX: 0,\n    containerWidth: 0,\n  }).current;\n  const container = useExternRef(getRootRef);\n  const thumbStart = React.useRef<HTMLDivElement>(null);\n  const thumbEnd = React.useRef<HTMLDivElement>(null);\n\n  const offsetToValue = (absolute: number) => {\n    return rescale(absolute, [0, gesture.containerWidth], [min, max], { step });\n  };\n\n  const updateRange = (nextValue: number): UniversalValue => {\n    if (start == null) {\n      return [null, nextValue];\n    }\n\n    const { dragging } = gesture;\n    if (dragging === \"start\") {\n      if (nextValue > end) {\n        // \"перехватиться\", если перетянули за конец\n        gesture.dragging = \"end\";\n        return [end, nextValue];\n      }\n      return [nextValue, end];\n    }\n    if (dragging === \"end\") {\n      if (nextValue < start) {\n        // \"перехватиться\", если перетянули за начало\n        gesture.dragging = \"start\";\n        return [nextValue, start];\n      }\n      return [start, nextValue];\n    }\n\n    return value;\n  };\n\n  const snapDirection = (pos: number, target: EventTarget | null) => {\n    if (target === thumbStart.current) {\n      return \"start\";\n    }\n    if (target === thumbEnd.current) {\n      return \"end\";\n    }\n    return Math.abs((start ?? 0) - pos) <= Math.abs(end - pos)\n      ? \"start\"\n      : \"end\";\n  };\n\n  const onStart: TouchEventHandler = (e: TouchEvent) => {\n    const boundingRect = container.current?.getBoundingClientRect();\n    gesture.containerWidth = boundingRect?.width ?? 0;\n\n    const absolutePosition = e.startX - (boundingRect?.left ?? 0);\n    const pos = offsetToValue(absolutePosition);\n    gesture.dragging = snapDirection(pos, e.originalEvent.target);\n    gesture.startX = absolutePosition;\n\n    onChange?.(updateRange(pos), e);\n    e.originalEvent.stopPropagation();\n  };\n\n  const onMove: TouchEventHandler = (e: TouchEvent) => {\n    onChange?.(updateRange(offsetToValue(gesture.startX + (e.shiftX || 0))), e);\n\n    e.originalEvent.stopPropagation();\n    e.originalEvent.preventDefault();\n  };\n\n  const onEnd: TouchEventHandler = (e) => {\n    gesture.dragging = false;\n    e.originalEvent.stopPropagation();\n  };\n\n  const toPercent = (v: number) => ((v - min) / (max - min)) * 100;\n  const draggerStyle = isRange\n    ? {\n        width: `${toPercent(end) - toPercent(start ?? 0)}%`,\n        left: `${toPercent(start ?? 0)}%`,\n      }\n    : {\n        width: `${toPercent(end)}%`,\n      };\n\n  return (\n    <Touch\n      data-value={isRange ? value.join(\",\") : value}\n      {...restProps}\n      {...(disabled ? {} : { onStart, onMove, onEnd })}\n      vkuiClass={classNames(\n        \"Slider\",\n        `Slider--sizeY-${sizeY}`,\n        disabled && \"Slider--disabled\"\n      )}\n    >\n      <div ref={container} vkuiClass=\"Slider__in\">\n        <div vkuiClass=\"Slider__dragger\" style={draggerStyle}>\n          {isRange && (\n            <span\n              vkuiClass={classNames(\"Slider__thumb\", \"Slider__thumb--start\")}\n              ref={thumbStart}\n            />\n          )}\n          <span\n            vkuiClass={classNames(\"Slider__thumb\", \"Slider__thumb--end\")}\n            ref={thumbEnd}\n          />\n        </div>\n      </div>\n    </Touch>\n  );\n};\n\nexport const UniversalSlider = withAdaptivity(UniversalSliderDumb, {\n  sizeY: true,\n});\n\nUniversalSlider.displayName = \"UniversalSlider\";\n"],"mappings":"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"}