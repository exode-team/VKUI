{"version":3,"sources":["../../../../src/components/PanelHeaderContext/PanelHeaderContext.tsx"],"names":["PanelHeaderContext","children","onClose","opened","restProps","document","platform","React","useState","visible","setVisible","closing","viewWidth","isDesktop","ViewWidth","SMALL_TABLET","elementRef","useRef","event","current","contains","target","stopPropagation","capture","onAnimationEnd","animationFallback","useEffect","set","clear","IOS","undefined"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AASA;AACA;AACA;AACO,IAAMA,kBAAkB,GAAG,SAArBA,kBAAqB,OAKH;AAAA,MAJ7BC,QAI6B,QAJ7BA,QAI6B;AAAA,MAH7BC,OAG6B,QAH7BA,OAG6B;AAAA,yBAF7BC,MAE6B;AAAA,MAF7BA,MAE6B,4BAFpB,KAEoB;AAAA,MAD1BC,SAC0B;;AAC7B,gBAAqB,kBAArB;AAAA,MAAQC,QAAR,WAAQA,QAAR;;AACA,MAAMC,QAAQ,GAAG,+BAAjB;;AACA,wBAA8BC,KAAK,CAACC,QAAN,CAAeL,MAAf,CAA9B;AAAA;AAAA,MAAOM,OAAP;AAAA,MAAgBC,UAAhB;;AACA,MAAMC,OAAO,GAAGF,OAAO,IAAI,CAACN,MAA5B;;AACA,uBAAsB,oCAAtB;AAAA,MAAQS,SAAR,kBAAQA,SAAR;;AACA,MAAMC,SAAS,GAAGD,SAAS,IAAIE,6BAAUC,YAAzC;AACA,MAAMC,UAAU,GAAGT,KAAK,CAACU,MAAN,CAA6B,IAA7B,CAAnB;AAEA,4DAA0B,YAAM;AAC9Bd,IAAAA,MAAM,IAAIO,UAAU,CAAC,IAAD,CAApB;AACD,GAFD,EAEG,CAACP,MAAD,CAFH;AAIA,oCAAc,CAACU,SAAD,IAAcV,MAA5B,EAb6B,CAe7B;;AACA,sDACEE,QADF,EAEE,OAFF,EAGEQ,SAAS,IACPV,MADF,IAEE,CAACQ,OAFH,IAGG,UAACO,KAAD,EAAW;AACV,QACEF,UAAU,CAACG,OAAX,IACA,CAACH,UAAU,CAACG,OAAX,CAAmBC,QAAnB,CAA4BF,KAAK,CAACG,MAAlC,CAFH,EAGE;AACAH,MAAAA,KAAK,CAACI,eAAN;AACApB,MAAAA,OAAO;AACR;AACF,GAdL,EAeE;AAAEqB,IAAAA,OAAO,EAAE;AAAX,GAfF,EAhB6B,CAkC7B;;AACA,MAAMC,cAAc,GAAG,SAAjBA,cAAiB;AAAA,WAAMd,UAAU,CAAC,KAAD,CAAhB;AAAA,GAAvB;;AACA,MAAMe,iBAAiB,GAAG,4BAAWD,cAAX,EAA2B,GAA3B,CAA1B;AACAjB,EAAAA,KAAK,CAACmB,SAAN,CACE;AAAA,WAAOf,OAAO,GAAGc,iBAAiB,CAACE,GAAlB,EAAH,GAA6BF,iBAAiB,CAACG,KAAlB,EAA3C;AAAA,GADF,EAEE,CAACH,iBAAD,EAAoBd,OAApB,CAFF;AAKA,SACE,qCAAC,wBAAD,6BACMP,SADN;AAEE,IAAA,SAAS,EAAE,4BACT,oBADS,EAETE,QAAQ,KAAKuB,aAAb,IAAoB,yBAFX,EAGT1B,MAAM,IAAI,4BAHD,EAITQ,OAAO,IAAI,6BAJF,EAKTE,SAAS,IAAI,6BALJ,EAMT;AACA,KAACP,QAAQ,KAAKuB,aAAb,IAAqBvB,QAAQ,KAAKuB,aAAb,IAAoBhB,SAA1C,KACE,6BARO,CAFb;AAYE,IAAA,QAAQ,EAAC;AAZX,MAcE;AACE,IAAA,SAAS,EAAC,wBADZ;AAEE,IAAA,GAAG,EAAEG,UAFP;AAGE,IAAA,cAAc,EAAEL,OAAO,GAAGa,cAAH,GAAoBM;AAH7C,KAKE;AAAK,IAAA,SAAS,EAAC;AAAf,KAA8CrB,OAAO,IAAIR,QAAzD,CALF,CAdF,EAqBG,CAACY,SAAD,IAAcJ,OAAd,IACC;AAAK,IAAA,OAAO,EAAEP,OAAd;AAAuB,IAAA,SAAS,EAAC;AAAjC,IAtBJ,CADF;AA2BD,CA1EM","sourcesContent":["import * as React from \"react\";\nimport { FixedLayout } from \"../FixedLayout/FixedLayout\";\nimport { classNames } from \"../../lib/classNames\";\nimport { ViewWidth } from \"../AdaptivityProvider/AdaptivityContext\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useDOM } from \"../../lib/dom\";\nimport { IOS } from \"../../lib/platform\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport \"./PanelHeaderContext.css\";\n\nexport interface PanelHeaderContextProps\n  extends React.HTMLAttributes<HTMLDivElement> {\n  opened: boolean;\n  onClose: VoidFunction;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PanelHeaderContext\n */\nexport const PanelHeaderContext = ({\n  children,\n  onClose,\n  opened = false,\n  ...restProps\n}: PanelHeaderContextProps) => {\n  const { document } = useDOM();\n  const platform = usePlatform();\n  const [visible, setVisible] = React.useState(opened);\n  const closing = visible && !opened;\n  const { viewWidth } = useAdaptivity();\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    opened && setVisible(true);\n  }, [opened]);\n\n  useScrollLock(!isDesktop && opened);\n\n  // start closing on outer click\n  useGlobalEventListener(\n    document,\n    \"click\",\n    isDesktop &&\n      opened &&\n      !closing &&\n      ((event) => {\n        if (\n          elementRef.current &&\n          !elementRef.current.contains(event.target as Node)\n        ) {\n          event.stopPropagation();\n          onClose();\n        }\n      }),\n    { capture: true }\n  );\n\n  // fallback onAnimationEnd when animationend not supported\n  const onAnimationEnd = () => setVisible(false);\n  const animationFallback = useTimeout(onAnimationEnd, 200);\n  React.useEffect(\n    () => (closing ? animationFallback.set() : animationFallback.clear()),\n    [animationFallback, closing]\n  );\n\n  return (\n    <FixedLayout\n      {...restProps}\n      vkuiClass={classNames(\n        \"PanelHeaderContext\",\n        platform === IOS && \"PanelHeaderContext--ios\",\n        opened && \"PanelHeaderContext--opened\",\n        closing && \"PanelHeaderContext--closing\",\n        isDesktop && \"PanelHeaderContext--desktop\",\n        // TODO v5.0.0 поправить под новую адаптивность\n        (platform !== IOS || (platform === IOS && isDesktop)) &&\n          \"PanelHeaderContext--rounded\"\n      )}\n      vertical=\"top\"\n    >\n      <div\n        vkuiClass=\"PanelHeaderContext__in\"\n        ref={elementRef}\n        onAnimationEnd={closing ? onAnimationEnd : undefined}\n      >\n        <div vkuiClass=\"PanelHeaderContext__content\">{visible && children}</div>\n      </div>\n      {!isDesktop && visible && (\n        <div onClick={onClose} vkuiClass=\"PanelHeaderContext__fade\" />\n      )}\n    </FixedLayout>\n  );\n};\n"],"file":"PanelHeaderContext.js"}