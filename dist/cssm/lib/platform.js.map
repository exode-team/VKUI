{"version":3,"file":"platform.js","names":["computeBrowserInfo","querystring","canUseDOM","Platform","PLATFORM_ALIAS","desktop_web","VKCOM","isPlatformAlias","platformAlias","getPlatformByQueryString","queryString","parsedQuery","parse","platformAliasByQuery","undefined","e","console","warn","platformByQueryString","location","search","ANDROID","IOS","platform","browserInfo","system","platformName","IS_PLATFORM_IOS","IS_PLATFORM_ANDROID"],"sources":["../../../src/lib/platform.ts"],"sourcesContent":["import { BrowserInfo, computeBrowserInfo } from \"./browser\";\nimport { querystring } from \"@vkontakte/vkjs\";\nimport { canUseDOM } from \"./dom\";\n\nexport enum Platform {\n  ANDROID = \"android\",\n  IOS = \"ios\",\n  VKCOM = \"vkcom\",\n}\n\nconst PLATFORM_ALIAS = {\n  desktop_web: Platform.VKCOM,\n};\n\nfunction isPlatformAlias(\n  platformAlias: string\n): platformAlias is keyof typeof PLATFORM_ALIAS {\n  return platformAlias in PLATFORM_ALIAS;\n}\n\n/**\n * Значение, которое передаётся в качестве query-параметра при открытии VK Mini Apps\n * @see {@link https://dev.vk.com/mini-apps/development/launch-params#vk_platform vk_platform}\n */\nfunction getPlatformByQueryString(queryString: string): Platform | undefined {\n  try {\n    const parsedQuery = querystring.parse(queryString);\n    const platformAliasByQuery = parsedQuery[\"vk_platform\"];\n\n    return typeof platformAliasByQuery === \"string\" &&\n      isPlatformAlias(platformAliasByQuery)\n      ? PLATFORM_ALIAS[platformAliasByQuery]\n      : undefined;\n  } catch (e) {\n    console.warn(e);\n\n    return undefined;\n  }\n}\n\nconst platformByQueryString = canUseDOM\n  ? getPlatformByQueryString(location.search)\n  : undefined;\n\nexport const ANDROID = Platform.ANDROID;\nexport const IOS = Platform.IOS;\nexport const VKCOM = Platform.VKCOM;\n\nexport type PlatformType =\n  | Platform.ANDROID\n  | Platform.IOS\n  | Platform.VKCOM\n  | string;\n\nexport function platform(browserInfo?: BrowserInfo): PlatformType {\n  if (platformByQueryString) {\n    return platformByQueryString;\n  }\n\n  if (!browserInfo) {\n    browserInfo = computeBrowserInfo();\n  }\n\n  return browserInfo.system === \"ios\" ? IOS : ANDROID;\n}\n\nconst platformName = platform();\n\n/**\n * @deprecated для определения платформы используйте withPlatform или usePlatform\n */\nexport const IS_PLATFORM_IOS: boolean = platformName === IOS;\n/**\n * @deprecated для определения платформы используйте withPlatform или usePlatform\n */\nexport const IS_PLATFORM_ANDROID: boolean = platformName === ANDROID;\n"],"mappings":"AAAA,SAAsBA,kBAAkB;AACxC,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,SAAS;AAElB,WAAYC,QAAQ;AAInB,WAJWA,QAAQ;EAARA,QAAQ;EAARA,QAAQ;EAARA,QAAQ;AAAA,GAARA,QAAQ,KAARA,QAAQ;AAMpB,IAAMC,cAAc,GAAG;EACrBC,WAAW,EAAEF,QAAQ,CAACG;AACxB,CAAC;AAED,SAASC,eAAe,CACtBC,aAAqB,EACyB;EAC9C,OAAOA,aAAa,IAAIJ,cAAc;AACxC;;AAEA;AACA;AACA;AACA;AACA,SAASK,wBAAwB,CAACC,WAAmB,EAAwB;EAC3E,IAAI;IACF,IAAMC,WAAW,GAAGV,WAAW,CAACW,KAAK,CAACF,WAAW,CAAC;IAClD,IAAMG,oBAAoB,GAAGF,WAAW,CAAC,aAAa,CAAC;IAEvD,OAAO,OAAOE,oBAAoB,KAAK,QAAQ,IAC7CN,eAAe,CAACM,oBAAoB,CAAC,GACnCT,cAAc,CAACS,oBAAoB,CAAC,GACpCC,SAAS;EACf,CAAC,CAAC,OAAOC,CAAC,EAAE;IACVC,OAAO,CAACC,IAAI,CAACF,CAAC,CAAC;IAEf,OAAOD,SAAS;EAClB;AACF;AAEA,IAAMI,qBAAqB,GAAGhB,SAAS,GACnCO,wBAAwB,CAACU,QAAQ,CAACC,MAAM,CAAC,GACzCN,SAAS;AAEb,OAAO,IAAMO,OAAO,GAAGlB,QAAQ,CAACkB,OAAO;AACvC,OAAO,IAAMC,GAAG,GAAGnB,QAAQ,CAACmB,GAAG;AAC/B,OAAO,IAAMhB,KAAK,GAAGH,QAAQ,CAACG,KAAK;AAQnC,OAAO,SAASiB,QAAQ,CAACC,WAAyB,EAAgB;EAChE,IAAIN,qBAAqB,EAAE;IACzB,OAAOA,qBAAqB;EAC9B;EAEA,IAAI,CAACM,WAAW,EAAE;IAChBA,WAAW,GAAGxB,kBAAkB,EAAE;EACpC;EAEA,OAAOwB,WAAW,CAACC,MAAM,KAAK,KAAK,GAAGH,GAAG,GAAGD,OAAO;AACrD;AAEA,IAAMK,YAAY,GAAGH,QAAQ,EAAE;;AAE/B;AACA;AACA;AACA,OAAO,IAAMI,eAAwB,GAAGD,YAAY,KAAKJ,GAAG;AAC5D;AACA;AACA;AACA,OAAO,IAAMM,mBAA4B,GAAGF,YAAY,KAAKL,OAAO"}