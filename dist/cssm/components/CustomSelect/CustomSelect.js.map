{"version":3,"file":"CustomSelect.js","names":["React","SelectMimicry","debounce","multiRef","getTitleFromChildren","classNames","withAdaptivity","CustomSelectOption","Input","DropdownIcon","Caption","warnOnce","defaultFilterFn","getFormFieldModeFromSelectType","CustomSelectDropdown","SelectType","useIsomorphicLayoutEffect","findIndexAfter","options","startIndex","length","findIndex","option","i","disabled","findIndexBefore","endIndex","result","warn","checkOptionsValueType","Set","map","item","value","size","defaultRenderOptionFn","props","handleOptionDown","e","preventDefault","findSelectedIndex","Number","filter","inputValue","filterFn","defaultOptions","CustomSelectComponent","useState","initialOpenState","opened","setOpened","before","name","className","getRef","getRootRef","popupDirection","sizeY","platform","style","onChange","children","onInputChangeProp","onInputChange","renderDropdown","onOpen","onClose","fetching","forceDropdownPortal","forcePlacement","selectType","default","autoHideScrollbar","autoHideScrollbarDelay","searchable","forceOpened","renderOption","renderOptionProp","optionsProp","emptyText","icon","dropdownOffsetDistance","fixDropdownWidth","restProps","process","env","NODE_ENV","containerRef","useRef","scrollBoxRef","selectElRef","focusedOptionIndex","setFocusedOptionIndex","undefined","isControlledOutside","setIsControlledOutside","setInputValue","defaultValue","nativeSelectValue","setNativeSelectValue","keyboardInput","setKeyboardInput","popperPlacement","setPopperPlacement","setOptions","selectedOptionIndex","setSelectedOptionIndex","useEffect","some","event","Event","bubbles","current","dispatchEvent","selected","useMemo","openedClassNames","includes","resetKeyboardInput","useCallback","scrollToElement","index","center","dropdown","dropdownHeight","offsetHeight","scrollTop","itemTop","offsetTop","itemHeight","isValidIndex","focusOptionByIndex","scrollTo","areOptionsShown","onKeyboardInput","key","fullInput","optionIndex","label","toLowerCase","close","selectFocused","open","onBlur","resetFocusedOption","onFocus","onClick","handleKeyUp","focusOption","type","nextIndex","beforeIndex","onLabelClick","contains","target","onNativeSelectChange","newSelectedOptionIndex","currentTarget","onInputKeyDown","handleKeyDownSelect","handleOptionClick","Array","prototype","indexOf","call","parentNode","handleOptionHover","hovered","onMouseDown","onMouseOver","resolvedContent","defaultDropdownContent","placeholder","CustomSelect"],"sources":["../../../../src/components/CustomSelect/CustomSelect.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { SelectMimicry } from \"../SelectMimicry/SelectMimicry\";\nimport { debounce, multiRef, getTitleFromChildren } from \"../../lib/utils\";\nimport { classNames } from \"../../lib/classNames\";\nimport { NativeSelectProps } from \"../NativeSelect/NativeSelect\";\nimport { withAdaptivity } from \"../../hoc/withAdaptivity\";\nimport {\n  CustomSelectOption,\n  CustomSelectOptionProps,\n} from \"../CustomSelectOption/CustomSelectOption\";\nimport { FormFieldProps } from \"../FormField/FormField\";\nimport { HasPlatform } from \"../../types\";\nimport { Input } from \"../Input/Input\";\nimport { DropdownIcon } from \"../DropdownIcon/DropdownIcon\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport {\n  defaultFilterFn,\n  getFormFieldModeFromSelectType,\n} from \"../../lib/select\";\nimport { Placement } from \"../Popper/Popper\";\nimport { CustomSelectDropdown } from \"../CustomSelectDropdown/CustomSelectDropdown\";\nimport { TrackerOptionsProps } from \"../CustomScrollView/useTrackerVisibility\";\nimport { SelectType } from \"../Select/Select\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport \"./CustomSelect.css\";\n\nconst findIndexAfter = (\n  options: CustomSelectOptionInterface[] = [],\n  startIndex = -1\n) => {\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n  return options.findIndex((option, i) => i > startIndex && !option.disabled);\n};\n\nconst findIndexBefore = (\n  options: CustomSelectOptionInterface[] = [],\n  endIndex: number = options.length\n) => {\n  let result = -1;\n  if (endIndex <= 0) {\n    return result;\n  }\n  for (let i = endIndex - 1; i >= 0; i--) {\n    let option = options[i];\n\n    if (!option.disabled) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n};\n\nconst warn = warnOnce(\"CustomSelect\");\n\nconst checkOptionsValueType = (options: CustomSelectOptionInterface[]) => {\n  if (new Set(options.map((item) => typeof item.value)).size > 1) {\n    warn(\n      \"Некоторые значения ваших опций имеют разные типы. onChange всегда возвращает строковый тип.\",\n      \"error\"\n    );\n  }\n};\n\nfunction defaultRenderOptionFn({\n  option,\n  ...props\n}: CustomSelectOptionProps): React.ReactNode {\n  return <CustomSelectOption {...props} />;\n}\n\nconst handleOptionDown: MouseEventHandler = (\n  e: React.MouseEvent<HTMLElement>\n) => {\n  e.preventDefault();\n};\n\nfunction findSelectedIndex(\n  options: CustomSelectOptionInterface[],\n  value: SelectValue\n) {\n  return (\n    options.findIndex((item) => {\n      value = typeof item.value === \"number\" ? Number(value) : value;\n      return item.value === value;\n    }) ?? -1\n  );\n}\n\nconst filter = (\n  options: CustomSelectProps[\"options\"],\n  inputValue: string,\n  filterFn: CustomSelectProps[\"filterFn\"]\n) => {\n  return typeof filterFn === \"function\"\n    ? options.filter((option) => filterFn(inputValue, option))\n    : options;\n};\n\nconst defaultOptions: CustomSelectOptionInterface[] = [];\n\ntype SelectValue = React.SelectHTMLAttributes<HTMLSelectElement>[\"value\"];\n\nexport interface CustomSelectOptionInterface {\n  value: SelectValue;\n  label: React.ReactElement | string;\n  disabled?: boolean;\n  [index: string]: any;\n}\n\nexport interface CustomSelectProps\n  extends NativeSelectProps,\n    HasPlatform,\n    FormFieldProps,\n    TrackerOptionsProps {\n  /**\n   * Если `true`, то при клике на селект в нём появится текстовое поле для поиска по `options`. По умолчанию поиск\n   * производится по `option.label`.\n   */\n  searchable?: boolean;\n  /**\n   * Текст, который будет отображен, если приходит пустой `options`.\n   */\n  emptyText?: string;\n  onInputChange?: (\n    e: React.ChangeEvent,\n    options: CustomSelectOptionInterface[]\n  ) => void | CustomSelectOptionInterface[];\n  options: CustomSelectOptionInterface[];\n  /**\n   * Функция для кастомной фильтрации. По умолчанию поиск производится по `option.label`.\n   */\n  filterFn?:\n    | false\n    | ((\n        value: string,\n        option: CustomSelectOptionInterface,\n        getOptionLabel?: (\n          option: Partial<CustomSelectOptionInterface>\n        ) => string\n      ) => boolean);\n  popupDirection?: \"top\" | \"bottom\";\n  /**\n   * Рендер-проп для кастомного рендера опции.\n   * В объекте аргумента приходят [свойства опции](https://vkcom.github.io/VKUI/#/CustomSelectOption?id=props)\n   */\n  renderOption?: (props: CustomSelectOptionProps) => React.ReactNode;\n  /**\n   * Рендер-проп для кастомного рендера содержимого дропдауна.\n   * В `defaultDropdownContent` содержится список опций в виде скроллящегося блока.\n   */\n  renderDropdown?: ({\n    defaultDropdownContent,\n  }: {\n    defaultDropdownContent: React.ReactNode;\n  }) => React.ReactNode;\n  /**\n   * Если `true`, то в дропдауне вместо списка опций рисуется спиннер. При переданных `renderDropdown` и `fetching: true`\n   * \"победит\" `renderDropdown`.\n   */\n  fetching?: boolean;\n  onClose?: VoidFunction;\n  onOpen?: VoidFunction;\n  icon?: React.ReactNode;\n  dropdownOffsetDistance?: number;\n  fixDropdownWidth?: boolean;\n  forceDropdownPortal?: boolean;\n  initialOpenState?: boolean;\n  forceOpened?: boolean;\n  forcePlacement?: Placement;\n  selectType?: keyof typeof SelectType;\n}\n\ntype MouseEventHandler = (event: React.MouseEvent<HTMLElement>) => void;\n\nfunction CustomSelectComponent(props: CustomSelectProps) {\n  const [opened, setOpened] = React.useState(props.initialOpenState || false);\n  const {\n    before,\n    name,\n    className,\n    getRef,\n    getRootRef,\n    popupDirection,\n    sizeY,\n    platform,\n    style,\n    onChange,\n    children,\n    onInputChange: onInputChangeProp,\n    renderDropdown,\n    onOpen,\n    onClose,\n    fetching,\n    forceDropdownPortal,\n    forcePlacement,\n    selectType = SelectType.default,\n    autoHideScrollbar,\n    autoHideScrollbarDelay,\n    searchable = false,\n    forceOpened = false,\n    renderOption: renderOptionProp = defaultRenderOptionFn,\n    options: optionsProp = defaultOptions,\n    emptyText = \"Ничего не найдено\",\n    filterFn = defaultFilterFn,\n    icon = <DropdownIcon opened={opened} />,\n    dropdownOffsetDistance = 0,\n    fixDropdownWidth = true,\n    ...restProps\n  } = props;\n\n  if (process.env.NODE_ENV === \"development\") {\n    checkOptionsValueType(optionsProp);\n  }\n\n  const containerRef = React.useRef<HTMLLabelElement>(null);\n  const scrollBoxRef = React.useRef<HTMLDivElement>(null);\n  const selectElRef = React.useRef<HTMLSelectElement>(null);\n\n  const [focusedOptionIndex, setFocusedOptionIndex] = React.useState<\n    number | undefined\n  >(-1);\n  const [isControlledOutside, setIsControlledOutside] = React.useState(\n    props.value !== undefined\n  );\n  const [inputValue, setInputValue] = React.useState(\"\");\n  const [nativeSelectValue, setNativeSelectValue] = React.useState(\n    props.value ?? props.defaultValue\n  );\n  const [keyboardInput, setKeyboardInput] = React.useState(\"\");\n  const [popperPlacement, setPopperPlacement] = React.useState<\n    Placement | undefined\n  >(undefined);\n  const [options, setOptions] = React.useState(optionsProp);\n  const [selectedOptionIndex, setSelectedOptionIndex] = React.useState<\n    number | undefined\n  >(findSelectedIndex(optionsProp, props.value ?? props.defaultValue));\n\n  React.useEffect(() => {\n    setIsControlledOutside(props.value !== undefined);\n    setNativeSelectValue(\n      (nativeSelectValue) => props.value ?? nativeSelectValue\n    );\n  }, [props.value]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (options.some(({ value }) => nativeSelectValue === value)) {\n      const event = new Event(\"change\", { bubbles: true });\n\n      selectElRef.current?.dispatchEvent(event);\n    }\n  }, [nativeSelectValue]);\n\n  const selected = React.useMemo(() => {\n    if (!options.length) {\n      return null;\n    }\n\n    return selectedOptionIndex !== undefined\n      ? options[selectedOptionIndex]\n      : undefined;\n  }, [options, selectedOptionIndex]);\n\n  const openedClassNames = React.useMemo(\n      () =>\n          classNames(\n              opened && \"Select--open\",\n              opened &&\n              dropdownOffsetDistance === 0 &&\n              (popperPlacement?.includes(\"top\")\n                  ? \"Select--pop-up\"\n                  : \"Select--pop-down\")\n          ),\n      [dropdownOffsetDistance, opened, popperPlacement]\n  );\n\n  const resetKeyboardInput = React.useCallback(() => {\n    setKeyboardInput(\"\");\n  }, []);\n\n  const scrollToElement = React.useCallback((index: number, center = false) => {\n    const dropdown = scrollBoxRef.current;\n    const item = dropdown ? (dropdown.children[index] as HTMLElement) : null;\n\n    if (!item || !dropdown) {\n      return;\n    }\n\n    const dropdownHeight = dropdown.offsetHeight;\n    const scrollTop = dropdown.scrollTop;\n    const itemTop = item.offsetTop;\n    const itemHeight = item.offsetHeight;\n\n    if (center) {\n      dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n      dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n    } else if (itemTop < scrollTop) {\n      dropdown.scrollTop = itemTop;\n    }\n  }, []);\n\n  const isValidIndex = React.useCallback(\n    (index: number) => {\n      return index >= 0 && index < (options.length ?? 0);\n    },\n    [options.length]\n  );\n\n  const focusOptionByIndex = React.useCallback(\n    (index: number | undefined, scrollTo = true) => {\n      if (\n        index === undefined ||\n        index < 0 ||\n        index > (options.length ?? 0) - 1\n      ) {\n        return;\n      }\n\n      const option = options[index];\n\n      if (option?.disabled) {\n        return;\n      }\n\n      if (scrollTo) {\n        scrollToElement(index);\n      }\n\n      // Это оптимизация, прежде всего, под `onMouseOver`\n      setFocusedOptionIndex((focusedOptionIndex) =>\n        focusedOptionIndex !== index ? index : focusedOptionIndex\n      );\n    },\n    [options, scrollToElement]\n  );\n\n  const areOptionsShown = React.useCallback(() => {\n    return scrollBoxRef.current !== null;\n  }, []);\n\n  const onKeyboardInput = React.useCallback(\n    (key: string) => {\n      const fullInput = keyboardInput + key;\n\n      const optionIndex = options.findIndex((option) => {\n        return getTitleFromChildren(option.label)\n          .toLowerCase()\n          .includes(fullInput);\n      });\n\n      if (optionIndex !== undefined && optionIndex > -1) {\n        focusOptionByIndex(optionIndex);\n      }\n\n      setKeyboardInput(fullInput);\n    },\n    [focusOptionByIndex, keyboardInput, options]\n  );\n\n  const close = React.useCallback(() => {\n    resetKeyboardInput();\n\n    setInputValue(\"\");\n    setOpened(false);\n    setFocusedOptionIndex(-1);\n    setOptions(optionsProp);\n    onClose?.();\n  }, [onClose, optionsProp, resetKeyboardInput]);\n\n  const selectFocused = React.useCallback(() => {\n    if (focusedOptionIndex !== undefined && isValidIndex(focusedOptionIndex)) {\n      const item = options[focusedOptionIndex];\n\n      setNativeSelectValue(item?.value);\n      close();\n    }\n  }, [close, focusedOptionIndex, isValidIndex, options]);\n\n  const open = React.useCallback(() => {\n    setOpened(true);\n    setFocusedOptionIndex(selectedOptionIndex);\n\n    if (typeof onOpen === \"function\") {\n      onOpen();\n    }\n  }, [onOpen, selectedOptionIndex]);\n\n  React.useEffect(() => {\n    if (\n      opened &&\n      selectedOptionIndex !== undefined &&\n      isValidIndex(selectedOptionIndex)\n    ) {\n      scrollToElement(selectedOptionIndex, true);\n    }\n  }, [isValidIndex, opened, scrollToElement, selectedOptionIndex]);\n\n  const onBlur = React.useCallback(() => {\n    close();\n    const event = new Event(\"blur\");\n    selectElRef.current?.dispatchEvent(event);\n  }, [close]);\n\n  const resetFocusedOption = React.useCallback(() => {\n    setFocusedOptionIndex(-1);\n  }, []);\n\n  const onFocus = React.useCallback(() => {\n    const event = new Event(\"focus\");\n    selectElRef.current?.dispatchEvent(event);\n  }, []);\n\n  const onClick = React.useCallback(() => {\n    if (opened) {\n      close();\n    } else {\n      open();\n    }\n  }, [close, open, opened]);\n\n  const handleKeyUp = React.useMemo(\n    () => debounce(resetKeyboardInput, 1000),\n    [resetKeyboardInput]\n  );\n\n  const focusOption = React.useCallback(\n    (type: \"next\" | \"prev\") => {\n      let index = focusedOptionIndex;\n\n      if (type === \"next\") {\n        const nextIndex = findIndexAfter(options, index);\n        index = nextIndex === -1 ? findIndexAfter(options) : nextIndex; // Следующий за index или первый валидный до index\n      } else if (type === \"prev\") {\n        const beforeIndex = findIndexBefore(options, index);\n        index = beforeIndex === -1 ? findIndexBefore(options) : beforeIndex; // Предшествующий index или последний валидный после index\n      }\n\n      focusOptionByIndex(index);\n    },\n    [focusOptionByIndex, focusedOptionIndex, options]\n  );\n\n  React.useEffect(() => {\n    const value = props.value ?? nativeSelectValue ?? props.defaultValue;\n\n    const options =\n      searchable && inputValue !== undefined\n        ? filter(optionsProp, inputValue, filterFn)\n        : optionsProp;\n\n    setOptions(options);\n    setSelectedOptionIndex(findSelectedIndex(options, value));\n  }, [\n    filterFn,\n    inputValue,\n    nativeSelectValue,\n    optionsProp,\n    props.defaultValue,\n    props.value,\n    searchable,\n  ]);\n\n  /**\n   * Нужен для правильного поведения обработчика onClick на select. Фильтрует клики, которые были сделаны по\n   * выпадающему списку.\n   */\n  const onLabelClick = React.useCallback(\n    (e: React.MouseEvent<HTMLLabelElement>) => {\n      if (scrollBoxRef.current?.contains(e.target as Node)) {\n        e.preventDefault();\n      }\n    },\n    []\n  );\n\n  const onNativeSelectChange: React.ChangeEventHandler<HTMLSelectElement> =\n    React.useCallback(\n      (e) => {\n        const newSelectedOptionIndex = findSelectedIndex(\n          options,\n          e.currentTarget.value\n        );\n\n        if (selectedOptionIndex !== newSelectedOptionIndex) {\n          if (!isControlledOutside) {\n            setSelectedOptionIndex(newSelectedOptionIndex);\n          }\n          onChange?.(e);\n        }\n      },\n      [isControlledOutside, onChange, options, selectedOptionIndex]\n    );\n\n  const onInputKeyDown: React.KeyboardEventHandler<HTMLInputElement> =\n    React.useCallback(\n      (event) => {\n        [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) &&\n          areOptionsShown() &&\n          event.preventDefault();\n\n        switch (event.key) {\n          case \"ArrowUp\":\n            areOptionsShown() && focusOption(\"prev\");\n            break;\n          case \"ArrowDown\":\n            areOptionsShown() && focusOption(\"next\");\n            break;\n          case \"Escape\":\n            close();\n            break;\n          case \"Enter\":\n            areOptionsShown() && selectFocused();\n            break;\n        }\n      },\n      [areOptionsShown, close, focusOption, selectFocused]\n    );\n\n  const onInputChange: React.ChangeEventHandler<HTMLInputElement> =\n    React.useCallback(\n      (e) => {\n        if (onInputChangeProp) {\n          const options = onInputChangeProp(e, optionsProp);\n          if (options) {\n            if (process.env.NODE_ENV === \"development\") {\n              warn(\n                \"Этот метод фильтрации устарел. Возвращаемое значение onInputChange будет \" +\n                  \"проигнорировано в v5.0.0. Для фильтрации обновляйте props.options самостоятельно или используйте свойство filterFn.\"\n              );\n            }\n            setOptions(options);\n            setSelectedOptionIndex(\n              findSelectedIndex(options, nativeSelectValue)\n            );\n          }\n        } else {\n          const options = filter(optionsProp, e.target.value, filterFn);\n          setOptions(options);\n          setSelectedOptionIndex(findSelectedIndex(options, nativeSelectValue));\n        }\n        setInputValue(e.target.value);\n      },\n      [filterFn, nativeSelectValue, onInputChangeProp, optionsProp]\n    );\n\n  const handleKeyDownSelect = React.useCallback(\n    (event: React.KeyboardEvent) => {\n      if (event.key.length === 1 && event.key !== \" \") {\n        onKeyboardInput(event.key);\n        return;\n      }\n\n      [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) &&\n        areOptionsShown() &&\n        event.preventDefault();\n\n      switch (event.key) {\n        case \"ArrowUp\":\n          if (opened) {\n            areOptionsShown() && focusOption(\"prev\");\n          } else {\n            open();\n          }\n          break;\n        case \"ArrowDown\":\n          if (opened) {\n            areOptionsShown() && focusOption(\"next\");\n          } else {\n            open();\n          }\n          break;\n        case \"Escape\":\n          close();\n          break;\n        case \"Enter\":\n        case \"Spacebar\":\n        case \" \":\n          if (opened) {\n            areOptionsShown() && selectFocused();\n          } else {\n            open();\n          }\n          break;\n      }\n    },\n    [\n      areOptionsShown,\n      close,\n      focusOption,\n      onKeyboardInput,\n      open,\n      opened,\n      selectFocused,\n    ]\n  );\n\n  const handleOptionClick = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      const index = Array.prototype.indexOf.call(\n        e.currentTarget.parentNode?.children,\n        e.currentTarget\n      );\n      const option = options[index];\n\n      if (option && !option.disabled) {\n        selectFocused();\n      }\n    },\n    [options, selectFocused]\n  );\n\n  const handleOptionHover = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      focusOptionByIndex(\n        Array.prototype.indexOf.call(\n          e.currentTarget.parentNode?.children,\n          e.currentTarget\n        ),\n        false\n      );\n    },\n    [focusOptionByIndex]\n  );\n\n  const renderOption = React.useCallback(\n    (option: CustomSelectOptionInterface, index: number) => {\n      const hovered = index === focusedOptionIndex;\n      const selected = index === selectedOptionIndex;\n\n      return (\n        <React.Fragment key={`${option.value}`}>\n          {renderOptionProp({\n            option,\n            hovered,\n            value: option.value,\n            children: option.label,\n            selected,\n            disabled: option.disabled,\n            onClick: handleOptionClick,\n            onMouseDown: handleOptionDown,\n            // Используем `onMouseOver` вместо `onMouseEnter`.\n            // При параметре `searchable`, обновляется \"ребёнок\", из-за чего `onMouseEnter` не срабатывает в следующих кейсах:\n            //  1. До загрузки выпадающего списка, курсор мышки находится над произвольным элементом этого списка.\n            //     > Лечение: только увод курсора мыши и возвращении его обратно вызывает событие `onMouseEnter` на этот элемент.\n            //  2. Если это тач-устройство.\n            //     > Лечение: нужно нажать на какой-нибудь произвольный элемент списка, после чего `onMouseEnter` будет работать на соседние элементы,\n            //     но не на тот, на который нажали в первый раз.\n            // Более подробно по ссылке https://github.com/facebook/react/issues/13956#issuecomment-1082055744\n            onMouseOver: handleOptionHover,\n          })}\n        </React.Fragment>\n      );\n    },\n    [\n      focusedOptionIndex,\n      handleOptionClick,\n      handleOptionHover,\n      renderOptionProp,\n      selectedOptionIndex,\n    ]\n  );\n\n  const resolvedContent = React.useMemo(() => {\n    const defaultDropdownContent =\n      options?.length > 0 ? (\n        options.map(renderOption)\n      ) : (\n        <Caption vkuiClass=\"CustomSelect__empty\">{emptyText}</Caption>\n      );\n\n    if (typeof renderDropdown === \"function\") {\n      return renderDropdown({ defaultDropdownContent });\n    } else {\n      return defaultDropdownContent;\n    }\n  }, [emptyText, options, renderDropdown, renderOption]);\n\n  return (\n    <label\n      vkuiClass=\"CustomSelect\"\n      className={className}\n      style={style}\n      ref={multiRef(containerRef, getRootRef)}\n      onClick={onLabelClick}\n      data-placement={popperPlacement}\n    >\n      {opened && searchable ? (\n        <Input\n          {...restProps}\n          autoFocus\n          onBlur={onBlur}\n          vkuiClass={openedClassNames}\n          value={inputValue}\n          onKeyDown={onInputKeyDown}\n          onChange={onInputChange}\n          // TODO Ожидается, что клик поймает нативный select, но его перехватывает Input. К сожалению, это приводит к конфликтам типизации.\n          // TODO Нужно перестать пытаться превратить CustomSelect в select. Тогда эта проблема уйдёт.\n          // @ts-ignore\n          onClick={props.onClick}\n          before={before}\n          after={icon}\n          placeholder={restProps.placeholder}\n          mode={getFormFieldModeFromSelectType(selectType)}\n        />\n      ) : (\n        <SelectMimicry\n          {...restProps}\n          aria-hidden={true}\n          onClick={onClick}\n          onKeyDown={handleKeyDownSelect}\n          onKeyUp={handleKeyUp}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          vkuiClass={openedClassNames}\n          before={before}\n          after={icon}\n          selectType={selectType}\n        >\n          {selected?.label}\n        </SelectMimicry>\n      )}\n      <select\n        ref={selectElRef}\n        name={name}\n        onChange={onNativeSelectChange}\n        onBlur={props.onBlur}\n        onFocus={props.onFocus}\n        onClick={props.onClick}\n        value={nativeSelectValue}\n        aria-hidden={true}\n        vkuiClass=\"CustomSelect__control\"\n      >\n        {optionsProp.map((item) => (\n          <option key={`${item.value}`} value={item.value} />\n        ))}\n      </select>\n      {(opened || forceOpened) && (\n        <CustomSelectDropdown\n          targetRef={containerRef}\n          placement={popupDirection}\n          scrollBoxRef={scrollBoxRef}\n          forcePlacement={forcePlacement}\n          data-test=\"custom-select:dropdown\"\n          data-placement={popperPlacement}\n          onPlacementChange={setPopperPlacement}\n          onMouseLeave={resetFocusedOption}\n          fetching={fetching}\n          offsetDistance={dropdownOffsetDistance}\n          sameWidth={fixDropdownWidth}\n          forcePortal={forceDropdownPortal}\n          autoHideScrollbar={autoHideScrollbar}\n          autoHideScrollbarDelay={autoHideScrollbarDelay}\n          observableRefs={scrollBoxRef}\n        >\n          {resolvedContent}\n        </CustomSelectDropdown>\n      )}\n    </label>\n  );\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/CustomSelect\n */\nexport const CustomSelect = withAdaptivity(CustomSelectComponent, {\n  sizeY: true,\n});\n"],"mappings":"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"}