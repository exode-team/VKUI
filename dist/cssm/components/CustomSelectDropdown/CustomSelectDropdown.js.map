{"version":3,"file":"CustomSelectDropdown.js","names":["React","CustomScrollView","classNames","Popper","Spinner","useIsomorphicLayoutEffect","noop","calcIsTop","placement","includes","getObserverModifier","element","name","enabled","phase","fn","effect","instance","observer","MutationObserver","forceUpdate","observe","childList","subtree","disconnect","CustomSelectDropdown","children","targetRef","scrollBoxRef","forcePlacement","fetching","parentOnPlacementChange","onPlacementChange","offsetDistance","sameWidth","forcePortal","autoHideScrollbar","autoHideScrollbarDelay","observableRefs","restProps","useState","isTop","setIsTop","customModifiers","setCustomModifiers","Array","isArray","ref","current","push","useCallback"],"sources":["../../../../src/components/CustomSelectDropdown/CustomSelectDropdown.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Modifier } from \"react-popper\";\nimport { CustomScrollView } from \"../CustomScrollView/CustomScrollView\";\nimport { TrackerOptionsProps } from \"../CustomScrollView/useTrackerVisibility\";\nimport { classNames } from \"../../lib/classNames\";\nimport { Popper, Placement } from \"../Popper/Popper\";\nimport { Spinner } from \"../Spinner/Spinner\";\nimport { HasRef } from \"../../types\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { noop } from \"../../lib/utils\";\nimport \"./CustomSelectDropdown.css\";\n\nexport interface CustomSelectDropdownProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasRef<HTMLDivElement>,\n    TrackerOptionsProps {\n  targetRef: React.RefObject<HTMLElement>;\n  placement?: Placement;\n  forcePlacement?: Placement;\n  scrollBoxRef?: React.RefObject<HTMLDivElement>;\n  observableRefs?:\n    | Array<React.RefObject<HTMLElement>>\n    | React.RefObject<HTMLElement>;\n  fetching?: boolean;\n  offsetDistance?: number;\n  sameWidth?: boolean;\n  forcePortal?: boolean;\n  onPlacementChange?: (placement?: Placement) => void;\n}\n\nconst calcIsTop = (placement?: Placement) => placement?.includes(\"top\");\n\nfunction getObserverModifier<T extends HTMLElement>(\n  element: T\n): Modifier<string> {\n  return {\n    name: \"customSelectChildrenChange\",\n    enabled: true,\n    phase: \"main\",\n    fn: noop,\n    effect: ({ instance }) => {\n      const observer = new MutationObserver(instance.forceUpdate);\n\n      observer.observe(element, {\n        childList: true,\n        subtree: true,\n      });\n\n      return () => {\n        observer.disconnect();\n      };\n    },\n  };\n}\n\nexport const CustomSelectDropdown = ({\n  children,\n  targetRef,\n  scrollBoxRef,\n  placement,\n  forcePlacement,\n  fetching,\n  onPlacementChange: parentOnPlacementChange,\n  offsetDistance = 0,\n  sameWidth = true,\n  forcePortal = true,\n  autoHideScrollbar,\n  autoHideScrollbarDelay,\n  observableRefs,\n  ...restProps\n}: CustomSelectDropdownProps) => {\n  const [isTop, setIsTop] = React.useState(() => calcIsTop(placement));\n  const [customModifiers, setCustomModifiers] = React.useState<\n    Array<Modifier<string>>\n  >([]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!observableRefs) {\n      return;\n    }\n    const customModifiers: Array<Modifier<string>> = [];\n\n    if (Array.isArray(observableRefs)) {\n      for (const ref of observableRefs) {\n        if (ref?.current) {\n          customModifiers.push(getObserverModifier(ref.current));\n        }\n      }\n    } else if (observableRefs.current) {\n      customModifiers.push(getObserverModifier(observableRefs.current));\n    }\n\n    setCustomModifiers(customModifiers);\n  }, [observableRefs]);\n\n  const onPlacementChange = React.useCallback(\n    ({ placement }: { placement?: Placement }) => {\n      setIsTop(calcIsTop(forcePlacement || placement));\n      parentOnPlacementChange?.(forcePlacement || placement);\n    },\n    [parentOnPlacementChange, setIsTop]\n  );\n\n  return (\n    <Popper\n      targetRef={targetRef}\n      offsetDistance={offsetDistance}\n      sameWidth={sameWidth}\n      onPlacementChange={onPlacementChange}\n      placement={placement}\n      data-test=\"custom-select-dropdown\"\n      vkuiClass={classNames(\n          \"CustomSelectDropdown\",\n          offsetDistance === 0 &&\n          (isTop\n              ? \"CustomSelectDropdown--top\"\n              : \"CustomSelectDropdown--bottom\"),\n          sameWidth && \"CustomSelectDropdown--wide\"\n      )}\n      forcePortal={forcePortal}\n      customModifiers={customModifiers}\n      {...restProps}\n    >\n      <CustomScrollView\n        boxRef={scrollBoxRef}\n        vkuiClass=\"CustomSelectDropdown__in\"\n        autoHideScrollbar={autoHideScrollbar}\n        autoHideScrollbarDelay={autoHideScrollbarDelay}\n      >\n        {fetching ? (\n          <div vkuiClass=\"CustomSelectDropdown__fetching\">\n            <Spinner size=\"small\" />\n          </div>\n        ) : (\n          children\n        )}\n      </CustomScrollView>\n    </Popper>\n  );\n};\n"],"mappings":"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"}