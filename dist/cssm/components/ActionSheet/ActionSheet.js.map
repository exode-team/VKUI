{"version":3,"file":"ActionSheet.js","names":["React","PopoutWrapper","IOS","ActionSheetDropdownDesktop","ActionSheetDropdown","hasReactNode","noop","ActionSheetContext","Footnote","usePlatform","useTimeout","useAdaptivityIsDesktop","useObjectMemo","warnOnce","useScrollLock","warn","ActionSheet","children","className","header","text","style","iosCloseItem","popupDirection","popupOffsetDistance","restProps","platform","useState","closing","setClosing","onClose","_action","useRef","afterClose","current","process","env","NODE_ENV","isDesktop","timeout","fallbackTransitionFinish","useEffect","set","clear","onItemClick","useCallback","action","immediateAction","autoclose","event","persist","contextValue","DropdownComponent","dropdownProps","Object","assign","actionSheet","undefined"],"sources":["../../../../src/components/ActionSheet/ActionSheet.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { IOS } from \"../../lib/platform\";\nimport { ActionSheetDropdownDesktop } from \"./ActionSheetDropdownDesktop\";\nimport { ActionSheetDropdown } from \"./ActionSheetDropdown\";\nimport { hasReactNode, noop } from \"../../lib/utils\";\nimport { ActionSheetContext, ItemClickHandler } from \"./ActionSheetContext\";\nimport { Footnote } from \"../Typography/Footnote/Footnote\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useAdaptivityIsDesktop } from \"../../hooks/useAdaptivity\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { SharedDropdownProps } from \"./types\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport \"./ActionSheet.css\";\n\nexport interface ActionSheetProps\n  extends Pick<\n      SharedDropdownProps,\n      \"toggleRef\" | \"popupDirection\" | \"popupOffsetDistance\"\n    >,\n    React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи. В v5 будет обязательным.\n   */\n  onClose?: VoidFunction;\n  /**\n   * Только iOS. В v5 будет обязательным.\n   */\n  iosCloseItem?: React.ReactNode;\n}\n\nconst warn = warnOnce(\"ActionSheet\");\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport const ActionSheet = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  popupDirection = \"bottom\",\n  popupOffsetDistance,\n  ...restProps\n}: ActionSheetProps) => {\n  const platform = usePlatform();\n  const [closing, setClosing] = React.useState(false);\n  const onClose = () => setClosing(true);\n  const _action = React.useRef(noop);\n\n  const afterClose = () => {\n    restProps.onClose?.();\n    _action.current();\n    _action.current = noop;\n  };\n\n  if (process.env.NODE_ENV === \"development\" && !restProps.onClose) {\n    warn(\n      `Без свойства \"onClose\" нельзя закрыть ActionSheet по клику вне компонента`,\n      \"error\"\n    );\n  }\n\n  const isDesktop = useAdaptivityIsDesktop();\n\n  useScrollLock(!isDesktop);\n\n  let timeout = platform === IOS ? 300 : 200;\n\n  if (isDesktop) {\n    timeout = 0;\n  }\n\n  const fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(() => {\n    if (closing) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing, fallbackTransitionFinish]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    (action, immediateAction, autoclose) => (event) => {\n      event.persist();\n      immediateAction && immediateAction(event);\n      if (autoclose) {\n        _action.current = () => action && action(event);\n        setClosing(true);\n      } else {\n        action && action(event);\n      }\n    },\n    []\n  );\n  const contextValue = useObjectMemo({ onItemClick, isDesktop });\n\n  const DropdownComponent = isDesktop\n    ? ActionSheetDropdownDesktop\n    : ActionSheetDropdown;\n\n  const dropdownProps = isDesktop\n    ? Object.assign(restProps, { popupOffsetDistance, popupDirection })\n    : restProps;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={closing}\n        timeout={timeout}\n        {...dropdownProps}\n        onClose={onClose}\n        className={isDesktop ? className : undefined}\n        style={isDesktop ? style : undefined}\n      >\n        {(hasReactNode(header) || hasReactNode(text)) && (\n          <header vkuiClass=\"ActionSheet__header\">\n            {hasReactNode(header) && (\n              <Footnote weight=\"2\" vkuiClass=\"ActionSheet__title\">\n                {header}\n              </Footnote>\n            )}\n            {hasReactNode(text) && (\n              <Footnote vkuiClass=\"ActionSheet__text\">{text}</Footnote>\n            )}\n          </header>\n        )}\n        {children}\n        {platform === IOS && !isDesktop && iosCloseItem}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (isDesktop) {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={closing}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onClose}\n      hasMask\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n"],"mappings":"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"}