{"version":3,"sources":["../../../../src/components/ActionSheet/ActionSheet.tsx"],"names":["React","PopoutWrapper","IOS","ActionSheetDropdownDesktop","ActionSheetDropdown","hasReactNode","noop","ActionSheetContext","Footnote","usePlatform","useTimeout","useAdaptivityIsDesktop","useObjectMemo","warnOnce","useScrollLock","warn","ActionSheet","children","className","header","text","style","iosCloseItem","popupDirection","popupOffsetDistance","restProps","platform","useState","closing","setClosing","onClose","_action","useRef","afterClose","current","process","env","NODE_ENV","isDesktop","timeout","fallbackTransitionFinish","useEffect","set","clear","onItemClick","useCallback","action","immediateAction","autoclose","event","persist","contextValue","DropdownComponent","dropdownProps","Object","assign","actionSheet","undefined"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { IOS } from \"../../lib/platform\";\nimport { ActionSheetDropdownDesktop } from \"./ActionSheetDropdownDesktop\";\nimport { ActionSheetDropdown } from \"./ActionSheetDropdown\";\nimport { hasReactNode, noop } from \"../../lib/utils\";\nimport { ActionSheetContext, ItemClickHandler } from \"./ActionSheetContext\";\nimport { Footnote } from \"../Typography/Footnote/Footnote\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useAdaptivityIsDesktop } from \"../../hooks/useAdaptivity\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { SharedDropdownProps } from \"./types\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport \"./ActionSheet.css\";\n\nexport interface ActionSheetProps\n  extends Pick<\n      SharedDropdownProps,\n      \"toggleRef\" | \"popupDirection\" | \"popupOffsetDistance\"\n    >,\n    React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи. В v5 будет обязательным.\n   */\n  onClose?: VoidFunction;\n  /**\n   * Только iOS. В v5 будет обязательным.\n   */\n  iosCloseItem?: React.ReactNode;\n}\n\nconst warn = warnOnce(\"ActionSheet\");\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport const ActionSheet = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  popupDirection = \"bottom\",\n  popupOffsetDistance,\n  ...restProps\n}: ActionSheetProps) => {\n  const platform = usePlatform();\n  const [closing, setClosing] = React.useState(false);\n  const onClose = () => setClosing(true);\n  const _action = React.useRef(noop);\n\n  const afterClose = () => {\n    restProps.onClose?.();\n    _action.current();\n    _action.current = noop;\n  };\n\n  if (process.env.NODE_ENV === \"development\" && !restProps.onClose) {\n    warn(\n      `Без свойства \"onClose\" нельзя закрыть ActionSheet по клику вне компонента`,\n      \"error\"\n    );\n  }\n\n  const isDesktop = useAdaptivityIsDesktop();\n\n  useScrollLock(!isDesktop);\n\n  let timeout = platform === IOS ? 300 : 200;\n\n  if (isDesktop) {\n    timeout = 0;\n  }\n\n  const fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(() => {\n    if (closing) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing, fallbackTransitionFinish]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    (action, immediateAction, autoclose) => (event) => {\n      event.persist();\n      immediateAction && immediateAction(event);\n      if (autoclose) {\n        _action.current = () => action && action(event);\n        setClosing(true);\n      } else {\n        action && action(event);\n      }\n    },\n    []\n  );\n  const contextValue = useObjectMemo({ onItemClick, isDesktop });\n\n  const DropdownComponent = isDesktop\n    ? ActionSheetDropdownDesktop\n    : ActionSheetDropdown;\n\n  const dropdownProps = isDesktop\n    ? Object.assign(restProps, { popupOffsetDistance, popupDirection })\n    : restProps;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={closing}\n        timeout={timeout}\n        {...dropdownProps}\n        onClose={onClose}\n        className={isDesktop ? className : undefined}\n        style={isDesktop ? style : undefined}\n      >\n        {(hasReactNode(header) || hasReactNode(text)) && (\n          <header vkuiClass=\"ActionSheet__header\">\n            {hasReactNode(header) && (\n              <Footnote weight=\"2\" vkuiClass=\"ActionSheet__title\">\n                {header}\n              </Footnote>\n            )}\n            {hasReactNode(text) && (\n              <Footnote vkuiClass=\"ActionSheet__text\">{text}</Footnote>\n            )}\n          </header>\n        )}\n        {children}\n        {platform === IOS && !isDesktop && iosCloseItem}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (isDesktop) {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={closing}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onClose}\n      hasMask\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n"],"file":"ActionSheet.js"}