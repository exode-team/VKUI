{"version":3,"file":"BaseGallery.js","names":["React","classNames","Touch","HorizontalScrollArrow","useExternRef","useDOM","useAdaptivity","useIsomorphicLayoutEffect","useGlobalEventListener","calcMax","calcMin","ANIMATION_DURATION","LAYOUT_DEFAULT_STATE","containerWidth","viewportOffsetWidth","layerWidth","min","max","slides","isFullyVisible","SHIFT_DEFAULT_STATE","animation","undefined","shiftX","dragging","deltaX","indent","BaseGallery","bullets","getRootRef","children","slideWidth","slideIndex","isDraggable","isDraggableProp","onDragStart","onDragEnd","onChange","onPrevClick","onNextClick","onEndProp","onEnd","align","showArrows","getRef","arrowSize","restProps","slidesStore","useRef","layoutState","useState","shiftState","setShiftState","rootRef","viewportRef","window","hasMouse","isCenterWithCustomWidth","validateIndent","value","localMax","current","localMin","calculateIndent","targetIndex","targetSlide","length","coordX","width","viewportWidth","calculateDragIndent","Number","initializeSlides","options","localSlides","Children","map","_item","i","elem","offsetLeft","offsetWidth","localContainerWidth","localViewportOffsetWidth","localLayerWidth","reduce","val","slide","adjustShiftX","prevState","onResize","slideLeft","event","slideRight","getTarget","e","expectDeltaX","duration","shift","direction","item","index","previousValue","Math","abs","currentValue","onStart","onMoveX","originalEvent","preventDefault","isSlideX","isSlide","nextShiftState","shiftXStick","layerStyle","WebkitTransform","transform","WebkitTransition","transition","setSlideRef","slideRef","canSlideLeft","canSlideRight","el"],"sources":["../../../../src/components/BaseGallery/BaseGallery.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { HorizontalScrollArrow } from \"../HorizontalScroll/HorizontalScrollArrow\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { calcMax, calcMin } from \"./helpers\";\nimport {\n  BaseGalleryProps,\n  GallerySlidesState,\n  LayoutState,\n  ShiftingState,\n} from \"./types\";\nimport \"./BaseGallery.css\";\n\nconst ANIMATION_DURATION = 0.24;\n\nconst LAYOUT_DEFAULT_STATE = {\n  containerWidth: 0,\n  viewportOffsetWidth: 0,\n  layerWidth: 0,\n  min: 0,\n  max: 0,\n  slides: [],\n  isFullyVisible: true,\n};\n\nconst SHIFT_DEFAULT_STATE = {\n  animation: undefined,\n  shiftX: 0,\n  dragging: false,\n  deltaX: 0,\n  indent: 0,\n};\n\nexport const BaseGallery = ({\n  bullets = false,\n  getRootRef,\n  children,\n  slideWidth = \"100%\",\n  slideIndex = 0,\n  isDraggable: isDraggableProp = true,\n  onDragStart,\n  onDragEnd,\n  onChange,\n  onPrevClick,\n  onNextClick,\n  onEnd: onEndProp,\n  align = \"left\",\n  showArrows,\n  getRef,\n  arrowSize = \"l\",\n  ...restProps\n}: BaseGalleryProps) => {\n  const slidesStore = React.useRef<Record<string, HTMLDivElement | null>>({});\n  const layoutState = React.useRef<LayoutState>(LAYOUT_DEFAULT_STATE);\n  const [shiftState, setShiftState] =\n    React.useState<ShiftingState>(SHIFT_DEFAULT_STATE);\n\n  const rootRef = useExternRef(getRootRef);\n  const viewportRef = useExternRef(getRef);\n\n  const { window } = useDOM();\n  const { hasMouse } = useAdaptivity();\n\n  const isCenterWithCustomWidth = slideWidth === \"custom\" && align === \"center\";\n\n  const validateIndent = (value: number) => {\n    const localMax = layoutState.current.max ?? 0;\n    const localMin = layoutState.current.min ?? 0;\n\n    if (value < localMin) {\n      return localMin;\n    } else if (value > localMax) {\n      return localMax;\n    }\n\n    return value;\n  };\n\n  /*\n   * Считает отступ слоя галереи\n   */\n  const calculateIndent = (targetIndex: number) => {\n    if (layoutState.current.isFullyVisible) {\n      return 0;\n    }\n\n    const targetSlide = layoutState.current.slides?.length\n      ? layoutState.current.slides[targetIndex]\n      : null;\n\n    if (targetSlide) {\n      const { coordX, width } = targetSlide;\n\n      if (isCenterWithCustomWidth) {\n        const viewportWidth = layoutState.current.viewportOffsetWidth ?? 0;\n        return viewportWidth / 2 - coordX - width / 2;\n      }\n\n      return validateIndent(-1 * coordX);\n    }\n\n    return 0;\n  };\n\n  /*\n   * Считает отступ слоя галереи во время драга\n   */\n  const calculateDragIndent = () => {\n    const localMax = layoutState.current.max ?? 0;\n    const localMin = layoutState.current.min ?? 0;\n    const indent = shiftState.shiftX + shiftState.deltaX;\n\n    if (indent > localMax) {\n      return localMax + Number((indent - localMax) / 3);\n    } else if (indent < localMin) {\n      return localMin + Number((indent - localMin) / 3);\n    }\n\n    return indent;\n  };\n\n  const initializeSlides = (options: { animation?: boolean } = {}) => {\n    const localSlides =\n      React.Children.map(\n        children,\n        (_item: React.ReactNode, i: number): GallerySlidesState => {\n          const elem = slidesStore.current[`slide-${i}`];\n          return {\n            coordX: elem?.offsetLeft ?? 0,\n            width: elem?.offsetWidth ?? 0,\n          };\n        }\n      ) ?? [];\n\n    const localContainerWidth = rootRef.current?.offsetWidth ?? 0;\n    const localViewportOffsetWidth = viewportRef.current?.offsetWidth ?? 0;\n    const localLayerWidth = localSlides.reduce(\n      (val: number, slide: GallerySlidesState) => slide.width + val,\n      0\n    );\n    const adjustShiftX =\n      localSlides.length <= layoutState.current.slides.length ||\n      layoutState.current.slides[slideIndex]?.coordX !==\n        localSlides[slideIndex]?.coordX;\n\n    layoutState.current = {\n      containerWidth: localContainerWidth,\n      viewportOffsetWidth: localViewportOffsetWidth,\n      layerWidth: localLayerWidth,\n      max: calcMax({\n        slides: localSlides,\n        viewportOffsetWidth: localViewportOffsetWidth,\n        isCenterWithCustomWidth,\n      }),\n      min: calcMin({\n        containerWidth: localContainerWidth,\n        layerWidth: localLayerWidth,\n        slides: localSlides,\n        viewportOffsetWidth: localViewportOffsetWidth,\n        isCenterWithCustomWidth,\n        align,\n      }),\n      slides: localSlides,\n      isFullyVisible: localLayerWidth <= localContainerWidth,\n    };\n\n    setShiftState((prevState) => ({\n      ...prevState,\n      shiftX: adjustShiftX ? calculateIndent(slideIndex) : prevState.shiftX,\n      animation:\n        options.animation ??\n        prevState.shiftX === validateIndent(prevState.shiftX),\n    }));\n  };\n\n  const onResize = () => {\n    if (shiftState.animation !== undefined) {\n      initializeSlides({ animation: false });\n    }\n  };\n\n  useGlobalEventListener(window, \"resize\", onResize);\n\n  useIsomorphicLayoutEffect(() => {\n    initializeSlides({ animation: false });\n  }, [children, align, slideWidth]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (shiftState.animation !== undefined) {\n      setShiftState((prevState) => ({\n        ...prevState,\n        animation: true,\n        deltaX: 0,\n        shiftX: calculateIndent(slideIndex ?? 0),\n      }));\n    }\n  }, [slideIndex]);\n\n  const slideLeft = (event: React.MouseEvent) => {\n    onChange?.(slideIndex - 1);\n    onPrevClick?.(event);\n  };\n\n  const slideRight = (event: React.MouseEvent) => {\n    onChange?.(slideIndex + 1);\n    onNextClick?.(event);\n  };\n\n  /*\n   * Получает индекс слайда, к которому будет осуществлен переход\n   */\n  const getTarget = (e: TouchEvent) => {\n    const expectDeltaX = (shiftState.deltaX / e.duration) * 240 * 0.6;\n    const shift =\n      shiftState.shiftX +\n      shiftState.deltaX +\n      expectDeltaX -\n      (layoutState.current.max ?? 0);\n    const direction = shiftState.deltaX < 0 ? 1 : -1;\n\n    // Находим ближайшую границу слайда к текущему отступу\n    let targetIndex = layoutState.current.slides.reduce(\n      (val: number, item: GallerySlidesState, index: number) => {\n        const previousValue = Math.abs(\n          layoutState.current.slides[val].coordX + shift\n        );\n        const currentValue = Math.abs(item.coordX + shift);\n\n        return previousValue < currentValue ? val : index;\n      },\n      slideIndex\n    );\n\n    if (targetIndex === slideIndex) {\n      let targetSlide = slideIndex + direction;\n\n      if (targetSlide >= 0 && targetSlide < layoutState.current.slides.length) {\n        if (\n          Math.abs(shiftState.deltaX) >\n          layoutState.current.slides[targetSlide].width * 0.05\n        ) {\n          targetIndex = targetSlide;\n        }\n      }\n    }\n\n    return targetIndex;\n  };\n\n  const onStart = () => {\n    setShiftState((prevState) => ({ ...prevState, animation: false }));\n  };\n\n  const onMoveX = (e: TouchEvent) => {\n    if (isDraggableProp && !layoutState.current.isFullyVisible) {\n      e.originalEvent.preventDefault();\n\n      if (e.isSlideX) {\n        // TODO исправить в рамках issue #2698\n        onDragStart?.(e);\n\n        if (shiftState.deltaX !== e.shiftX) {\n          setShiftState((prevState) => ({\n            ...prevState,\n            deltaX: e.shiftX,\n            dragging: e.isSlideX,\n          }));\n        }\n      }\n    }\n  };\n\n  const onEnd = (e: TouchEvent) => {\n    const targetIndex = e.isSlide ? getTarget(e) : slideIndex ?? 0;\n    onDragEnd?.(e);\n\n    const nextShiftState: Partial<ShiftingState> = {\n      animation: true,\n      dragging: false,\n      deltaX: 0,\n    };\n\n    const shiftXStick = calculateDragIndent();\n    if (targetIndex !== slideIndex) {\n      // Сохраняем сдвиг слайда в том положении, в каком его оставили после драга (fix issue #2185)\n      nextShiftState.shiftX = shiftXStick;\n    }\n\n    setShiftState((prevState) => ({ ...prevState, ...nextShiftState }));\n    if (targetIndex !== slideIndex) {\n      onChange?.(targetIndex);\n    }\n\n    // TODO исправить в рамках issue #2698\n    onEndProp?.({ targetIndex });\n  };\n\n  const indent = shiftState.dragging\n    ? calculateDragIndent()\n    : shiftState.shiftX;\n\n  const layerStyle = {\n    WebkitTransform: `translateX(${indent}px)`,\n    transform: `translateX(${indent}px)`,\n    WebkitTransition: shiftState.animation\n      ? `-webkit-transform ${ANIMATION_DURATION}s cubic-bezier(.1, 0, .25, 1)`\n      : \"none\",\n    transition: shiftState.animation\n      ? `transform ${ANIMATION_DURATION}s cubic-bezier(.1, 0, .25, 1)`\n      : \"none\",\n  };\n\n  const setSlideRef = (slideRef: HTMLDivElement | null, slideIndex: number) => {\n    slidesStore.current[`slide-${slideIndex}`] = slideRef;\n  };\n\n  // shiftX is negative number <= 0, we can swipe back only if it is < 0\n  const canSlideLeft =\n    !layoutState.current.isFullyVisible && shiftState.shiftX < 0;\n\n  const canSlideRight =\n    !layoutState.current.isFullyVisible &&\n    // we can't move right when gallery layer fully scrolled right, if gallery aligned by left side\n    ((align === \"left\" &&\n      layoutState.current.containerWidth - shiftState.shiftX <\n        (layoutState.current.layerWidth ?? 0)) ||\n      // otherwise we need to check current slide index (align = right or align = center)\n      (align !== \"left\" && slideIndex < layoutState.current.slides.length - 1));\n\n  const isDraggable = isDraggableProp && !layoutState.current.isFullyVisible;\n\n  return (\n    <div\n      {...restProps}\n      vkuiClass={classNames(\n        \"Gallery\",\n        `Gallery--${align}`,\n        shiftState.dragging && \"Gallery--dragging\",\n        isDraggable && \"Gallery--draggable\",\n        slideWidth === \"custom\" && \"Gallery--custom-width\"\n      )}\n      ref={rootRef}\n    >\n      <Touch\n        vkuiClass=\"Gallery__viewport\"\n        onStartX={onStart}\n        onMoveX={onMoveX}\n        onEnd={onEnd}\n        style={{ width: slideWidth === \"custom\" ? \"100%\" : slideWidth }}\n        getRootRef={viewportRef}\n        noSlideClick\n      >\n        <div vkuiClass=\"Gallery__layer\" style={layerStyle}>\n          {React.Children.map(children, (item: React.ReactNode, i: number) => (\n            <div\n              vkuiClass=\"Gallery__slide\"\n              key={`slide-${i}`}\n              ref={(el) => setSlideRef(el, i)}\n            >\n              {item}\n            </div>\n          ))}\n        </div>\n      </Touch>\n\n      {bullets && (\n        <div\n          aria-hidden=\"true\"\n          vkuiClass={classNames(\n            \"Gallery__bullets\",\n            `Gallery__bullets--${bullets}`\n          )}\n        >\n          {React.Children.map(\n            children,\n            (_item: React.ReactNode, index: number) => (\n              <div\n                vkuiClass={classNames(\n                  \"Gallery__bullet\",\n                  index === slideIndex && \"Gallery__bullet--active\"\n                )}\n                key={index}\n              />\n            )\n          )}\n        </div>\n      )}\n\n      {showArrows && hasMouse && canSlideLeft && (\n        <HorizontalScrollArrow\n          direction=\"left\"\n          onClick={slideLeft}\n          size={arrowSize}\n        />\n      )}\n      {showArrows && hasMouse && canSlideRight && (\n        <HorizontalScrollArrow\n          direction=\"right\"\n          onClick={slideRight}\n          size={arrowSize}\n        />\n      )}\n    </div>\n  );\n};\n"],"mappings":"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"}