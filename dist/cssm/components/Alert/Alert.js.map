{"version":3,"file":"Alert.js","names":["React","Tappable","PopoutWrapper","classNames","VKCOM","IOS","ViewWidth","Button","hasReactNode","stopPropagation","Title","Caption","Text","ModalDismissButton","FocusTrap","useScrollLock","useWaitTransitionFinish","usePlatform","useAdaptivity","AlertHeader","props","platform","AlertText","AlertAction","action","onItemClick","restProps","viewWidth","handleItemClick","useCallback","Component","href","mode","target","title","DESKTOP","Alert","actions","actionsLayout","children","className","style","text","header","onClose","dismissLabel","waitTransitionFinish","useState","closing","setClosing","elementRef","useRef","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","timeout","close","current","e","propertyName","item","autoclose","map","i"],"sources":["../../../../src/components/Alert/Alert.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Tappable } from \"../Tappable/Tappable\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { classNames } from \"../../lib/classNames\";\nimport { VKCOM, IOS } from \"../../lib/platform\";\nimport { ViewWidth } from \"../../hoc/withAdaptivity\";\nimport { Button, ButtonProps } from \"../Button/Button\";\nimport { hasReactNode, stopPropagation } from \"../../lib/utils\";\nimport { Title } from \"../Typography/Title/Title\";\nimport { Caption } from \"../Typography/Caption/Caption\";\nimport { Text } from \"../Typography/Text/Text\";\nimport { ModalDismissButton } from \"../ModalDismissButton/ModalDismissButton\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport { useWaitTransitionFinish } from \"../../hooks/useWaitTransitionFinish\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport \"./Alert.css\";\n\nexport type AlertActionInterface = AlertAction &\n  React.AnchorHTMLAttributes<HTMLElement>;\n\nexport interface AlertAction extends Pick<ButtonProps, \"Component\" | \"href\"> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: \"cancel\" | \"destructive\" | \"default\";\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement> {\n  actionsLayout?: \"vertical\" | \"horizontal\";\n  actions?: AlertAction[];\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n\n  /**\n   * `aria-label` для кнопки закрытия. Необходим, чтобы кнопка была доступной.\n   */\n  dismissLabel?: string;\n}\n\ntype ItemClickHandler = (item: AlertActionInterface) => void;\n\ninterface AlertTypography {\n  id: string;\n  children?: React.ReactNode;\n}\n\nconst AlertHeader = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case IOS:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"1\" level=\"3\" {...props} />\n      );\n    default:\n      return (\n        <Title vkuiClass=\"Alert__header\" weight=\"2\" level=\"2\" {...props} />\n      );\n  }\n};\n\nconst AlertText = (props: AlertTypography) => {\n  const platform = usePlatform();\n\n  switch (platform) {\n    case VKCOM:\n      return <Caption vkuiClass=\"Alert__text\" {...props} />;\n    case IOS:\n      return <Caption vkuiClass=\"Alert__text\" level=\"2\" {...props} />;\n    default:\n      return (\n        <Text Component=\"span\" vkuiClass=\"Alert__text\" weight=\"3\" {...props} />\n      );\n  }\n};\n\ninterface AlertActionProps {\n  action: AlertActionInterface;\n  onItemClick: ItemClickHandler;\n}\n\nconst AlertAction = ({\n  action,\n  onItemClick,\n  ...restProps\n}: AlertActionProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const handleItemClick = React.useCallback(\n    () => onItemClick(action),\n    [onItemClick, action]\n  );\n\n  if (platform === IOS) {\n    const { Component = \"button\" } = action;\n    return (\n      <Tappable\n        Component={action.href ? \"a\" : Component}\n        vkuiClass={classNames(\"Alert__action\", `Alert__action--${action.mode}`)}\n        onClick={handleItemClick}\n        href={action.href}\n        target={action.target}\n        {...restProps}\n      >\n        {action.title}\n      </Tappable>\n    );\n  }\n\n  let mode: ButtonProps[\"mode\"] = \"tertiary\";\n\n  // TODO v5.0.0 поправить под новую адаптивность\n  if (viewWidth === ViewWidth.DESKTOP && action.mode === \"destructive\") {\n    mode = \"destructive\";\n  }\n\n  if (platform === VKCOM) {\n    mode = action.mode === \"cancel\" ? \"secondary\" : \"primary\";\n  }\n\n  return (\n    <Button\n      vkuiClass={classNames(\"Alert__button\", `Alert__button--${action.mode}`)}\n      mode={mode}\n      size=\"m\"\n      onClick={handleItemClick}\n      Component={action.Component}\n      href={action.href}\n      target={action.target}\n    >\n      {action.title}\n    </Button>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Alert\n */\nexport const Alert = ({\n  actions = [],\n  actionsLayout = \"horizontal\",\n  children,\n  className,\n  style,\n  text,\n  header,\n  onClose,\n  dismissLabel = \"Закрыть предупреждение\",\n  ...restProps\n}: AlertProps) => {\n  const platform = usePlatform();\n  const { viewWidth } = useAdaptivity();\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  const resolvedActionsLayout: AlertProps[\"actionsLayout\"] =\n    platform === VKCOM ? \"horizontal\" : actionsLayout;\n  const canShowCloseButton =\n    platform !== IOS && viewWidth >= ViewWidth.SMALL_TABLET;\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET; // TODO v5.0.0 поправить под новую адаптивность\n\n  const timeout = platform === IOS ? 300 : 200;\n\n  const close = React.useCallback(() => {\n    setClosing(true);\n    waitTransitionFinish(\n      elementRef.current,\n      (e?: TransitionEvent) => {\n        if (!e || e.propertyName === \"opacity\") {\n          onClose && onClose();\n        }\n      },\n      timeout\n    );\n  }, [elementRef, waitTransitionFinish, onClose, timeout]);\n\n  const onItemClick: ItemClickHandler = React.useCallback(\n    (item: AlertActionInterface) => {\n      const { action, autoclose } = item;\n\n      if (autoclose) {\n        setClosing(true);\n        waitTransitionFinish(\n          elementRef.current,\n          (e?: TransitionEvent) => {\n            if (!e || e.propertyName === \"opacity\") {\n              onClose && onClose();\n              action && action();\n            }\n          },\n          timeout\n        );\n      } else {\n        action && action();\n      }\n    },\n    [elementRef, waitTransitionFinish, onClose, timeout]\n  );\n\n  useScrollLock();\n\n  return (\n    <PopoutWrapper\n      className={className}\n      closing={closing}\n      style={style}\n      onClick={close}\n    >\n      <FocusTrap\n        {...restProps}\n        getRootRef={elementRef}\n        onClick={stopPropagation}\n        onClose={close}\n        timeout={timeout}\n        vkuiClass={classNames(\n          \"Alert\",\n          platform === IOS && \"Alert--ios\",\n          platform === VKCOM && \"Alert--vkcom\",\n          resolvedActionsLayout === \"vertical\" ? \"Alert--v\" : \"Alert--h\",\n          closing && \"Alert--closing\",\n          isDesktop && \"Alert--desktop\"\n        )}\n        role=\"alertdialog\"\n        aria-modal\n        aria-labelledby=\"vkui--alert--title\"\n        aria-describedby=\"vkui--alert--desc\"\n      >\n        <div vkuiClass=\"Alert__content\">\n          {hasReactNode(header) && (\n            <AlertHeader id=\"vkui--alert--title\">{header}</AlertHeader>\n          )}\n          {hasReactNode(text) && (\n            <AlertText id=\"vkui--alert--desc\">{text}</AlertText>\n          )}\n          {children}\n        </div>\n        <div vkuiClass=\"Alert__actions\">\n          {actions.map((action, i) => (\n            <AlertAction key={i} action={action} onItemClick={onItemClick} />\n          ))}\n        </div>\n        {canShowCloseButton && (\n          <ModalDismissButton onClick={close} aria-label={dismissLabel} />\n        )}\n      </FocusTrap>\n    </PopoutWrapper>\n  );\n};\n"],"mappings":"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"}