{"version":3,"sources":["../../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"names":["React","hasMouse","_hasMouse","hasHover","_hasHover","AdaptivityContext","SizeType","ViewHeight","ViewWidth","useDOM","useBridgeAdaptivity","DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","useRef","useState","updateAdaptivity","bridge","window","current","calculateAdaptivity","useEffect","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","deviceHasHover","addEventListener","removeEventListener","children","windowWidth","windowHeight","type","viewportWidth","viewportHeight","innerWidth","innerHeight","SMALL_MOBILE","SMALL","REGULAR","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { hasMouse as _hasMouse, hasHover as _hasHover } from \"@vkontakte/vkjs\";\nimport {\n  AdaptivityContext,\n  AdaptivityProps,\n  SizeType,\n  ViewHeight,\n  ViewWidth,\n} from \"./AdaptivityContext\";\nimport { useDOM } from \"../../lib/dom\";\nimport {\n  useBridgeAdaptivity,\n  BridgeAdaptivity,\n} from \"../../hooks/useBridgeAdaptivity\";\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AdaptivityProvider\n */\nconst AdaptivityProvider: React.FC<AdaptivityProps> = (props) => {\n  const adaptivityRef = React.useRef<ReturnType<\n    typeof calculateAdaptivity\n  > | null>(null);\n  const [, updateAdaptivity] = React.useState({});\n  const bridge = useBridgeAdaptivity();\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(props, bridge, window);\n  }\n\n  React.useEffect(() => {\n    function onResize() {\n      if (adaptivityRef.current === null) {\n        return;\n      }\n\n      const calculated = calculateAdaptivity(props, bridge, window);\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover } =\n        adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse ||\n        deviceHasHover !== calculated.deviceHasHover\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window!.addEventListener(\"resize\", onResize, false);\n\n    return () => {\n      window!.removeEventListener(\"resize\", onResize, false);\n    };\n  }, [\n    props.viewWidth,\n    props.viewHeight,\n    props.sizeX,\n    props.sizeY,\n    props.hasMouse,\n    props.deviceHasHover,\n    window,\n    props,\n    bridge,\n  ]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n};\n\nfunction calculateAdaptivity(\n  props: AdaptivityProps,\n  bridge: BridgeAdaptivity,\n  window?: Window\n) {\n  let windowWidth = 0;\n  let windowHeight = 0;\n\n  if (bridge.type === \"adaptive\") {\n    windowWidth = bridge.viewportWidth;\n    windowHeight = bridge.viewportHeight;\n  } else if (window) {\n    windowWidth = window.innerWidth;\n    windowHeight = window.innerHeight;\n  }\n\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = _hasMouse;\n  let deviceHasHover = _hasHover;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  if (!bridge.type) {\n    props.viewWidth && (viewWidth = props.viewWidth);\n    props.viewHeight && (viewHeight = props.viewHeight);\n\n    hasMouse = props.hasMouse ?? hasMouse;\n    deviceHasHover = props.deviceHasHover ?? deviceHasHover;\n  }\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (\n    (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse) ||\n    viewHeight <= ViewHeight.EXTRA_SMALL\n  ) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  if (!bridge.type) {\n    props.sizeX && (sizeX = props.sizeX);\n    props.sizeY && (sizeY = props.sizeY);\n  }\n\n  if (\n    bridge.type === \"force_mobile\" ||\n    bridge.type === \"force_mobile_compact\"\n  ) {\n    viewWidth = ViewWidth.MOBILE;\n    sizeX = SizeType.COMPACT;\n\n    if (bridge.type === \"force_mobile_compact\") {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  }\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover };\n}\n\nexport { AdaptivityProvider };\n"],"file":"AdaptivityProvider.js"}