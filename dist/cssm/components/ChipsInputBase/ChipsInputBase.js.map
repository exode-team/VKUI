{"version":3,"file":"ChipsInputBase.js","names":["React","classNames","Chip","noop","useChipsInput","useAdaptivity","prefixClass","useExternRef","chipsInputDefaultProps","onChange","onInputChange","onKeyDown","onBlur","setOnBlur","addOptionEventKeys","onFocus","value","inputValue","inputAriaLabel","getOptionValue","option","getOptionLabel","label","getNewOptionData","_","renderChip","props","disabled","rest","ChipsInputBase","propsWithDefault","style","className","getRootRef","children","getRef","placeholder","restProps","sizeY","useState","focused","setFocused","fieldValue","addOptionFromInput","removeOption","selectedOptions","handleInputChange","inputRef","isDisabled","readOnly","handleKeyDown","e","preventDefault","key","defaultPrevented","length","includes","handleBlur","handleFocus","handleChipRemove","undefined","handleClick","current","focus","map","onRemove","Boolean"],"sources":["../../../../src/components/ChipsInputBase/ChipsInputBase.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { HasAlign, HasRef, HasRootRef } from \"../../types\";\nimport { classNames } from \"../../lib/classNames\";\nimport { Chip, ChipOption, ChipValue, RenderChip } from \"../Chip/Chip\";\nimport { noop } from \"../../lib/utils\";\nimport { useChipsInput } from \"../../hooks/useChipsInput\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { prefixClass } from \"../../lib/prefixClass\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport \"./ChipsInputBase.css\";\n\nexport interface ChipsInputBaseProps<Option extends ChipOption>\n  extends Omit<\n      React.InputHTMLAttributes<HTMLInputElement>,\n      \"value\" | \"onChange\"\n    >,\n    HasRef<HTMLInputElement>,\n    HasRootRef<HTMLDivElement>,\n    HasAlign {\n  value: Option[];\n  inputValue?: string;\n  setOnBlur?: boolean;\n  addOptionEventKeys?: string[];\n  onChange?: (o: Option[]) => void;\n  onInputChange?: (e?: React.ChangeEvent<HTMLInputElement>) => void;\n  getOptionValue?: (o?: Option) => ChipValue;\n  getOptionLabel?: (o?: Option) => string;\n  getNewOptionData?: (v?: ChipValue, l?: string) => Option;\n  renderChip?: (props?: RenderChip<Option>) => React.ReactNode;\n  inputAriaLabel?: string;\n}\n\nexport const chipsInputDefaultProps: ChipsInputBaseProps<any> = {\n  onChange: noop,\n  onInputChange: noop,\n  onKeyDown: noop,\n  onBlur: noop,\n  setOnBlur: false,\n  addOptionEventKeys: [ 'Enter'],\n  onFocus: noop,\n  value: [],\n  inputValue: \"\",\n  inputAriaLabel: \"Введите ваше значение...\",\n  getOptionValue: (option) => option.value,\n  getOptionLabel: (option) => option.label,\n  getNewOptionData: (_, label) => ({\n    value: label,\n    label,\n  }),\n  renderChip(props) {\n    if (!props) {\n      return null;\n    }\n\n    const { disabled, value, label, ...rest } = props;\n    return (\n      <Chip value={value} removable={!disabled} {...rest}>\n        {label}\n      </Chip>\n    );\n  },\n};\n\nexport const ChipsInputBase = <Option extends ChipOption>(\n  props: ChipsInputBaseProps<Option>\n) => {\n  const propsWithDefault = { ...chipsInputDefaultProps, ...props };\n  const {\n    style,\n    className,\n    getRootRef,\n    value,\n    onChange,\n    onInputChange,\n    onKeyDown,\n    onBlur,\n    setOnBlur,\n    addOptionEventKeys,\n    onFocus,\n    children,\n    inputValue,\n    getRef,\n    placeholder,\n    getOptionValue,\n    getOptionLabel,\n    getNewOptionData,\n    renderChip,\n    inputAriaLabel,\n    ...restProps\n  } = propsWithDefault;\n  const { sizeY } = useAdaptivity();\n\n  const [focused, setFocused] = React.useState(false);\n  const {\n    fieldValue,\n    addOptionFromInput,\n    removeOption,\n    selectedOptions,\n    handleInputChange,\n  } = useChipsInput(propsWithDefault);\n  const inputRef = useExternRef(getRef);\n\n  const isDisabled = restProps.disabled || restProps.readOnly;\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (isDisabled) {\n      e.preventDefault();\n      return;\n    }\n\n    onKeyDown!(e);\n\n    if (\n      e.key === \"Backspace\" &&\n      !e.defaultPrevented &&\n      !fieldValue &&\n      selectedOptions.length\n    ) {\n      removeOption(\n        getOptionValue!(selectedOptions[selectedOptions.length - 1])\n      );\n      e.preventDefault();\n    }\n\n    if (addOptionEventKeys?.includes(e.key) && !e.defaultPrevented && fieldValue) {\n      addOptionFromInput();\n      e.preventDefault();\n    }\n  };\n\n  const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    if (focused) {\n      setFocused(false);\n    }\n    onBlur!(e);\n\n    if (setOnBlur && fieldValue) {\n      addOptionFromInput();\n    }\n  };\n\n  const handleFocus = (e: React.FocusEvent<HTMLInputElement>) => {\n    if (!focused) {\n      setFocused(true);\n    }\n    onFocus!(e);\n  };\n\n  const handleChipRemove = (\n    _: React.MouseEvent | undefined,\n    value: ChipValue | undefined\n  ) => {\n    if (value !== undefined) {\n      removeOption(value);\n    }\n  };\n\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (isDisabled) {\n      e.preventDefault();\n      return;\n    }\n\n    if (inputRef?.current !== null && !focused) {\n      inputRef.current.focus();\n    }\n  };\n\n  return (\n    <div\n      vkuiClass={classNames(\"ChipsInputBase\", `ChipsInputBase--sizeY-${sizeY}`)}\n      onClick={handleClick}\n      role=\"presentation\"\n      style={style}\n      className={className}\n      ref={getRootRef}\n    >\n      {selectedOptions.map((option: Option) => {\n        const value = getOptionValue!(option);\n        const label = getOptionLabel!(option);\n\n        return (\n          <React.Fragment key={`${typeof value}-${value}`}>\n            {renderChip!({\n              option,\n              value,\n              label,\n              onRemove: handleChipRemove,\n              disabled: Boolean(restProps.disabled),\n              className: prefixClass(\"ChipsInputBase__chip\"),\n            })}\n          </React.Fragment>\n        );\n      })}\n      <label vkuiClass=\"ChipsInputBase__label\" aria-label={inputAriaLabel}>\n        <input\n          type=\"text\"\n          autoCapitalize=\"none\"\n          autoComplete=\"off\"\n          autoCorrect=\"off\"\n          spellCheck={false}\n          aria-autocomplete=\"list\"\n          vkuiClass=\"ChipsInputBase__el\"\n          {...restProps}\n          ref={inputRef}\n          value={fieldValue}\n          onChange={handleInputChange}\n          onKeyDown={handleKeyDown}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          placeholder={selectedOptions.length ? undefined : placeholder}\n        />\n      </label>\n    </div>\n  );\n};\n"],"mappings":"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"}