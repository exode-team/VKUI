{"version":3,"file":"Snackbar.js","names":["React","Touch","classNames","ANDROID","IOS","VKCOM","rubber","withAdaptivity","ViewWidth","Paragraph","Button","AppRootPortal","useWaitTransitionFinish","usePlatform","useTimeout","SnackbarComponent","children","layout","action","before","after","viewWidth","duration","onActionClick","onClose","closeOnActionClick","mode","restProps","platform","waitTransitionFinish","useState","closing","setClosing","touched","setTouched","shiftXPercentRef","useRef","shiftXCurrentRef","bodyElRef","innerElRef","animationFrameRef","isDesktop","SMALL_TABLET","transitionFinishDurationFallback","close","current","handleActionClick","e","closeTimeout","setBodyTransform","percent","cancelAnimationFrame","requestAnimationFrame","style","transform","onTouchStart","clear","onTouchMoveX","event","shiftX","originalEvent","preventDefault","offsetWidth","onTouchEnd","callback","shiftXCurrent","expectTranslateY","set","useEffect","resolvedLayout","displayName","Snackbar"],"sources":["../../../../src/components/Snackbar/Snackbar.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { classNames } from \"../../lib/classNames\";\nimport { HasPlatform } from \"../../types\";\nimport { ANDROID, IOS, VKCOM } from \"../../lib/platform\";\nimport { rubber } from \"../../lib/touch\";\nimport { withAdaptivity, ViewWidth } from \"../../hoc/withAdaptivity\";\nimport { Paragraph } from \"../Typography/Paragraph/Paragraph\";\nimport { Button } from \"../Button/Button\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { useWaitTransitionFinish } from \"../../hooks/useWaitTransitionFinish\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport {\n  AdaptivityContextInterface,\n  AdaptivityProps,\n} from \"../AdaptivityProvider/AdaptivityContext\";\nimport \"./Snackbar.css\";\n\nexport interface SnackbarProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasPlatform,\n    AdaptivityProps {\n  /**\n   * Название кнопки действия в уведомлении\n   */\n  action?: React.ReactNode;\n\n  /**\n   * Будет вызвано при клике на кнопку действия\n   */\n  onActionClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Закрытие при клике на действие\n   */\n  closeOnActionClick?: boolean;\n\n  /**\n   * Цветная иконка 24x24 пикселя\n   */\n  before?: React.ReactNode;\n  /**\n   * Контент в правой части, может быть `<Avatar size={32} />`\n   */\n  after?: React.ReactNode;\n  /**\n   * Варианты расположения кнопки\n   */\n  layout?: \"vertical\" | \"horizontal\";\n  /**\n   * Время в миллисекундах, через которое плашка скроется\n   */\n  duration?: number | null;\n  /**\n   * Обработчик закрытия уведомления\n   */\n  onClose: () => void;\n  /**\n   * Задает стиль снекбара\n   */\n  mode?: \"default\" | \"dark\";\n}\n\nconst SnackbarComponent = ({\n  children,\n  layout = \"horizontal\",\n  action,\n  before,\n  after,\n  viewWidth,\n  duration = 4000,\n  onActionClick,\n  onClose,\n  closeOnActionClick = true,\n  mode = \"default\",\n  ...restProps\n}: SnackbarProps & AdaptivityContextInterface) => {\n  const platform = usePlatform();\n\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = React.useState(false);\n  const [touched, setTouched] = React.useState(false);\n\n  const shiftXPercentRef = React.useRef<number>(0);\n  const shiftXCurrentRef = React.useRef<number>(0);\n\n  const bodyElRef = React.useRef<HTMLDivElement | null>(null);\n  const innerElRef = React.useRef<HTMLDivElement | null>(null);\n\n  const animationFrameRef = React.useRef<ReturnType<\n    typeof requestAnimationFrame\n  > | null>(null);\n\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n  const transitionFinishDurationFallback =\n    platform === ANDROID || platform === VKCOM ? 400 : 320;\n\n  const close = () => {\n    setClosing(true);\n    waitTransitionFinish(\n      innerElRef.current,\n      () => {\n        onClose();\n      },\n      transitionFinishDurationFallback\n    );\n  };\n\n  const handleActionClick: React.MouseEventHandler<HTMLElement> = (e) => {\n    closeOnActionClick && close();\n\n    if (action && typeof onActionClick === \"function\") {\n      onActionClick(e);\n    }\n  };\n\n  const closeTimeout = useTimeout(close, duration);\n\n  const setBodyTransform = (percent: number) => {\n    if (animationFrameRef.current !== null) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    animationFrameRef.current = requestAnimationFrame(() => {\n      if (bodyElRef.current) {\n        bodyElRef.current.style.transform = `translate3d(${percent}%, 0, 0)`;\n      }\n    });\n  };\n\n  const onTouchStart = closeTimeout.clear;\n\n  const onTouchMoveX = (event: TouchEvent) => {\n    const { shiftX, originalEvent } = event;\n    originalEvent.preventDefault();\n\n    if (!touched) {\n      setTouched(true);\n    }\n\n    shiftXPercentRef.current =\n      (shiftX / (bodyElRef.current?.offsetWidth ?? 0)) * 100;\n    shiftXCurrentRef.current = rubber(\n      shiftXPercentRef.current,\n      72,\n      1.2,\n      platform === ANDROID || platform === VKCOM\n    );\n\n    setBodyTransform(shiftXCurrentRef.current);\n  };\n\n  const onTouchEnd = (e: TouchEvent) => {\n    let callback: VoidFunction | undefined;\n\n    if (touched) {\n      let shiftXCurrent = shiftXCurrentRef.current;\n      const expectTranslateY = (shiftXCurrent / e.duration) * 240 * 0.6;\n      shiftXCurrent = shiftXCurrent + expectTranslateY;\n\n      if (isDesktop && shiftXCurrent <= -50) {\n        closeTimeout.clear();\n        waitTransitionFinish(\n          bodyElRef.current,\n          () => {\n            onClose();\n          },\n          transitionFinishDurationFallback\n        );\n        setBodyTransform(-120);\n      } else if (!isDesktop && shiftXCurrent >= 50) {\n        closeTimeout.clear();\n        waitTransitionFinish(\n          bodyElRef.current,\n          () => {\n            onClose();\n          },\n          transitionFinishDurationFallback\n        );\n        setBodyTransform(120);\n      } else {\n        callback = () => {\n          closeTimeout.set();\n          setBodyTransform(0);\n        };\n      }\n    } else {\n      closeTimeout.set();\n    }\n\n    setTouched(false);\n    callback && requestAnimationFrame(callback);\n  };\n\n  React.useEffect(() => closeTimeout.set(), [closeTimeout]);\n\n  const resolvedLayout = after || isDesktop ? \"vertical\" : layout;\n\n  return (\n    <AppRootPortal>\n      <div\n        {...restProps}\n        vkuiClass={classNames(\n          \"Snackbar\",\n          platform === IOS && \"Snackbar--ios\",\n          `Snackbar--l-${resolvedLayout}`,\n          `Snackbar--${mode}`,\n          closing && \"Snackbar--closing\",\n          touched && \"Snackbar--touched\",\n          isDesktop && \"Snackbar--desktop\"\n        )}\n      >\n        <Touch\n          vkuiClass=\"Snackbar__in\"\n          getRootRef={innerElRef}\n          onStart={onTouchStart}\n          onMoveX={onTouchMoveX}\n          onEnd={onTouchEnd}\n        >\n          <div vkuiClass=\"Snackbar__body\" ref={bodyElRef}>\n            {before && <div vkuiClass=\"Snackbar__before\">{before}</div>}\n\n            <div vkuiClass=\"Snackbar__content\">\n              <Paragraph vkuiClass=\"Snackbar__content-text\">\n                {children}\n              </Paragraph>\n\n              {action && (\n                <Button\n                  align=\"left\"\n                  hasHover={false}\n                  mode=\"tertiary\"\n                  appearance={mode === \"dark\" ? \"overlay\" : \"accent\"}\n                  size=\"s\"\n                  vkuiClass=\"Snackbar__action\"\n                  onClick={handleActionClick}\n                >\n                  {action}\n                </Button>\n              )}\n            </div>\n\n            {after && <div vkuiClass=\"Snackbar__after\">{after}</div>}\n          </div>\n        </Touch>\n      </div>\n    </AppRootPortal>\n  );\n};\n\nSnackbarComponent.displayName = \"Snackbar\";\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Snackbar\n */\nexport const Snackbar = withAdaptivity(SnackbarComponent, {\n  viewWidth: true,\n});\n"],"mappings":"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"}