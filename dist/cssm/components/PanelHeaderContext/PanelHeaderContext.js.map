{"version":3,"file":"PanelHeaderContext.js","names":["React","FixedLayout","classNames","ViewWidth","useAdaptivity","useDOM","IOS","useIsomorphicLayoutEffect","useGlobalEventListener","useTimeout","usePlatform","useScrollLock","PanelHeaderContext","children","onClose","opened","restProps","document","platform","useState","visible","setVisible","closing","viewWidth","isDesktop","SMALL_TABLET","elementRef","useRef","event","current","contains","target","stopPropagation","capture","onAnimationEnd","animationFallback","useEffect","set","clear","undefined"],"sources":["../../../../src/components/PanelHeaderContext/PanelHeaderContext.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { FixedLayout } from \"../FixedLayout/FixedLayout\";\nimport { classNames } from \"../../lib/classNames\";\nimport { ViewWidth } from \"../AdaptivityProvider/AdaptivityContext\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useDOM } from \"../../lib/dom\";\nimport { IOS } from \"../../lib/platform\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport \"./PanelHeaderContext.css\";\n\nexport interface PanelHeaderContextProps\n  extends React.HTMLAttributes<HTMLDivElement> {\n  opened: boolean;\n  onClose: VoidFunction;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PanelHeaderContext\n */\nexport const PanelHeaderContext = ({\n  children,\n  onClose,\n  opened = false,\n  ...restProps\n}: PanelHeaderContextProps) => {\n  const { document } = useDOM();\n  const platform = usePlatform();\n  const [visible, setVisible] = React.useState(opened);\n  const closing = visible && !opened;\n  const { viewWidth } = useAdaptivity();\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n  const elementRef = React.useRef<HTMLDivElement>(null);\n\n  useIsomorphicLayoutEffect(() => {\n    opened && setVisible(true);\n  }, [opened]);\n\n  useScrollLock(!isDesktop && opened);\n\n  // start closing on outer click\n  useGlobalEventListener(\n    document,\n    \"click\",\n    isDesktop &&\n      opened &&\n      !closing &&\n      ((event) => {\n        if (\n          elementRef.current &&\n          !elementRef.current.contains(event.target as Node)\n        ) {\n          event.stopPropagation();\n          onClose();\n        }\n      }),\n    { capture: true }\n  );\n\n  // fallback onAnimationEnd when animationend not supported\n  const onAnimationEnd = () => setVisible(false);\n  const animationFallback = useTimeout(onAnimationEnd, 200);\n  React.useEffect(\n    () => (closing ? animationFallback.set() : animationFallback.clear()),\n    [animationFallback, closing]\n  );\n\n  return (\n    <FixedLayout\n      {...restProps}\n      vkuiClass={classNames(\n        \"PanelHeaderContext\",\n        platform === IOS && \"PanelHeaderContext--ios\",\n        opened && \"PanelHeaderContext--opened\",\n        closing && \"PanelHeaderContext--closing\",\n        isDesktop && \"PanelHeaderContext--desktop\",\n        // TODO v5.0.0 поправить под новую адаптивность\n        (platform !== IOS || (platform === IOS && isDesktop)) &&\n          \"PanelHeaderContext--rounded\"\n      )}\n      vertical=\"top\"\n    >\n      <div\n        vkuiClass=\"PanelHeaderContext__in\"\n        ref={elementRef}\n        onAnimationEnd={closing ? onAnimationEnd : undefined}\n      >\n        <div vkuiClass=\"PanelHeaderContext__content\">{visible && children}</div>\n      </div>\n      {!isDesktop && visible && (\n        <div onClick={onClose} vkuiClass=\"PanelHeaderContext__fade\" />\n      )}\n    </FixedLayout>\n  );\n};\n"],"mappings":"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"}