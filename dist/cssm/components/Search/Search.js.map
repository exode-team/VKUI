{"version":3,"file":"Search.js","names":["React","classNames","withPlatform","Icon16SearchOutline","Icon16Clear","Icon24Cancel","IOS","VKCOM","ANDROID","Touch","noop","Text","Title","Headline","Separator","useExternRef","useEnsuredControl","useAdaptivity","SearchPlaceholderTypography","platform","children","restProps","SearchComponent","before","className","defaultValue","placeholder","after","getRef","icon","onIconClick","style","autoComplete","inputProps","inputRef","useState","isFocused","setFocused","value","onChange","sizeY","onFocus","e","onBlur","onCancel","useCallback","nativeInputValueSetter","Object","getOwnPropertyDescriptor","HTMLInputElement","prototype","set","call","current","ev2","Event","bubbles","dispatchEvent","onIconClickStart","originalEvent","onIconCancelClickStart","preventDefault","focus","Search","displayName"],"sources":["../../../../src/components/Search/Search.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport {\n  Icon16SearchOutline,\n  Icon16Clear,\n  Icon24Cancel,\n} from \"@vkontakte/icons\";\nimport { IOS, VKCOM, ANDROID } from \"../../lib/platform\";\nimport { HasPlatform, HasRef } from \"../../types\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport { VKUITouchEvent } from \"../../lib/touch\";\nimport { noop } from \"../../lib/utils\";\nimport { Text } from \"../Typography/Text/Text\";\nimport { Title } from \"../Typography/Title/Title\";\nimport { Headline } from \"../Typography/Headline/Headline\";\nimport { Separator } from \"../Separator/Separator\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEnsuredControl } from \"../../hooks/useEnsuredControl\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport \"./Search.css\";\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\ninterface SearchPlaceholderTypographyProps\n  extends HasPlatform,\n    React.HTMLAttributes<HTMLElement> {}\n\nconst SearchPlaceholderTypography = ({\n  platform,\n  children,\n  ...restProps\n}: SearchPlaceholderTypographyProps) => {\n  switch (platform) {\n    case IOS:\n      return (\n        <Title {...restProps} level=\"3\" weight=\"3\">\n          {children}\n        </Title>\n      );\n    case VKCOM:\n      return <Text {...restProps}>{children}</Text>;\n    case ANDROID:\n    default:\n      return (\n        <Headline {...restProps} weight=\"3\">\n          {children}\n        </Headline>\n      );\n  }\n};\n\nexport interface SearchProps\n  extends React.InputHTMLAttributes<HTMLInputElement>,\n    HasRef<HTMLInputElement>,\n    HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: React.ReactNode;\n  before?: React.ReactNode;\n  icon?: React.ReactNode;\n  onIconClick?: (e: VKUITouchEvent) => void;\n  defaultValue?: string;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Search\n */\nconst SearchComponent = ({\n  before = <Icon16SearchOutline aria-hidden />,\n  className,\n  defaultValue = \"\",\n  placeholder = \"Поиск\",\n  after = \"Отмена\",\n  getRef,\n  platform,\n  icon,\n  onIconClick = noop,\n  style,\n  autoComplete = \"off\",\n  ...inputProps\n}: SearchProps) => {\n  const inputRef = useExternRef(getRef);\n  const [isFocused, setFocused] = React.useState(false);\n  const [value, onChange] = useEnsuredControl(inputProps, { defaultValue });\n  const { sizeY } = useAdaptivity();\n\n  const onFocus = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocused(true);\n    inputProps.onFocus && inputProps.onFocus(e);\n  };\n\n  const onBlur = (e: React.FocusEvent<HTMLInputElement>) => {\n    setFocused(false);\n    inputProps.onBlur && inputProps.onBlur(e);\n  };\n\n  const onCancel = React.useCallback(() => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(\n      HTMLInputElement.prototype,\n      \"value\"\n    )?.set;\n    nativeInputValueSetter?.call(inputRef.current, \"\");\n\n    const ev2 = new Event(\"input\", { bubbles: true });\n    inputRef.current?.dispatchEvent(ev2);\n  }, [inputRef]);\n\n  const onIconClickStart = React.useCallback(\n    (e: TouchEvent) => onIconClick(e.originalEvent),\n    [onIconClick]\n  );\n\n  const onIconCancelClickStart = React.useCallback(\n    (e: TouchEvent) => {\n      e.originalEvent.preventDefault();\n      inputRef.current?.focus();\n      onCancel();\n    },\n    [inputRef, onCancel]\n  );\n\n  return (\n    <div\n      vkuiClass={classNames(\n        \"Search\",\n        platform === VKCOM && \"Search--vkcom\",\n        platform === IOS && \"Search--ios\",\n        // TODO: V5 перенести на новую адаптивность\n        `Search--sizeY-${sizeY}`,\n        isFocused && \"Search--focused\",\n        value && \"Search--has-value\",\n        icon && \"Search--has-after\",\n        after && \"Search--has-icon\"\n      )}\n      className={className}\n      style={style}\n    >\n      <div vkuiClass=\"Search__in\">\n        <div vkuiClass=\"Search__width\" />\n        <label vkuiClass=\"Search__control\">\n          <input\n            type=\"search\"\n            {...inputProps}\n            autoComplete={autoComplete}\n            ref={inputRef}\n            vkuiClass=\"Search__input\"\n            onFocus={onFocus}\n            onBlur={onBlur}\n            onChange={onChange}\n            value={value}\n          />\n          {platform === IOS && after && (\n            <div vkuiClass=\"Search__after-width\">{after}</div>\n          )}\n          <div vkuiClass=\"Search__placeholder\">\n            <div vkuiClass=\"Search__placeholder-in\">\n              {before}\n              <SearchPlaceholderTypography\n                vkuiClass=\"Search__placeholder-text\"\n                platform={platform}\n              >\n                {placeholder}\n              </SearchPlaceholderTypography>\n            </div>\n            {isFocused && platform === IOS && after && (\n              <div vkuiClass=\"Search__after-width\">{after}</div>\n            )}\n          </div>\n        </label>\n        <div vkuiClass=\"Search__after\">\n          <div vkuiClass=\"Search__icons\">\n            {icon && (\n              <Touch onStart={onIconClickStart} vkuiClass=\"Search__icon\">\n                {icon}\n              </Touch>\n            )}\n            {!!value && (\n              <Touch\n                onStart={onIconCancelClickStart}\n                onClick={onCancel}\n                vkuiClass=\"Search__icon\"\n              >\n                {platform === IOS ? <Icon16Clear /> : <Icon24Cancel />}\n              </Touch>\n            )}\n          </div>\n          {platform === IOS && after && (\n            <div vkuiClass=\"Search__after-in\" onClick={onCancel}>\n              {after}\n            </div>\n          )}\n        </div>\n      </div>\n      {platform === VKCOM && <Separator vkuiClass=\"Search__separator\" wide />}\n    </div>\n  );\n};\n\nexport const Search = withPlatform(SearchComponent);\n\nSearch.displayName = \"Search\";\n"],"mappings":";;;;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,SAASC,UAAU;AACnB,SAASC,YAAY;AACrB,SACEC,mBAAmB,EACnBC,WAAW,EACXC,YAAY,QACP,kBAAkB;AACzB,SAASC,GAAG,EAAEC,KAAK,EAAEC,OAAO;AAE5B,SAASC,KAAK;AAEd,SAASC,IAAI;AACb,SAASC,IAAI;AACb,SAASC,KAAK;AACd,SAASC,QAAQ;AACjB,SAASC,SAAS;AAClB,SAASC,YAAY;AACrB,SAASC,iBAAiB;AAC1B,SAASC,aAAa;AACtB;AAQA,IAAMC,2BAA2B,GAAG,SAA9BA,2BAA2B,OAIO;EAAA,IAHtCC,QAAQ,QAARA,QAAQ;IACRC,QAAQ,QAARA,QAAQ;IACLC,SAAS;EAEZ,QAAQF,QAAQ;IACd,KAAKb,GAAG;MACN,OACE,oBAAC,KAAK,eAAKe,SAAS;QAAE,KAAK,EAAC,GAAG;QAAC,MAAM,EAAC;MAAG,IACvCD,QAAQ,CACH;IAEZ,KAAKb,KAAK;MACR,OAAO,oBAAC,IAAI,EAAKc,SAAS,EAAGD,QAAQ,CAAQ;IAC/C,KAAKZ,OAAO;IACZ;MACE,OACE,oBAAC,QAAQ,eAAKa,SAAS;QAAE,MAAM,EAAC;MAAG,IAChCD,QAAQ,CACA;EACX;AAER,CAAC;AAgBD;AACA;AACA;AACA,IAAME,eAAe,GAAG,SAAlBA,eAAe,QAaF;EAAA,yBAZjBC,MAAM;IAANA,MAAM,6BAAG,oBAAC,mBAAmB;MAAC;IAAW,EAAG;IAC5CC,SAAS,SAATA,SAAS;IAAA,2BACTC,YAAY;IAAZA,YAAY,mCAAG,EAAE;IAAA,0BACjBC,WAAW;IAAXA,WAAW,kCAAG,OAAO;IAAA,oBACrBC,KAAK;IAALA,KAAK,4BAAG,QAAQ;IAChBC,MAAM,SAANA,MAAM;IACNT,QAAQ,SAARA,QAAQ;IACRU,IAAI,SAAJA,IAAI;IAAA,0BACJC,WAAW;IAAXA,WAAW,kCAAGpB,IAAI;IAClBqB,KAAK,SAALA,KAAK;IAAA,2BACLC,YAAY;IAAZA,YAAY,mCAAG,KAAK;IACjBC,UAAU;EAEb,IAAMC,QAAQ,GAAGnB,YAAY,CAACa,MAAM,CAAC;EACrC,sBAAgC5B,KAAK,CAACmC,QAAQ,CAAC,KAAK,CAAC;IAAA;IAA9CC,SAAS;IAAEC,UAAU;EAC5B,yBAA0BrB,iBAAiB,CAACiB,UAAU,EAAE;MAAER,YAAY,EAAZA;IAAa,CAAC,CAAC;IAAA;IAAlEa,KAAK;IAAEC,QAAQ;EACtB,qBAAkBtB,aAAa,EAAE;IAAzBuB,KAAK,kBAALA,KAAK;EAEb,IAAMC,OAAO,GAAG,SAAVA,OAAO,CAAIC,CAAqC,EAAK;IACzDL,UAAU,CAAC,IAAI,CAAC;IAChBJ,UAAU,CAACQ,OAAO,IAAIR,UAAU,CAACQ,OAAO,CAACC,CAAC,CAAC;EAC7C,CAAC;EAED,IAAMC,MAAM,GAAG,SAATA,MAAM,CAAID,CAAqC,EAAK;IACxDL,UAAU,CAAC,KAAK,CAAC;IACjBJ,UAAU,CAACU,MAAM,IAAIV,UAAU,CAACU,MAAM,CAACD,CAAC,CAAC;EAC3C,CAAC;EAED,IAAME,QAAQ,GAAG5C,KAAK,CAAC6C,WAAW,CAAC,YAAM;IAAA;IACvC;IACA,IAAMC,sBAAsB,4BAAGC,MAAM,CAACC,wBAAwB,CAC5DC,gBAAgB,CAACC,SAAS,EAC1B,OAAO,CACR,0DAH8B,sBAG5BC,GAAG;IACNL,sBAAsB,aAAtBA,sBAAsB,uBAAtBA,sBAAsB,CAAEM,IAAI,CAAClB,QAAQ,CAACmB,OAAO,EAAE,EAAE,CAAC;IAElD,IAAMC,GAAG,GAAG,IAAIC,KAAK,CAAC,OAAO,EAAE;MAAEC,OAAO,EAAE;IAAK,CAAC,CAAC;IACjD,qBAAAtB,QAAQ,CAACmB,OAAO,sDAAhB,kBAAkBI,aAAa,CAACH,GAAG,CAAC;EACtC,CAAC,EAAE,CAACpB,QAAQ,CAAC,CAAC;EAEd,IAAMwB,gBAAgB,GAAG1D,KAAK,CAAC6C,WAAW,CACxC,UAACH,CAAa;IAAA,OAAKZ,WAAW,CAACY,CAAC,CAACiB,aAAa,CAAC;EAAA,GAC/C,CAAC7B,WAAW,CAAC,CACd;EAED,IAAM8B,sBAAsB,GAAG5D,KAAK,CAAC6C,WAAW,CAC9C,UAACH,CAAa,EAAK;IAAA;IACjBA,CAAC,CAACiB,aAAa,CAACE,cAAc,EAAE;IAChC,sBAAA3B,QAAQ,CAACmB,OAAO,uDAAhB,mBAAkBS,KAAK,EAAE;IACzBlB,QAAQ,EAAE;EACZ,CAAC,EACD,CAACV,QAAQ,EAAEU,QAAQ,CAAC,CACrB;EAED,OACE;IACE,SAAS,EAAE3C,UAAU,CACnB,QAAQ,EACRkB,QAAQ,KAAKZ,KAAK,IAAI,eAAe,EACrCY,QAAQ,KAAKb,GAAG,IAAI,aAAa,EACjC;IAAA,wBACiBkC,KAAK,GACtBJ,SAAS,IAAI,iBAAiB,EAC9BE,KAAK,IAAI,mBAAmB,EAC5BT,IAAI,IAAI,mBAAmB,EAC3BF,KAAK,IAAI,kBAAkB,CAC3B;IACF,SAAS,EAAEH,SAAU;IACrB,KAAK,EAAEO;EAAM,GAEb;IAAK,SAAS,EAAC;EAAY,GACzB;IAAK,SAAS,EAAC;EAAe,EAAG,EACjC;IAAO,SAAS,EAAC;EAAiB,GAChC;IACE,IAAI,EAAC;EAAQ,GACTE,UAAU;IACd,YAAY,EAAED,YAAa;IAC3B,GAAG,EAAEE,QAAS;IACd,SAAS,EAAC,eAAe;IACzB,OAAO,EAAEO,OAAQ;IACjB,MAAM,EAAEE,MAAO;IACf,QAAQ,EAAEJ,QAAS;IACnB,KAAK,EAAED;EAAM,GACb,EACDnB,QAAQ,KAAKb,GAAG,IAAIqB,KAAK,IACxB;IAAK,SAAS,EAAC;EAAqB,GAAEA,KAAK,CAC5C,EACD;IAAK,SAAS,EAAC;EAAqB,GAClC;IAAK,SAAS,EAAC;EAAwB,GACpCJ,MAAM,EACP,oBAAC,2BAA2B;IAC1B,SAAS,EAAC,0BAA0B;IACpC,QAAQ,EAAEJ;EAAS,GAElBO,WAAW,CACgB,CAC1B,EACLU,SAAS,IAAIjB,QAAQ,KAAKb,GAAG,IAAIqB,KAAK,IACrC;IAAK,SAAS,EAAC;EAAqB,GAAEA,KAAK,CAC5C,CACG,CACA,EACR;IAAK,SAAS,EAAC;EAAe,GAC5B;IAAK,SAAS,EAAC;EAAe,GAC3BE,IAAI,IACH,oBAAC,KAAK;IAAC,OAAO,EAAE6B,gBAAiB;IAAC,SAAS,EAAC;EAAc,GACvD7B,IAAI,CAER,EACA,CAAC,CAACS,KAAK,IACN,oBAAC,KAAK;IACJ,OAAO,EAAEsB,sBAAuB;IAChC,OAAO,EAAEhB,QAAS;IAClB,SAAS,EAAC;EAAc,GAEvBzB,QAAQ,KAAKb,GAAG,GAAG,oBAAC,WAAW,OAAG,GAAG,oBAAC,YAAY,OAAG,CAEzD,CACG,EACLa,QAAQ,KAAKb,GAAG,IAAIqB,KAAK,IACxB;IAAK,SAAS,EAAC,kBAAkB;IAAC,OAAO,EAAEiB;EAAS,GACjDjB,KAAK,CAET,CACG,CACF,EACLR,QAAQ,KAAKZ,KAAK,IAAI,oBAAC,SAAS;IAAC,SAAS,EAAC,mBAAmB;IAAC,IAAI;EAAA,EAAG,CACnE;AAEV,CAAC;AAED,OAAO,IAAMwD,MAAM,GAAG7D,YAAY,CAACoB,eAAe,CAAC;AAEnDyC,MAAM,CAACC,WAAW,GAAG,QAAQ"}