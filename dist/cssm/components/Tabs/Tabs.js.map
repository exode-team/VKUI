{"version":3,"file":"Tabs.js","names":["React","classNames","usePlatform","IOS","VKCOM","withAdaptivity","warnOnce","useGlobalEventListener","useDOM","pressedKey","warn","TabsModeContext","createContext","mode","withGaps","TabsComponent","children","getRootRef","sizeX","role","restProps","platform","document","isTabFlow","tabsRef","useRef","process","env","NODE_ENV","expectedValueText","getTabEls","current","Array","from","querySelectorAll","handleDocumentKeydown","event","key","tabEls","currentFocusedElIndex","findIndex","el","activeElement","nextIndex","length","offset","nextTabEl","preventDefault","focus","currentFocusedEl","find","getAttribute","relatedContentElId","relatedContentEl","getElementById","click","capture","Tabs","displayName"],"sources":["../../../../src/components/Tabs/Tabs.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { HasRootRef } from \"../../types\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { IOS, VKCOM } from \"../../lib/platform\";\nimport { withAdaptivity, AdaptivityProps } from \"../../hoc/withAdaptivity\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { useDOM } from \"../../lib/dom\";\nimport { pressedKey } from \"../../lib/accessibility\";\nimport \"./Tabs.css\";\n\nexport interface TabsProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    HasRootRef<HTMLDivElement>,\n    AdaptivityProps {\n  /**\n   * Задаёт вид кнопок.\n   *\n   * > ⚠️ Значения `\"buttons\"`, `\"segmented\"` устарели и будут удалены в 5.0.0. Вместо `\"buttons\"` используйте `\"secondary\"`.\n   * > Режим `\"segmented\"` переехал в отдельный компонент [`SegmentedControl`](https://vkcom.github.io/VKUI#/SegmentedControl),\n   * > поэтому используйте его вместо `Tabs`.\n   */\n  mode?: \"buttons\" | \"segmented\" | \"default\" | \"accent\" | \"secondary\";\n}\n\nconst warn = warnOnce(\"Tabs\");\n\nexport interface TabsContextProps {\n  mode: TabsProps[\"mode\"];\n  withGaps: boolean;\n}\n\nexport const TabsModeContext = React.createContext<TabsContextProps>({\n  mode: \"default\",\n  withGaps: false,\n});\n\nconst TabsComponent = ({\n  children,\n  mode = \"default\",\n  getRootRef,\n  sizeX,\n  role = \"tablist\",\n  ...restProps\n}: TabsProps) => {\n  const platform = usePlatform();\n  const { document } = useDOM();\n\n  const isTabFlow = role === \"tablist\";\n\n  const tabsRef = React.useRef<HTMLDivElement>(null);\n\n  if (\n    (mode === \"buttons\" || mode === \"segmented\") &&\n    process.env.NODE_ENV === \"development\"\n  ) {\n    const expectedValueText =\n      mode === \"buttons\"\n        ? `значения \"secondary\"`\n        : \"компонент SegmentedControl\";\n    warn(\n      `mode=\"${mode}\" устарело и будет удалено в 5.0.0. Используйте ${expectedValueText}`\n    );\n  }\n\n  if (platform !== IOS && mode === \"segmented\") {\n    mode = \"default\";\n  }\n\n  if (mode === \"buttons\") {\n    mode = \"secondary\";\n  }\n\n  const withGaps = mode === \"accent\" || mode === \"secondary\";\n\n  const getTabEls = () => {\n    if (!tabsRef.current) {\n      return [];\n    }\n\n    return Array.from(\n      // eslint-disable-next-line no-restricted-properties\n      tabsRef.current.querySelectorAll<HTMLDivElement>(\n        \"[role=tab]:not([disabled])\"\n      )\n    );\n  };\n\n  const handleDocumentKeydown = (event: KeyboardEvent) => {\n    if (!document || !tabsRef.current || !isTabFlow) {\n      return;\n    }\n\n    const key = pressedKey(event);\n\n    switch (key) {\n      case \"ArrowLeft\":\n      case \"ArrowRight\":\n      case \"End\":\n      case \"Home\": {\n        const tabEls = getTabEls();\n        const currentFocusedElIndex = tabEls.findIndex(\n          (el) => document.activeElement === el\n        );\n        if (currentFocusedElIndex === -1) {\n          return;\n        }\n\n        let nextIndex = 0;\n        if (key === \"Home\") {\n          nextIndex = 0;\n        } else if (key === \"End\") {\n          nextIndex = tabEls.length - 1;\n        } else {\n          const offset = key === \"ArrowRight\" ? 1 : -1;\n          nextIndex = currentFocusedElIndex + offset;\n        }\n\n        const nextTabEl = tabEls[nextIndex];\n\n        if (nextTabEl) {\n          event.preventDefault();\n          nextTabEl.focus();\n        }\n\n        break;\n      }\n      /*\n       В JAWS и NVDA стрелка вниз активирует контент.\n       Это не прописано в стандартах, но по ссылке ниже это рекомендуется делать.\n       https://inclusive-components.design/tabbed-interfaces/\n      */\n      case \"ArrowDown\": {\n        const tabEls = getTabEls();\n        const currentFocusedEl = tabEls.find(\n          (el) => document.activeElement === el\n        );\n\n        if (\n          !currentFocusedEl ||\n          currentFocusedEl.getAttribute(\"aria-selected\") !== \"true\"\n        ) {\n          return;\n        }\n\n        const relatedContentElId =\n          currentFocusedEl.getAttribute(\"aria-controls\");\n        if (!relatedContentElId) {\n          return;\n        }\n\n        // eslint-disable-next-line no-restricted-properties\n        const relatedContentEl = document.getElementById(relatedContentElId);\n        if (!relatedContentEl) {\n          return;\n        }\n\n        event.preventDefault();\n        relatedContentEl.focus();\n\n        break;\n      }\n      case \"Space\":\n      case \"Enter\": {\n        const tabEls = getTabEls();\n        const currentFocusedEl = tabEls.find(\n          (el) => document.activeElement === el\n        );\n        if (currentFocusedEl) {\n          currentFocusedEl.click();\n        }\n      }\n    }\n  };\n\n  useGlobalEventListener(document, \"keydown\", handleDocumentKeydown, {\n    capture: true,\n  });\n\n  return (\n    <div\n      {...restProps}\n      ref={getRootRef}\n      vkuiClass={classNames(\n        \"Tabs\",\n        (platform === IOS || platform === VKCOM) && `Tabs--${platform}`,\n        `Tabs--${mode}`,\n        withGaps && \"Tabs--withGaps\",\n        // TODO v5.0.0 новая адаптивность\n        `Tabs--sizeX-${sizeX}`\n      )}\n      role={role}\n    >\n      <div vkuiClass=\"Tabs__in\" ref={tabsRef}>\n        <TabsModeContext.Provider value={{ mode, withGaps }}>\n          {children}\n        </TabsModeContext.Provider>\n      </div>\n    </div>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Tabs\n */\nexport const Tabs = withAdaptivity(TabsComponent, { sizeX: true });\n\nTabs.displayName = \"Tabs\";\n"],"mappings":"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"}