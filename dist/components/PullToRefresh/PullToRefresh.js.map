{"version":3,"sources":["../../../src/components/PullToRefresh/PullToRefresh.tsx"],"names":["React","useDOM","classNames","IOS","runTapticImpactOccurred","useIsomorphicLayoutEffect","usePlatform","useGlobalEventListener","useScroll","Touch","FixedLayout","PullToRefreshSpinner","TouchRootContext","usePrevious","useTimeout","cancelEvent","event","originalEvent","preventDefault","cancelable","stopPropagation","TOUCH_MOVE_EVENT_PARAMS","passive","PullToRefresh","children","isFetching","onRefresh","restProps","platform","scroll","document","prevIsFetching","initParams","useMemo","start","max","maxY","refreshing","positionMultiplier","useState","spinnerY","setSpinnerY","watching","setWatching","setRefreshing","canRefresh","setCanRefresh","touchDown","setTouchDown","prevTouchDown","touchY","useRef","contentShift","setContentShift","spinnerProgress","setSpinnerProgress","onWindowTouchMove","resetRefreshingState","useCallback","onRefreshingFinish","setWaitFetchingTimeout","set","clearWaitFetchingTimeout","clear","undefined","runRefreshing","prevSpinnerY","onTouchStart","e","onTouchMove","isY","shiftY","pageYOffset","getScroll","y","shift","Math","current","currentY","min","progress","abs","onTouchEnd","spinnerTransform","contentTransform","transform","WebkitTransform","opacity"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { AnyFunction, HasPlatform } from \"../../types\";\nimport { DOMProps, useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS } from \"../../lib/platform\";\nimport { runTapticImpactOccurred } from \"../../lib/taptic\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { ScrollContextInterface, useScroll } from \"../AppRoot/ScrollContext\";\nimport { Touch, TouchEvent, TouchProps } from \"../Touch/Touch\";\nimport { FixedLayout } from \"../FixedLayout/FixedLayout\";\nimport { PullToRefreshSpinner } from \"./PullToRefreshSpinner\";\nimport TouchRootContext from \"../Touch/TouchContext\";\nimport { usePrevious } from \"../../hooks/usePrevious\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\n\nfunction cancelEvent(event: any) {\n  if (!event) {\n    return false;\n  }\n  while (event.originalEvent) {\n    event = event.originalEvent;\n  }\n  if (event.preventDefault && event.cancelable) {\n    event.preventDefault();\n  }\n  if (event.stopPropagation) {\n    event.stopPropagation();\n  }\n  return false;\n}\n\nexport interface PullToRefreshProps extends DOMProps, TouchProps, HasPlatform {\n  /**\n   * Будет вызвана для обновления контента (прим.: функция должна быть мемоизированным коллбэком)\n   */\n  onRefresh: AnyFunction;\n  /**\n   * Определяет, выполняется ли обновление. Для скрытия спиннера после получения контента необходимо передать `false`\n   */\n  isFetching?: boolean;\n  /** @ignore */\n  scroll?: ScrollContextInterface;\n  children?: React.ReactNode;\n}\n\nconst TOUCH_MOVE_EVENT_PARAMS = {\n  cancelable: true,\n  passive: false,\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/PullToRefresh\n */\nexport const PullToRefresh = ({\n  children,\n  isFetching,\n  onRefresh,\n  ...restProps\n}: PullToRefreshProps) => {\n  const platform = usePlatform();\n  const scroll = useScroll();\n  const { document } = useDOM();\n  const prevIsFetching = usePrevious(isFetching);\n\n  const initParams = React.useMemo(\n    () => ({\n      start: platform === IOS ? -10 : -45,\n      max: platform === IOS ? 50 : 80,\n      maxY: platform === IOS ? 400 : 80,\n      refreshing: platform === IOS ? 36 : 50,\n      positionMultiplier: platform === IOS ? 0.21 : 1,\n    }),\n    [platform]\n  );\n\n  const [spinnerY, setSpinnerY] = React.useState(initParams.start);\n  const [watching, setWatching] = React.useState(false);\n  const [refreshing, setRefreshing] = React.useState(false);\n  const [canRefresh, setCanRefresh] = React.useState(false);\n  const [touchDown, setTouchDown] = React.useState(false);\n  const prevTouchDown = usePrevious(touchDown);\n\n  const touchY = React.useRef(0);\n  const [contentShift, setContentShift] = React.useState(0);\n  const [spinnerProgress, setSpinnerProgress] = React.useState(0);\n\n  const onWindowTouchMove = (event: Event) => {\n    if (refreshing) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  useGlobalEventListener(\n    document,\n    \"touchmove\",\n    onWindowTouchMove,\n    TOUCH_MOVE_EVENT_PARAMS\n  );\n\n  const resetRefreshingState = React.useCallback(() => {\n    setWatching(false);\n    setCanRefresh(false);\n    setRefreshing(false);\n    setSpinnerY(initParams.start);\n    setSpinnerProgress(0);\n    setContentShift(0);\n  }, [initParams]);\n\n  const onRefreshingFinish = React.useCallback(() => {\n    if (!touchDown) {\n      resetRefreshingState();\n    }\n  }, [touchDown, resetRefreshingState]);\n\n  const { set: setWaitFetchingTimeout, clear: clearWaitFetchingTimeout } =\n    useTimeout(onRefreshingFinish, 1000);\n\n  useIsomorphicLayoutEffect(() => {\n    if (prevIsFetching !== undefined && prevIsFetching && !isFetching) {\n      onRefreshingFinish();\n    }\n  }, [prevIsFetching, isFetching, onRefreshingFinish]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (prevIsFetching !== undefined && !prevIsFetching && isFetching) {\n      clearWaitFetchingTimeout();\n    }\n  }, [isFetching, prevIsFetching, clearWaitFetchingTimeout]);\n\n  const runRefreshing = React.useCallback(() => {\n    if (!refreshing && onRefresh) {\n      // cleanup if the consumer does not start fetching in 1s\n      setWaitFetchingTimeout();\n\n      setRefreshing(true);\n      setSpinnerY((prevSpinnerY) =>\n        platform === IOS ? prevSpinnerY : initParams.refreshing\n      );\n\n      onRefresh();\n      runTapticImpactOccurred(\"light\");\n    }\n  }, [\n    refreshing,\n    onRefresh,\n    setWaitFetchingTimeout,\n    platform,\n    initParams.refreshing,\n  ]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (prevTouchDown !== undefined && prevTouchDown && !touchDown) {\n      if (!refreshing && canRefresh) {\n        runRefreshing();\n      } else if (refreshing && !isFetching) {\n        // only iOS can start refresh before gesture end\n        resetRefreshingState();\n      } else {\n        // refreshing && isFetching: refresh in progress\n        // OR !refreshing && !canRefresh: pull was not strong enough\n        setSpinnerY(refreshing ? initParams.refreshing : initParams.start);\n        setSpinnerProgress(0);\n        setContentShift(0);\n      }\n    }\n  }, [\n    initParams,\n    prevIsFetching,\n    isFetching,\n    onRefreshingFinish,\n    prevTouchDown,\n    touchDown,\n    refreshing,\n    canRefresh,\n    runRefreshing,\n  ]);\n\n  const onTouchStart = (e: TouchEvent) => {\n    if (refreshing) {\n      cancelEvent(e);\n    }\n    setTouchDown(true);\n  };\n\n  const onTouchMove = (e: TouchEvent) => {\n    const { isY, shiftY } = e;\n    const { start, max } = initParams;\n    const pageYOffset = scroll?.getScroll().y;\n\n    if (watching && touchDown) {\n      cancelEvent(e);\n\n      const { positionMultiplier, maxY } = initParams;\n\n      const shift = Math.max(0, shiftY - touchY.current);\n\n      const currentY = Math.max(\n        start,\n        Math.min(maxY, start + shift * positionMultiplier)\n      );\n      const progress =\n        currentY > -10 ? Math.abs((currentY + 10) / max) * 80 : 0;\n\n      setSpinnerY(currentY);\n      setSpinnerProgress(Math.min(80, Math.max(0, progress)));\n      setCanRefresh(progress > 80);\n      setContentShift((currentY + 10) * 2.3);\n\n      if (progress > 85 && !refreshing && platform === IOS) {\n        runRefreshing();\n      }\n    } else if (\n      isY &&\n      pageYOffset === 0 &&\n      shiftY > 0 &&\n      !refreshing &&\n      touchDown\n    ) {\n      cancelEvent(e);\n\n      touchY.current = shiftY;\n      setWatching(true);\n      setSpinnerY(start);\n      setSpinnerProgress(0);\n    }\n  };\n\n  const onTouchEnd = () => {\n    setWatching(false);\n    setTouchDown(false);\n  };\n\n  const spinnerTransform = `translate3d(0, ${spinnerY}px, 0)`;\n  let contentTransform = \"\";\n\n  if (platform === IOS && refreshing && !touchDown) {\n    contentTransform = \"translate3d(0, 100px, 0)\";\n  } else if (platform === IOS && (contentShift || refreshing)) {\n    contentTransform = `translate3d(0, ${contentShift}px, 0)`;\n  }\n\n  return (\n    <TouchRootContext.Provider value={true}>\n      <Touch\n        {...restProps}\n        onStart={onTouchStart}\n        onMove={onTouchMove}\n        onEnd={onTouchEnd}\n        vkuiClass={classNames(\n          \"PullToRefresh\",\n          platform === IOS && \"PullToRefresh--ios\",\n          watching && \"PullToRefresh--watching\",\n          refreshing && \"PullToRefresh--refreshing\"\n        )}\n      >\n        <FixedLayout vkuiClass=\"PullToRefresh__controls\">\n          <PullToRefreshSpinner\n            style={{\n              transform: spinnerTransform,\n              WebkitTransform: spinnerTransform,\n              opacity: watching || refreshing || canRefresh ? 1 : 0,\n            }}\n            on={refreshing}\n            progress={refreshing ? undefined : spinnerProgress}\n          />\n        </FixedLayout>\n\n        <div\n          vkuiClass=\"PullToRefresh__content\"\n          style={{\n            transform: contentTransform,\n            WebkitTransform: contentTransform,\n          }}\n        >\n          {children}\n        </div>\n      </Touch>\n    </TouchRootContext.Provider>\n  );\n};\n"],"file":"PullToRefresh.js"}