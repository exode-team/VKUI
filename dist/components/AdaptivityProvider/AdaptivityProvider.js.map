{"version":3,"file":"AdaptivityProvider.js","names":["React","hasMouse","_hasMouse","hasHover","_hasHover","AdaptivityContext","SizeType","ViewHeight","ViewWidth","useDOM","useBridgeAdaptivity","DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","useRef","useState","updateAdaptivity","bridge","window","current","calculateAdaptivity","useEffect","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","deviceHasHover","addEventListener","removeEventListener","children","windowWidth","windowHeight","type","viewportWidth","viewportHeight","innerWidth","innerHeight","SMALL_MOBILE","SMALL","REGULAR","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"sources":["../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { hasMouse as _hasMouse, hasHover as _hasHover } from \"@vkontakte/vkjs\";\nimport {\n  AdaptivityContext,\n  AdaptivityProps,\n  SizeType,\n  ViewHeight,\n  ViewWidth,\n} from \"./AdaptivityContext\";\nimport { useDOM } from \"../../lib/dom\";\nimport {\n  useBridgeAdaptivity,\n  BridgeAdaptivity,\n} from \"../../hooks/useBridgeAdaptivity\";\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\nexport interface AdaptivityProviderProps extends AdaptivityProps {\n  children?: React.ReactNode;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AdaptivityProvider\n */\nexport const AdaptivityProvider = (props: AdaptivityProviderProps) => {\n  const adaptivityRef = React.useRef<ReturnType<\n    typeof calculateAdaptivity\n  > | null>(null);\n  const [, updateAdaptivity] = React.useState({});\n  const bridge = useBridgeAdaptivity();\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(props, bridge, window);\n  }\n\n  React.useEffect(() => {\n    function onResize() {\n      if (adaptivityRef.current === null) {\n        return;\n      }\n\n      const calculated = calculateAdaptivity(props, bridge, window);\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover } =\n        adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse ||\n        deviceHasHover !== calculated.deviceHasHover\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window!.addEventListener(\"resize\", onResize, false);\n\n    return () => {\n      window!.removeEventListener(\"resize\", onResize, false);\n    };\n  }, [\n    props.viewWidth,\n    props.viewHeight,\n    props.sizeX,\n    props.sizeY,\n    props.hasMouse,\n    props.deviceHasHover,\n    window,\n    props,\n    bridge,\n  ]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n};\n\nfunction calculateAdaptivity(\n  props: AdaptivityProps,\n  bridge: BridgeAdaptivity,\n  window?: Window\n) {\n  let windowWidth = 0;\n  let windowHeight = 0;\n\n  if (bridge.type === \"adaptive\") {\n    windowWidth = bridge.viewportWidth;\n    windowHeight = bridge.viewportHeight;\n  } else if (window) {\n    windowWidth = window.innerWidth;\n    windowHeight = window.innerHeight;\n  }\n\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = _hasMouse;\n  let deviceHasHover = _hasHover;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  if (!bridge.type) {\n    props.viewWidth && (viewWidth = props.viewWidth);\n    props.viewHeight && (viewHeight = props.viewHeight);\n\n    hasMouse = props.hasMouse ?? hasMouse;\n    deviceHasHover = props.deviceHasHover ?? deviceHasHover;\n  }\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (\n    (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse) ||\n    viewHeight <= ViewHeight.EXTRA_SMALL\n  ) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  if (!bridge.type) {\n    props.sizeX && (sizeX = props.sizeX);\n    props.sizeY && (sizeY = props.sizeY);\n  }\n\n  if (\n    bridge.type === \"force_mobile\" ||\n    bridge.type === \"force_mobile_compact\"\n  ) {\n    viewWidth = ViewWidth.MOBILE;\n    sizeX = SizeType.COMPACT;\n\n    if (bridge.type === \"force_mobile_compact\") {\n      sizeY = SizeType.COMPACT;\n    } else {\n      sizeY = SizeType.REGULAR;\n    }\n  }\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse, deviceHasHover };\n}\n"],"mappings":"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"}