{"version":3,"sources":["../../../src/components/ModalRoot/ModalRoot.tsx"],"names":["React","Touch","TouchRootContext","getClassName","classNames","setTransformStyle","rubber","ANDROID","IOS","VKCOM","transitionEvent","withPlatform","withContext","ModalRootContext","ConfigProviderContext","WebviewType","ModalType","MODAL_PAGE_DEFAULT_PERCENT_HEIGHT","withDOM","getNavId","warnOnce","FocusTrap","withModalManager","warn","IS_DEV","process","env","NODE_ENV","numberInRange","number","range","rangeTranslate","Math","max","min","ModalRootTouchComponent","props","createRef","undefined","event","originalEvent","preventDefault","modalState","getModalState","activeModal","animateTranslate","translateY","type","PAGE","dynamicContentHeight","enteringModal","waitTransitionFinish","requestAnimationFrame","checkPageContentHeight","e","exitingModal","onPageTouchMove","CARD","onCardTouchMove","onPageTouchEnd","onCardTouchEnd","target","contentElement","contains","contentScrolled","contentScrollStopTimeout","clearTimeout","setTimeout","state","touchDown","dragging","maskElementRef","modalRootContext","updateModalHeight","registerModal","id","data","Object","assign","onClose","onExit","isInsideModal","frameIds","platform","document","window","Children","toArray","children","addEventListener","updateModalTranslate","toggleDocumentScrolling","removeEventListener","prevProps","closeModal","enteringState","onEnter","innerElement","style","transitionDelay","onEntered","delayEnter","timeout","restoreFocusTo","activeElement","focus","enabled","documentScrolling","preventTouch","passive","modalElement","prevModalState","initPageModal","currentModalState","needAnimate","expandable","translateYFrom","setState","nextModalState","nextIsPage","prevIsPage","onExited","exitTranslate","isBack","setMaskOpacity","shiftY","isY","viewportRef","current","stopPropagation","collapsed","expanded","touchStartContentScrollTop","scrollTop","touchMovePositive","headerElement","shiftYPercent","innerHeight","shiftYCurrent","touchShiftYPercent","translateYCurrent","offsetHeight","startY","setStateCallback","shiftYEndPercent","expectTranslateY","duration","settlingHeight","expandedRange","collapsedRange","hiddenRange","hidden","eventHandler","supported","onceHandler","name","percent","frameId","cancelAnimationFrame","forceOpacity","history","maskAnimationFrame","opacity","toString","configProvider","webviewType","VKAPPS","onTouchMove","onTouchEnd","onScroll","getModals","map","Modal","modalId","_modalState","isPage","key","Component","ModalRootTouch","initModal","initCardModal","contentHeight","firstElementChild","prevTranslateY","clientHeight","shiftHalf","visiblePart","headerHeight","height","parentElement"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Touch, TouchEvent } from \"../Touch/Touch\";\nimport TouchRootContext from \"../Touch/TouchContext\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { classNames } from \"../../lib/classNames\";\nimport { setTransformStyle } from \"../../lib/styles\";\nimport { rubber } from \"../../lib/touch\";\nimport { ANDROID, IOS, VKCOM } from \"../../lib/platform\";\nimport { transitionEvent } from \"../../lib/supportEvents\";\nimport { HasPlatform } from \"../../types\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { withContext } from \"../../hoc/withContext\";\nimport ModalRootContext, {\n  ModalRootContextInterface,\n} from \"./ModalRootContext\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  WebviewType,\n} from \"../ConfigProvider/ConfigProviderContext\";\nimport { ModalsStateEntry, ModalType, TranslateRange } from \"./types\";\nimport { MODAL_PAGE_DEFAULT_PERCENT_HEIGHT } from \"./constants\";\nimport { DOMProps, withDOM } from \"../../lib/dom\";\nimport { getNavId } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { ModalTransitionProps, withModalManager } from \"./useModalManager\";\nimport \"./ModalRoot.css\";\n\nconst warn = warnOnce(\"ModalRoot\");\nconst IS_DEV = process.env.NODE_ENV === \"development\";\n\nfunction numberInRange(number: number, range: TranslateRange | undefined) {\n  if (!range) {\n    return false;\n  }\n  return number >= range[0] && number <= range[1];\n}\n\nfunction rangeTranslate(number: number) {\n  return Math.max(0, Math.min(98, number));\n}\n\nexport interface ModalRootProps extends HasPlatform {\n  activeModal?: string | null;\n\n  /**\n   * Будет вызвано при начале открытия активной модалки с её id\n   */\n  onOpen?(modalId: string): void;\n\n  /**\n   * Будет вызвано при окончательном открытии активной модалки с её id\n   */\n  onOpened?(modalId: string): void;\n\n  /**\n   * Будет вызвано при начале закрытия активной модалки с её id\n   */\n  onClose?(modalId: string): void;\n\n  /**\n   * Будет вызвано при окончательном закрытии активной модалки с её id\n   */\n  onClosed?(modalId: string): void;\n\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n}\n\ninterface ModalRootState {\n  touchDown?: boolean;\n  dragging?: boolean;\n}\n\nclass ModalRootTouchComponent extends React.Component<\n  ModalRootProps & DOMProps & ModalTransitionProps,\n  ModalRootState\n> {\n  constructor(props: ModalRootProps & ModalTransitionProps) {\n    super(props);\n    this.state = {\n      touchDown: false,\n      dragging: false,\n    };\n\n    this.maskElementRef = React.createRef();\n\n    this.modalRootContext = {\n      updateModalHeight: this.updateModalHeight,\n      registerModal: ({ id, ...data }) =>\n        Object.assign(this.getModalState(id), data),\n      onClose: () => this.props.onExit(),\n      isInsideModal: true,\n    };\n\n    this.frameIds = {};\n  }\n\n  private documentScrolling = false;\n  private readonly maskElementRef: React.RefObject<HTMLDivElement>;\n  private readonly viewportRef = React.createRef<HTMLDivElement>();\n  private maskAnimationFrame: number | undefined = undefined;\n  private readonly modalRootContext: ModalRootContextInterface;\n  private readonly frameIds: {\n    [index: string]: number;\n  };\n  private restoreFocusTo: HTMLElement | undefined | null = undefined;\n\n  get timeout(): number {\n    return this.props.platform === ANDROID || this.props.platform === VKCOM\n      ? 320\n      : 400;\n  }\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  getModalState(id: string | undefined | null) {\n    if (!id) {\n      return undefined;\n    }\n    return this.props.getModalState(id);\n  }\n\n  getModals() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  componentDidMount() {\n    // Отслеживаем изменение размеров viewport (Необходимо для iOS)\n    if (this.props.platform === IOS) {\n      this.window?.addEventListener(\"resize\", this.updateModalTranslate, false);\n    }\n  }\n\n  componentWillUnmount() {\n    this.toggleDocumentScrolling(true);\n    this.window!.removeEventListener(\n      \"resize\",\n      this.updateModalTranslate,\n      false\n    );\n  }\n\n  componentDidUpdate(prevProps: ModalRootProps & ModalTransitionProps) {\n    // transition phase 2: animate exiting modal\n    if (\n      this.props.exitingModal &&\n      this.props.exitingModal !== prevProps.exitingModal\n    ) {\n      this.closeModal(this.props.exitingModal);\n    }\n\n    // transition phase 3: animate entering modal\n    if (\n      this.props.enteringModal &&\n      this.props.enteringModal !== prevProps.enteringModal\n    ) {\n      const { enteringModal } = this.props;\n      const enteringState = this.getModalState(enteringModal);\n      this.props.onEnter();\n      this.waitTransitionFinish(enteringState, () => {\n        if (enteringState?.innerElement) {\n          enteringState.innerElement.style.transitionDelay = \"\";\n        }\n        this.props.onEntered(enteringModal);\n      });\n\n      if (enteringState?.innerElement) {\n        enteringState.innerElement.style.transitionDelay = this.props.delayEnter\n          ? `${this.timeout}ms`\n          : \"\";\n        this.animateTranslate(enteringState, enteringState.translateY);\n      }\n    }\n\n    // focus restoration\n    if (this.props.activeModal && !prevProps.activeModal) {\n      this.restoreFocusTo = this.document!.activeElement as HTMLElement;\n    }\n    if (\n      !this.props.activeModal &&\n      !this.props.exitingModal &&\n      this.restoreFocusTo\n    ) {\n      this.restoreFocusTo.focus();\n      this.restoreFocusTo = null;\n    }\n\n    this.toggleDocumentScrolling(\n      !this.props.activeModal && !this.props.exitingModal\n    );\n  }\n\n  /* Отключает скролл документа */\n  toggleDocumentScrolling(enabled: boolean) {\n    if (this.documentScrolling === enabled) {\n      return;\n    }\n    this.documentScrolling = enabled;\n\n    if (enabled) {\n      // Здесь нужен последний аргумент с такими же параметрами, потому что\n      // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n      // https://github.com/VKCOM/VKUI/issues/444\n      this.window!.removeEventListener(\"touchmove\", this.preventTouch, {\n        // @ts-ignore (В интерфейсе EventListenerOptions нет поля passive)\n        passive: false,\n      });\n    } else {\n      this.window!.addEventListener(\"touchmove\", this.preventTouch, {\n        passive: false,\n      });\n    }\n  }\n\n  preventTouch = (event: any) => {\n    if (!event) {\n      return false;\n    }\n    while (event.originalEvent) {\n      event = event.originalEvent;\n    }\n    if (event.preventDefault) {\n      event.preventDefault();\n    }\n    return false;\n  };\n\n  updateModalTranslate = () => {\n    const modalState = this.getModalState(this.props.activeModal);\n    modalState && this.animateTranslate(modalState, modalState.translateY);\n  };\n\n  checkPageContentHeight() {\n    const modalState = this.getModalState(this.props.activeModal);\n\n    if (modalState?.type === ModalType.PAGE && modalState?.modalElement) {\n      const prevModalState = { ...modalState };\n      initPageModal(modalState);\n      const currentModalState = { ...modalState };\n\n      let needAnimate = false;\n\n      if (prevModalState.expandable === currentModalState.expandable) {\n        if (\n          prevModalState.translateYFrom !== currentModalState.translateYFrom\n        ) {\n          needAnimate = true;\n        }\n      } else {\n        needAnimate = true;\n      }\n\n      if (needAnimate) {\n        this.animateTranslate(modalState, modalState.translateY);\n      }\n    }\n  }\n\n  updateModalHeight = () => {\n    const modalState = this.getModalState(this.props.activeModal);\n\n    if (\n      modalState &&\n      modalState.type === ModalType.PAGE &&\n      modalState.dynamicContentHeight\n    ) {\n      if (this.props.enteringModal) {\n        this.waitTransitionFinish(modalState, () => {\n          requestAnimationFrame(() => this.checkPageContentHeight());\n        });\n      } else {\n        requestAnimationFrame(() => this.checkPageContentHeight());\n      }\n    }\n  };\n\n  closeModal(id: string) {\n    // Сбрасываем состояния, которые могут помешать закрытию модального окна\n    this.setState({ touchDown: false });\n\n    const prevModalState = this.getModalState(id);\n\n    if (!prevModalState) {\n      id &&\n        warn(\n          `closeActiveModal: модальное окно (страница) ${id} не существует`,\n          \"error\"\n        );\n      return;\n    }\n\n    const nextModalState = this.getModalState(this.props.activeModal);\n    const nextIsPage =\n      !!nextModalState && nextModalState.type === ModalType.PAGE;\n\n    const prevIsPage =\n      !!prevModalState && prevModalState.type === ModalType.PAGE;\n    this.waitTransitionFinish(prevModalState, () => this.props.onExited(id));\n    const exitTranslate =\n      prevIsPage &&\n      nextIsPage &&\n      (prevModalState.translateY ?? 0) <=\n        (nextModalState?.translateYFrom ?? 0) &&\n      !this.props.isBack\n        ? (nextModalState?.translateYFrom ?? 0) + 10\n        : 100;\n    this.animateTranslate(prevModalState, exitTranslate);\n\n    if (!nextModalState) {\n      // NOTE: was only for clean exit\n      this.setMaskOpacity(prevModalState, 0);\n    }\n  }\n\n  onTouchMove = (e: TouchEvent) => {\n    if (this.props.exitingModal) {\n      return;\n    }\n    const modalState = this.getModalState(this.props.activeModal);\n    if (!modalState) {\n      return;\n    }\n\n    if (modalState.type === ModalType.PAGE) {\n      return this.onPageTouchMove(e, modalState);\n    }\n\n    if (modalState.type === ModalType.CARD) {\n      return this.onCardTouchMove(e, modalState);\n    }\n  };\n\n  onPageTouchMove(event: TouchEvent, modalState: ModalsStateEntry) {\n    const { shiftY, originalEvent } = event;\n    const target = originalEvent.target as HTMLElement;\n\n    if (!event.isY) {\n      if (this.viewportRef.current?.contains(target)) {\n        originalEvent.preventDefault();\n      }\n      return;\n    }\n\n    if (!modalState.innerElement?.contains(target)) {\n      return originalEvent.preventDefault();\n    }\n\n    originalEvent.stopPropagation();\n\n    const { expandable, contentScrolled, collapsed, expanded } = modalState;\n\n    if (!this.state.touchDown) {\n      modalState.touchStartContentScrollTop =\n        modalState.contentElement?.scrollTop;\n      this.setState({ touchDown: true });\n    }\n\n    if (contentScrolled) {\n      return;\n    }\n\n    if (modalState.touchMovePositive === null) {\n      modalState.touchMovePositive = shiftY > 0;\n    }\n\n    if (\n      !modalState.expandable ||\n      collapsed ||\n      (expanded &&\n        modalState.touchMovePositive &&\n        modalState.touchStartContentScrollTop === 0) ||\n      modalState.headerElement?.contains(target)\n    ) {\n      originalEvent.preventDefault();\n\n      if ((!expandable && shiftY < 0) || !this.window) {\n        return;\n      }\n\n      !this.state.dragging && this.setState({ dragging: true });\n\n      const shiftYPercent = (shiftY / this.window.innerHeight) * 100;\n      const shiftYCurrent = rubber(\n        shiftYPercent,\n        72,\n        0.8,\n        this.props.platform === ANDROID || this.props.platform === VKCOM\n      );\n\n      modalState.touchShiftYPercent = shiftYPercent;\n      modalState.translateYCurrent = rangeTranslate(\n        (modalState.translateY ?? 0) + shiftYCurrent\n      );\n\n      this.animateTranslate(modalState, modalState.translateYCurrent);\n      this.setMaskOpacity(modalState);\n    }\n  }\n\n  onCardTouchMove(event: TouchEvent, modalState: ModalsStateEntry) {\n    const { originalEvent, shiftY } = event;\n    const target = originalEvent.target as HTMLElement;\n    if (modalState.innerElement?.contains(target)) {\n      if (!this.state.touchDown) {\n        this.setState({ touchDown: true, dragging: true });\n      }\n\n      const shiftYPercent =\n        (shiftY / modalState.innerElement.offsetHeight) * 100;\n      const shiftYCurrent = rubber(\n        shiftYPercent,\n        72,\n        1.2,\n        this.props.platform === ANDROID || this.props.platform === VKCOM\n      );\n\n      modalState.touchShiftYPercent = shiftYPercent;\n      modalState.translateYCurrent = Math.max(\n        0,\n        (modalState.translateY ?? 0) + shiftYCurrent\n      );\n\n      this.animateTranslate(modalState, modalState.translateYCurrent);\n      this.setMaskOpacity(modalState);\n    }\n  }\n\n  onTouchEnd = (e: TouchEvent) => {\n    const modalState = this.getModalState(this.props.activeModal);\n\n    if (modalState?.type === ModalType.PAGE) {\n      return this.onPageTouchEnd(e, modalState);\n    }\n\n    if (modalState?.type === ModalType.CARD) {\n      return this.onCardTouchEnd(e, modalState);\n    }\n  };\n\n  onPageTouchEnd(event: TouchEvent, modalState: ModalsStateEntry) {\n    const { startY, shiftY } = event;\n\n    modalState.contentScrolled = false;\n    modalState.touchMovePositive = null;\n\n    let setStateCallback;\n\n    if (this.state.dragging && this.window) {\n      const shiftYEndPercent =\n        ((startY + shiftY) / this.window.innerHeight) * 100;\n\n      let translateY = modalState.translateYCurrent ?? 0;\n      const expectTranslateY =\n        (translateY / event.duration) *\n        240 *\n        0.6 *\n        ((modalState.touchShiftYPercent ?? 0) < 0 ? -1 : 1);\n      translateY = rangeTranslate(translateY + expectTranslateY);\n\n      if (modalState.settlingHeight !== 100) {\n        if (numberInRange(translateY, modalState.expandedRange)) {\n          translateY = modalState.expandedRange?.[0] ?? 0;\n        } else if (numberInRange(translateY, modalState.collapsedRange)) {\n          translateY = modalState.translateYFrom ?? 0;\n        } else if (numberInRange(translateY, modalState.hiddenRange)) {\n          translateY = 100;\n        } else {\n          translateY = modalState.translateYFrom ?? 0;\n        }\n      } else {\n        if (numberInRange(translateY, [0, 25])) {\n          translateY = 0;\n        } else {\n          translateY = 100;\n        }\n      }\n\n      if (translateY !== 100 && shiftYEndPercent >= 75) {\n        translateY = 100;\n      }\n\n      modalState.translateY = translateY;\n      modalState.translateYCurrent = translateY;\n      modalState.collapsed = translateY > 0 && translateY < shiftYEndPercent;\n      modalState.expanded = translateY === 0;\n      modalState.hidden = translateY === 100;\n\n      if (modalState.hidden) {\n        this.props.onExit();\n      }\n\n      setStateCallback = () => {\n        if (!modalState.hidden) {\n          this.animateTranslate(modalState, modalState.translateY);\n        }\n\n        this.setMaskOpacity(modalState);\n      };\n    }\n\n    this.setState(\n      {\n        touchDown: false,\n        dragging: false,\n      },\n      setStateCallback\n    );\n  }\n\n  onCardTouchEnd({ duration }: TouchEvent, modalState: ModalsStateEntry) {\n    let setStateCallback;\n\n    if (this.state.dragging) {\n      let translateY = modalState.translateYCurrent ?? 0;\n\n      const expectTranslateY =\n        (translateY / duration) *\n        240 *\n        0.6 *\n        ((modalState.touchShiftYPercent ?? 0) < 0 ? -1 : 1);\n      translateY = Math.max(0, translateY + expectTranslateY);\n\n      if (translateY >= 30) {\n        translateY = 100;\n      } else {\n        translateY = 0;\n      }\n\n      modalState.translateY = translateY;\n      modalState.hidden = translateY === 100;\n\n      if (modalState.hidden) {\n        this.props.onExit();\n      }\n\n      setStateCallback = () => {\n        if (!modalState.hidden) {\n          this.animateTranslate(modalState, modalState.translateY);\n        }\n\n        this.setMaskOpacity(modalState);\n      };\n    }\n\n    this.setState(\n      {\n        touchDown: false,\n        dragging: false,\n      },\n      setStateCallback\n    );\n  }\n\n  onScroll = (e: React.SyntheticEvent) => {\n    const activeModal = this.props.activeModal;\n\n    const target = e.target as HTMLElement;\n\n    if (!activeModal) {\n      return;\n    }\n    const modalState = this.getModalState(activeModal);\n    if (\n      modalState?.type === ModalType.PAGE &&\n      modalState?.contentElement?.contains(target)\n    ) {\n      modalState.contentScrolled = true;\n\n      if (modalState.contentScrollStopTimeout) {\n        clearTimeout(modalState.contentScrollStopTimeout);\n      }\n\n      modalState.contentScrollStopTimeout = setTimeout(() => {\n        if (modalState.contentScrolled) {\n          modalState.contentScrolled = false;\n        }\n      }, 250);\n    }\n  };\n\n  waitTransitionFinish(\n    modalState: ModalsStateEntry | undefined,\n    eventHandler: () => void\n  ) {\n    if (transitionEvent.supported) {\n      const onceHandler = () => {\n        modalState?.innerElement?.removeEventListener(\n          transitionEvent.name as string,\n          onceHandler\n        );\n        eventHandler();\n      };\n\n      modalState?.innerElement?.addEventListener(\n        transitionEvent.name as string,\n        onceHandler\n      );\n    } else {\n      setTimeout(eventHandler, this.timeout);\n    }\n  }\n\n  /**\n   * Анимирует сдвиг модалки\n   *\n   * @param {ModalsStateEntry} modalState\n   * @param {number} percent Процент сдвига: 0 – полностью открыта, 100 – полностью закрыта\n   */\n  animateTranslate(modalState: ModalsStateEntry, percent: number | undefined) {\n    const frameId = `animateTranslateFrame${modalState.id}`;\n\n    cancelAnimationFrame(this.frameIds[frameId]);\n\n    this.frameIds[frameId] = requestAnimationFrame(() => {\n      setTransformStyle(\n        modalState.innerElement,\n        `translate3d(0, ${percent}%, 0)`\n      );\n    });\n  }\n\n  /* Устанавливает прозрачность для полупрозрачной подложки */\n  setMaskOpacity(\n    modalState: ModalsStateEntry,\n    forceOpacity: number | null = null\n  ) {\n    if (forceOpacity === null && this.props.history?.[0] !== modalState.id) {\n      return;\n    }\n    if (this.maskAnimationFrame) {\n      cancelAnimationFrame(this.maskAnimationFrame);\n    }\n    this.maskAnimationFrame = requestAnimationFrame(() => {\n      if (this.maskElementRef.current) {\n        const { translateY = 0, translateYCurrent = 0 } = modalState;\n\n        const opacity =\n          forceOpacity === null\n            ? 1 - (translateYCurrent - translateY) / (100 - translateY) || 0\n            : forceOpacity;\n        this.maskElementRef.current.style.opacity = Math.max(\n          0,\n          Math.min(100, opacity)\n        ).toString();\n      }\n    });\n  }\n\n  render() {\n    const { activeModal, exitingModal, enteringModal } = this.props;\n    const { touchDown, dragging } = this.state;\n\n    if (!activeModal && !exitingModal) {\n      return null;\n    }\n\n    return (\n      <TouchRootContext.Provider value={true}>\n        <ModalRootContext.Provider value={this.modalRootContext}>\n          <Touch\n            // eslint-disable-next-line vkui/no-object-expression-in-arguments\n            vkuiClass={classNames(\n              getClassName(\"ModalRoot\", this.props.platform),\n              {\n                \"ModalRoot--vkapps\":\n                  this.props.configProvider?.webviewType === WebviewType.VKAPPS,\n                \"ModalRoot--touched\": touchDown,\n                \"ModalRoot--switching\": !!(enteringModal || exitingModal),\n              }\n            )}\n            onMove={this.onTouchMove}\n            onEnd={this.onTouchEnd}\n            onScroll={this.onScroll}\n          >\n            <div\n              vkuiClass=\"ModalRoot__mask\"\n              onClick={this.props.onExit}\n              ref={this.maskElementRef}\n            />\n            <div vkuiClass=\"ModalRoot__viewport\" ref={this.viewportRef}>\n              {this.getModals().map((Modal) => {\n                const modalId = getNavId(Modal.props, warn);\n                const _modalState = this.getModalState(modalId);\n                if (\n                  (modalId !== activeModal && modalId !== exitingModal) ||\n                  !_modalState\n                ) {\n                  return null;\n                }\n                const modalState = { ..._modalState };\n\n                const isPage = modalState.type === ModalType.PAGE;\n                const key = `modal-${modalId}`;\n\n                return (\n                  <FocusTrap\n                    key={key}\n                    getRootRef={(e) => {\n                      const modalState = this.getModalState(modalId);\n                      if (modalState) {\n                        modalState.modalElement = e;\n                      }\n                    }}\n                    onClose={this.props.onExit}\n                    timeout={this.timeout}\n                    // eslint-disable-next-line vkui/no-object-expression-in-arguments\n                    vkuiClass={classNames(\"ModalRoot__modal\", {\n                      \"ModalRoot__modal--active\": modalId === activeModal,\n                      \"ModalRoot__modal--prev\": modalId === exitingModal,\n                      \"ModalRoot__modal--next\":\n                        (exitingModal && modalId === activeModal) ||\n                        modalId === enteringModal,\n\n                      \"ModalRoot__modal--dragging\": dragging,\n\n                      \"ModalRoot__modal--expandable\":\n                        isPage && modalState.expandable,\n                      \"ModalRoot__modal--expanded\":\n                        isPage && modalState.expanded,\n                      \"ModalRoot__modal--collapsed\":\n                        isPage && modalState.collapsed,\n                    })}\n                    restoreFocus={false}\n                  >\n                    {Modal}\n                  </FocusTrap>\n                );\n              })}\n            </div>\n          </Touch>\n        </ModalRootContext.Provider>\n      </TouchRootContext.Provider>\n    );\n  }\n}\n\nexport const ModalRootTouch = withContext(\n  withPlatform(\n    withDOM<ModalRootProps>(\n      withModalManager(initModal)(ModalRootTouchComponent)\n    )\n  ),\n  ConfigProviderContext,\n  \"configProvider\"\n);\n\n/**\n * Инициализирует модалку перед анимацией открытия\n */\nfunction initModal(modalState: ModalsStateEntry) {\n  switch (modalState.type) {\n    case ModalType.PAGE:\n      modalState.settlingHeight =\n        modalState.settlingHeight || MODAL_PAGE_DEFAULT_PERCENT_HEIGHT;\n      return initPageModal(modalState);\n    case ModalType.CARD:\n      return initCardModal(modalState);\n    default:\n      IS_DEV &&\n        warn(\n          `initActiveModal: modalState.type=\"${modalState.type}\" не поддерживается`,\n          \"error\"\n        );\n  }\n}\n\nfunction initPageModal(modalState: ModalsStateEntry) {\n  const { contentElement } = modalState;\n  const contentHeight = (contentElement?.firstElementChild as HTMLElement)\n    .offsetHeight;\n\n  let prevTranslateY = modalState.translateY;\n\n  modalState.expandable =\n    contentHeight > (contentElement?.clientHeight ?? 0) ||\n    modalState.settlingHeight === 100;\n\n  let collapsed = false;\n  let expanded = false;\n  let translateYFrom;\n  let translateY;\n  let expandedRange: TranslateRange;\n  let collapsedRange: TranslateRange;\n  let hiddenRange: TranslateRange;\n\n  if (modalState.expandable) {\n    translateYFrom = 100 - (modalState.settlingHeight ?? 0);\n\n    const shiftHalf = translateYFrom / 2;\n    const visiblePart = 100 - translateYFrom;\n\n    expandedRange = [0, shiftHalf];\n    collapsedRange = [shiftHalf, translateYFrom + visiblePart / 4];\n    hiddenRange = [translateYFrom + visiblePart / 4, 100];\n\n    collapsed = translateYFrom > 0;\n    expanded = translateYFrom <= 0;\n    translateY = translateYFrom;\n  } else {\n    const headerHeight = modalState.headerElement?.offsetHeight ?? 0;\n    const height = contentHeight + headerHeight;\n\n    translateYFrom =\n      100 -\n      (height / (modalState.innerElement?.parentElement?.offsetHeight ?? 0)) *\n        100;\n    translateY = translateYFrom;\n\n    expandedRange = [translateY, translateY + 25];\n    collapsedRange = [translateY + 25, translateY + 25];\n    hiddenRange = [translateY + 25, translateY + 100];\n  }\n\n  // Если модалка может открываться на весь экран, и новый сдвиг больше предыдущего, то откроем её на весь экран\n  if (\n    (modalState.expandable && translateY > (prevTranslateY ?? 0)) ||\n    modalState.settlingHeight === 100\n  ) {\n    translateY = 0;\n  }\n\n  modalState.expandedRange = expandedRange;\n  modalState.collapsedRange = collapsedRange;\n  modalState.hiddenRange = hiddenRange;\n  modalState.translateY = translateY;\n  modalState.translateYFrom = translateYFrom;\n  modalState.collapsed = collapsed;\n  modalState.expanded = expanded;\n}\n\nfunction initCardModal(modalState: ModalsStateEntry) {\n  modalState.translateY = 0;\n}\n"],"file":"ModalRoot.js"}