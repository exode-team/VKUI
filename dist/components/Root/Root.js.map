{"version":3,"file":"Root.js","names":["React","classNames","IOS","ConfigProviderContext","SplitColContext","AppRootPortal","ScrollContext","NavTransitionProvider","getNavId","warnOnce","useDOM","useIsomorphicLayoutEffect","useTimeout","usePlatform","warn","Root","popout","modal","children","_activeView","activeView","onTransition","nav","restProps","scroll","useContext","platform","document","scrolls","useRef","current","viewNodes","transitionMotionEnabled","animate","disableAnimation","views","Children","toArray","useState","transition","prevView","isBack","_setState","transitionTo","panel","viewIds","map","view","props","indexOf","getScroll","y","finishTransition","useCallback","activeElement","blur","scrollTo","Boolean","from","to","fallbackTransition","useEffect","clear","set","onAnimationEnd","e","includes","animationName","process","env","NODE_ENV","viewId","isTransitionTarget","compensateScroll","undefined","marginTop"],"sources":["../../../src/components/Root/Root.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS } from \"../../lib/platform\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { getNavId, NavIdProps } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport \"./Root.css\";\n\nexport interface RootProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    NavIdProps {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `Alert`, `ActionSheet` и `ScreenSpinner`.\n   */\n  popout?: React.ReactNode;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `ModalRoot`.\n   */\n  modal?: React.ReactNode;\n}\n\nexport interface RootState {\n  activeView: string;\n  transition: boolean;\n  isBack?: boolean;\n  prevView?: string;\n}\n\nconst warn = warnOnce(\"Root\");\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Root\n */\nexport const Root = ({\n  popout = null,\n  modal,\n  children,\n  activeView: _activeView,\n  onTransition,\n  nav,\n  ...restProps\n}: RootProps) => {\n  const scroll = React.useContext(ScrollContext);\n  const platform = usePlatform();\n  const { document } = useDOM();\n  const scrolls = React.useRef<Record<string, number>>({}).current;\n  const viewNodes = React.useRef<Record<string, HTMLElement | null>>(\n    {}\n  ).current;\n\n  const { transitionMotionEnabled = true } = React.useContext(\n    ConfigProviderContext\n  );\n  const { animate } = React.useContext(SplitColContext);\n  const disableAnimation = !transitionMotionEnabled || !animate;\n\n  const views = React.Children.toArray(children) as React.ReactElement[];\n\n  const [{ prevView, activeView, transition, isBack }, _setState] =\n    React.useState<RootState>({\n      activeView: _activeView,\n      transition: false,\n    });\n  const transitionTo = (panel: string) => {\n    if (panel !== activeView) {\n      const viewIds = views.map((view) => getNavId(view.props, warn));\n      const isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: !disableAnimation,\n        isBack,\n      });\n    }\n  };\n  const finishTransition = React.useCallback(\n    () => _setState({ activeView, prevView, isBack, transition: false }),\n    [activeView, isBack, prevView]\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    (document!.activeElement as HTMLElement).blur();\n  }, [!!popout, activeView]);\n\n  // Нужен переход\n  useIsomorphicLayoutEffect(() => transitionTo(_activeView), [_activeView]);\n  useIsomorphicLayoutEffect(() => {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition &&\n        onTransition({\n          isBack: Boolean(isBack),\n          from: prevView,\n          to: activeView,\n        });\n    }\n  }, [transition, prevView]);\n\n  const fallbackTransition = useTimeout(\n    finishTransition,\n    platform === IOS ? 600 : 300\n  );\n  React.useEffect(() => {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n    fallbackTransition.set();\n  }, [fallbackTransition, transition]);\n\n  const onAnimationEnd = (e: React.AnimationEvent) => {\n    if (\n      [\n        \"vkui-root-android-animation-hide-back\",\n        \"vkui-root-android-animation-show-forward\",\n        \"vkui-root-ios-animation-hide-back\",\n        \"vkui-root-ios-animation-show-forward\",\n      ].includes(e.animationName)\n    ) {\n      finishTransition();\n    }\n  };\n\n  if (process.env.NODE_ENV === \"development\") {\n    popout &&\n      warn(\n        \"Свойство popout устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n      );\n    modal &&\n      warn(\n        \"Свойство modal устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.\"\n      );\n  }\n\n  return (\n    <div\n      {...restProps}\n      vkuiClass={classNames(\n        \"Root\",\n        platform === IOS && \"Root--ios\",\n        transition && \"Root--transition\"\n      )}\n    >\n      {views.map((view) => {\n        const viewId = getNavId(view.props, warn);\n        if (viewId !== activeView && !(transition && viewId === prevView)) {\n          return null;\n        }\n        const isTransitionTarget =\n          transition && viewId === (isBack ? prevView : activeView);\n        const compensateScroll =\n          transition &&\n          (viewId === prevView || (isBack && viewId === activeView));\n        return (\n          <div\n            key={viewId}\n            ref={(e) => viewId && (viewNodes[viewId] = e)}\n            onAnimationEnd={isTransitionTarget ? onAnimationEnd : undefined}\n            vkuiClass={classNames(\n              \"Root__view\",\n              transition &&\n                viewId === prevView &&\n                isBack &&\n                \"Root__view--hide-back\",\n              transition &&\n                viewId === prevView &&\n                !isBack &&\n                \"Root__view--hide-forward\",\n              transition &&\n                viewId === activeView &&\n                isBack &&\n                \"Root__view--show-back\",\n              transition &&\n                viewId === activeView &&\n                !isBack &&\n                \"Root__view--show-forward\",\n              !transition && viewId === activeView && \"Root__view--active\"\n            )}\n          >\n            <NavTransitionProvider\n              entering={transition && viewId === activeView}\n            >\n              <div\n                vkuiClass=\"Root__scrollCompensation\"\n                style={{\n                  marginTop: compensateScroll\n                    ? viewId && -(scrolls[viewId] ?? 0)\n                    : undefined,\n                }}\n              >\n                {view}\n              </div>\n            </NavTransitionProvider>\n          </div>\n        );\n      })}\n      <AppRootPortal>\n        {!!popout && <div vkuiClass=\"Root__popout\">{popout}</div>}\n        {!!modal && <div vkuiClass=\"Root__modal\">{modal}</div>}\n      </AppRootPortal>\n    </div>\n  );\n};\n"],"mappings":"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"}