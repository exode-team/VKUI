{"version":3,"file":"WriteBar.js","names":["React","Headline","usePlatform","useExternRef","hasReactNode","isFunction","classNames","IOS","WriteBar","className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange","shadow","restProps","platform","isControlledOutside","textareaRef","currentScrollHeight","useRef","resize","useCallback","textareaEl","current","offsetParent","height","scrollHeight","onTextareaChange","event","useEffect"],"sources":["../../../src/components/WriteBar/WriteBar.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Headline } from \"../Typography/Headline/Headline\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { hasReactNode, isFunction } from \"../../lib/utils\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS } from \"../../lib/platform\";\nimport { HasRef, HasRootRef } from \"../../types\";\nimport \"./WriteBar.css\";\n\nexport interface WriteBarProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слева от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n  /**\n   * Добавляет тень вокруг поля ввода\n   */\n  shadow?: boolean;\n\n  children?: never;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport const WriteBar = ({\n  className,\n  style,\n  before,\n  inlineAfter,\n  after,\n  value,\n  onChange,\n  getRootRef,\n  getRef,\n  onHeightChange,\n  shadow = false,\n  ...restProps\n}: WriteBarProps) => {\n  const platform = usePlatform();\n\n  const isControlledOutside = value != null;\n\n  const textareaRef = useExternRef(getRef);\n  const currentScrollHeight = React.useRef<number>();\n\n  const resize = React.useCallback(() => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = \"\";\n      textareaEl.style.height = `${textareaEl.scrollHeight}px`;\n\n      if (\n        textareaEl.scrollHeight !== currentScrollHeight.current &&\n        onHeightChange\n      ) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n\n  const onTextareaChange: React.ChangeEventHandler<HTMLTextAreaElement> = (\n    event\n  ) => {\n    if (isFunction(onChange)) {\n      onChange(event);\n    }\n\n    if (!isControlledOutside) {\n      resize();\n    }\n  };\n\n  React.useEffect(() => {\n    resize();\n  }, [resize, value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      vkuiClass={classNames(\n        \"WriteBar\",\n        platform === IOS && \"WriteBar--ios\",\n        shadow && \"WriteBar--shadow\"\n      )}\n      className={className}\n      style={style}\n    >\n      <div vkuiClass=\"WriteBar__form\">\n        {hasReactNode(before) && (\n          <div vkuiClass=\"WriteBar__before\">{before}</div>\n        )}\n\n        <div vkuiClass=\"WriteBar__formIn\">\n          <Headline\n            {...restProps}\n            Component=\"textarea\"\n            vkuiClass=\"WriteBar__textarea\"\n            onChange={onTextareaChange}\n            getRootRef={textareaRef}\n            value={value}\n          />\n          {hasReactNode(inlineAfter) && (\n            <div vkuiClass=\"WriteBar__inlineAfter\">{inlineAfter}</div>\n          )}\n        </div>\n\n        {hasReactNode(after) && <div vkuiClass=\"WriteBar__after\">{after}</div>}\n      </div>\n    </div>\n  );\n};\n"],"mappings":";;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,SAASC,QAAQ;AACjB,SAASC,WAAW;AACpB,SAASC,YAAY;AACrB,SAASC,YAAY,EAAEC,UAAU;AACjC,SAASC,UAAU;AACnB,SAASC,GAAG;AAgCZ;AACA;AACA;AACA,OAAO,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,OAaA;EAAA,IAZnBC,SAAS,QAATA,SAAS;IACTC,KAAK,QAALA,KAAK;IACLC,MAAM,QAANA,MAAM;IACNC,WAAW,QAAXA,WAAW;IACXC,KAAK,QAALA,KAAK;IACLC,KAAK,QAALA,KAAK;IACLC,QAAQ,QAARA,QAAQ;IACRC,UAAU,QAAVA,UAAU;IACVC,MAAM,QAANA,MAAM;IACNC,cAAc,QAAdA,cAAc;IAAA,mBACdC,MAAM;IAANA,MAAM,4BAAG,KAAK;IACXC,SAAS;EAEZ,IAAMC,QAAQ,GAAGnB,WAAW,EAAE;EAE9B,IAAMoB,mBAAmB,GAAGR,KAAK,IAAI,IAAI;EAEzC,IAAMS,WAAW,GAAGpB,YAAY,CAACc,MAAM,CAAC;EACxC,IAAMO,mBAAmB,GAAGxB,KAAK,CAACyB,MAAM,EAAU;EAElD,IAAMC,MAAM,GAAG1B,KAAK,CAAC2B,WAAW,CAAC,YAAM;IACrC,IAAMC,UAAU,GAAGL,WAAW,CAACM,OAAO;IACtC,IAAI,CAACD,UAAU,EAAE;MACf;IACF;IAEA,IAAIA,UAAU,CAACE,YAAY,EAAE;MAC3BF,UAAU,CAAClB,KAAK,CAACqB,MAAM,GAAG,EAAE;MAC5BH,UAAU,CAAClB,KAAK,CAACqB,MAAM,aAAMH,UAAU,CAACI,YAAY,OAAI;MAExD,IACEJ,UAAU,CAACI,YAAY,KAAKR,mBAAmB,CAACK,OAAO,IACvDX,cAAc,EACd;QACAA,cAAc,EAAE;QAChBM,mBAAmB,CAACK,OAAO,GAAGD,UAAU,CAACI,YAAY;MACvD;IACF;EACF,CAAC,EAAE,CAACd,cAAc,EAAEK,WAAW,CAAC,CAAC;EAEjC,IAAMU,gBAA+D,GAAG,SAAlEA,gBAA+D,CACnEC,KAAK,EACF;IACH,IAAI7B,UAAU,CAACU,QAAQ,CAAC,EAAE;MACxBA,QAAQ,CAACmB,KAAK,CAAC;IACjB;IAEA,IAAI,CAACZ,mBAAmB,EAAE;MACxBI,MAAM,EAAE;IACV;EACF,CAAC;EAED1B,KAAK,CAACmC,SAAS,CAAC,YAAM;IACpBT,MAAM,EAAE;EACV,CAAC,EAAE,CAACA,MAAM,EAAEZ,KAAK,CAAC,CAAC;EAEnB,OACE;IACE,GAAG,EAAEE,UAAW;IAChB,SAAS,EAAEV,UAAU,CACnB,UAAU,EACVe,QAAQ,KAAKd,GAAG,IAAI,eAAe,EACnCY,MAAM,IAAI,kBAAkB,CAC5B;IACF,SAAS,EAAEV,SAAU;IACrB,KAAK,EAAEC;EAAM,GAEb;IAAK,SAAS,EAAC;EAAgB,GAC5BN,YAAY,CAACO,MAAM,CAAC,IACnB;IAAK,SAAS,EAAC;EAAkB,GAAEA,MAAM,CAC1C,EAED;IAAK,SAAS,EAAC;EAAkB,GAC/B,oBAAC,QAAQ,eACHS,SAAS;IACb,SAAS,EAAC,UAAU;IACpB,SAAS,EAAC,oBAAoB;IAC9B,QAAQ,EAAEa,gBAAiB;IAC3B,UAAU,EAAEV,WAAY;IACxB,KAAK,EAAET;EAAM,GACb,EACDV,YAAY,CAACQ,WAAW,CAAC,IACxB;IAAK,SAAS,EAAC;EAAuB,GAAEA,WAAW,CACpD,CACG,EAELR,YAAY,CAACS,KAAK,CAAC,IAAI;IAAK,SAAS,EAAC;EAAiB,GAAEA,KAAK,CAAO,CAClE,CACF;AAEV,CAAC"}