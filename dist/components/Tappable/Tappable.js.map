{"version":3,"file":"Tappable.js","names":["React","mitt","noop","Touch","TouchRootContext","classNames","IOS","ANDROID","getOffsetRect","coordX","coordY","withAdaptivity","shouldTriggerClickOnEnterOrSpace","useIsomorphicLayoutEffect","FocusVisible","useTimeout","useExternRef","usePlatform","useFocusVisible","callMultiple","useBooleanState","WAVE_LIVE","ACTIVE_DELAY","ACTIVE_EFFECT_DELAY","activeBus","TapState","none","pending","active","exiting","TappableContext","createContext","onHoverChange","useActivity","hasActive","stopDelay","id","useMemo","Math","round","random","toString","useState","activity","setActivity","_stop","start","delayStart","activeTimeout","stopTimeout","set","clear","emit","onActiveChange","activeId","on","off","stop","delay","TappableComponent","children","Component","onClick","_onKeyDown","onKeyDown","activeEffectDelay","stopPropagation","getRootRef","sizeX","hasMouse","deviceHasHover","hasHover","_hasHover","hoverMode","_hasActive","activeMode","focusVisibleMode","onEnter","onLeave","props","href","useContext","insideTouchRoot","platform","focusVisible","onBlur","onFocus","clicks","setClicks","childHover","setChildHover","_hovered","value","setHoveredTrue","setTrue","setHoveredFalse","setFalse","hovered","disabled","isCustomElement","contentEditable","isPresetHoverMode","includes","isPresetActiveMode","isPresetFocusVisibleMode","containerRef","childContext","useRef","current","e","preventDefault","click","needWaves","clearClicks","addClick","x","y","dateNow","Date","now","filteredClicks","filter","onStart","originalEvent","touches","length","top","left","onMove","isSlide","onEnd","duration","activeDuration","classes","handlers","role","undefined","map","wave","Tappable","displayName"],"sources":["../../../src/components/Tappable/Tappable.tsx"],"sourcesContent":["import * as React from \"react\";\nimport mitt from \"mitt\";\nimport { noop } from \"../../lib/utils\";\nimport { Touch, TouchEvent, TouchProps } from \"../Touch/Touch\";\nimport TouchRootContext from \"../Touch/TouchContext\";\nimport { classNames } from \"../../lib/classNames\";\nimport { IOS, ANDROID } from \"../../lib/platform\";\nimport { getOffsetRect } from \"../../lib/offset\";\nimport { coordX, coordY } from \"../../lib/touch\";\nimport { HasComponent, HasRootRef } from \"../../types\";\nimport { withAdaptivity, AdaptivityProps } from \"../../hoc/withAdaptivity\";\nimport { shouldTriggerClickOnEnterOrSpace } from \"../../lib/accessibility\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { FocusVisible, FocusVisibleMode } from \"../FocusVisible/FocusVisible\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useFocusVisible } from \"../../hooks/useFocusVisible\";\nimport { callMultiple } from \"../../lib/callMultiple\";\nimport { useBooleanState } from \"../../hooks/useBooleanState\";\nimport \"./Tappable.css\";\n\nconst WAVE_LIVE = 225;\n\nexport type TappableElementProps = Omit<\n  React.AllHTMLAttributes<HTMLElement>,\n  | \"onTouchStart\"\n  | \"onTouchMove\"\n  | \"onTouchEnd\"\n  | \"onTouchCancel\"\n  | \"onMouseDown\"\n  | \"onMouseMove\"\n  | \"onMouseUp\"\n  | \"onMouseLeave\"\n>;\n\nexport interface TappableProps\n  extends TappableElementProps,\n    HasRootRef<HTMLElement>,\n    AdaptivityProps,\n    HasComponent,\n    Pick<TouchProps, \"onStart\" | \"onEnd\" | \"onMove\"> {\n  /**\n   * Длительность показа active-состояния\n   */\n  activeEffectDelay?: number;\n  stopPropagation?: boolean;\n  /**\n   * Указывает, должен ли компонент реагировать на hover-состояние\n   */\n  hasHover?: boolean;\n  /**\n   * Указывает, должен ли компонент реагировать на active-состояние\n   */\n  hasActive?: boolean;\n  /**\n   * Стиль подсветки active-состояния. Если передать произвольную строку, она добавится как css-класс во время active\n   */\n  activeMode?: \"opacity\" | \"background\" | string;\n  /**\n   * Стиль подсветки hover-состояния. Если передать произвольную строку, она добавится как css-класс во время hover\n   */\n  hoverMode?: \"opacity\" | \"background\" | string;\n  /**\n   * Стиль аутлайна focus visible. Если передать произвольную строку, она добавится как css-класс во время focus-visible\n   */\n  focusVisibleMode?: FocusVisibleMode | string;\n  children?: React.ReactNode;\n  onEnter?(outputEvent: MouseEvent): void;\n  onLeave?(outputEvent: MouseEvent): void;\n}\n\ninterface Wave {\n  x: number;\n  y: number;\n  id: number;\n}\n\nexport interface RootComponentProps extends TouchProps {\n  ref?: React.Ref<HTMLElement>;\n}\n\nexport const ACTIVE_DELAY = 70;\nexport const ACTIVE_EFFECT_DELAY = 600;\n\nconst activeBus = mitt<{ active: string }>();\nconst TapState = { none: 0, pending: 1, active: 2, exiting: 3 } as const;\n\ntype TappableContextInterface = { onHoverChange: (s: boolean) => void };\nconst TappableContext = React.createContext<TappableContextInterface>({\n  onHoverChange: noop,\n});\n\nfunction useActivity(hasActive: boolean, stopDelay: number) {\n  const id = React.useMemo(\n    () => Math.round(Math.random() * 1e8).toString(16),\n    []\n  );\n\n  const [activity, setActivity] = React.useState<\n    typeof TapState[keyof typeof TapState]\n  >(TapState.none);\n  const _stop = () => setActivity(TapState.none);\n  const start = () => hasActive && setActivity(TapState.active);\n  const delayStart = () => {\n    hasActive && setActivity(TapState.pending);\n  };\n\n  const activeTimeout = useTimeout(start, ACTIVE_DELAY);\n  const stopTimeout = useTimeout(_stop, stopDelay);\n\n  useIsomorphicLayoutEffect(() => {\n    if (activity === TapState.pending) {\n      activeTimeout.set();\n      return activeTimeout.clear;\n    }\n    if (activity === TapState.exiting) {\n      return stopTimeout.clear;\n    }\n    if (activity === TapState.active) {\n      activeBus.emit(\"active\", id);\n    }\n    return noop;\n  }, [activity]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (activity === TapState.none) {\n      return noop;\n    }\n    const onActiveChange = (activeId: string) => {\n      activeId !== id && _stop();\n    };\n    activeBus.on(\"active\", onActiveChange);\n    return () => activeBus.off(\"active\", onActiveChange);\n  }, [activity === TapState.none]);\n\n  useIsomorphicLayoutEffect(() => {\n    !hasActive && _stop();\n  }, [hasActive]);\n\n  const stop = (delay?: number) => {\n    if (delay) {\n      setActivity(TapState.exiting);\n      return stopTimeout.set(delay);\n    }\n    _stop();\n  };\n\n  return [activity, { delayStart, start, stop }] as const;\n}\n\nconst TappableComponent = ({\n  children,\n  Component,\n  onClick,\n  onKeyDown: _onKeyDown,\n  activeEffectDelay = ACTIVE_EFFECT_DELAY,\n  stopPropagation = false,\n  getRootRef,\n  sizeX,\n  hasMouse,\n  deviceHasHover,\n  hasHover: _hasHover = true,\n  hoverMode = \"background\",\n  hasActive: _hasActive = true,\n  activeMode = \"background\",\n  focusVisibleMode = \"inside\",\n  onEnter,\n  onLeave,\n  ...props\n}: TappableProps) => {\n  Component = Component || ((props.href ? \"a\" : \"div\") as React.ElementType);\n\n  const { onHoverChange } = React.useContext(TappableContext);\n  const insideTouchRoot = React.useContext(TouchRootContext);\n  const platform = usePlatform();\n  const { focusVisible, onBlur, onFocus } = useFocusVisible();\n\n  const [clicks, setClicks] = React.useState<Wave[]>([]);\n  const [childHover, setChildHover] = React.useState(false);\n  const {\n    value: _hovered,\n    setTrue: setHoveredTrue,\n    setFalse: setHoveredFalse,\n  } = useBooleanState(false);\n\n  const hovered = _hovered && !props.disabled;\n  const hasActive = _hasActive && !childHover && !props.disabled;\n  const hasHover = deviceHasHover && _hasHover && !childHover;\n  const isCustomElement =\n    Component !== \"a\" &&\n    Component !== \"button\" &&\n    Component !== \"label\" &&\n    !props.contentEditable;\n  const isPresetHoverMode = [\"opacity\", \"background\"].includes(hoverMode);\n  const isPresetActiveMode = [\"opacity\", \"background\"].includes(activeMode);\n  const isPresetFocusVisibleMode = [\"inside\", \"outside\"].includes(\n    focusVisibleMode\n  );\n\n  const [activity, { start, stop, delayStart }] = useActivity(\n    hasActive,\n    activeEffectDelay\n  );\n  const active = activity === TapState.active || activity === TapState.exiting;\n\n  const containerRef = useExternRef(getRootRef);\n\n  // hover propagation\n  const childContext = React.useRef({ onHoverChange: setChildHover }).current;\n  useIsomorphicLayoutEffect(() => {\n    if (!hovered) {\n      return noop;\n    }\n    onHoverChange(true);\n    return () => onHoverChange(false);\n  }, [hovered]);\n\n  /*\n   * [a11y]\n   * Обрабатывает событие onkeydown\n   * для кастомных доступных элементов:\n   * - role=\"link\" (активация по Enter)\n   * - role=\"button\" (активация по Space и Enter)\n   */\n  function onKeyDown(e: React.KeyboardEvent<HTMLElement>) {\n    if (isCustomElement && shouldTriggerClickOnEnterOrSpace(e)) {\n      e.preventDefault();\n      containerRef.current?.click();\n    }\n  }\n\n  const needWaves =\n    platform === ANDROID &&\n    !hasMouse &&\n    hasActive &&\n    activeMode === \"background\";\n\n  const clearClicks = useTimeout(() => setClicks([]), WAVE_LIVE);\n\n  function addClick(x: number, y: number) {\n    const dateNow = Date.now();\n    const filteredClicks = clicks.filter(\n      (click) => click.id + WAVE_LIVE > dateNow\n    );\n\n    setClicks([...filteredClicks, { x, y, id: dateNow }]);\n    clearClicks.set();\n  }\n\n  function onStart({ originalEvent }: TouchEvent) {\n    if (hasActive) {\n      if (originalEvent.touches && originalEvent.touches.length > 1) {\n        // r сожалению я так и не понял, что это делает и можно ли упихнуть его в Touch\n        return stop();\n      }\n\n      if (needWaves) {\n        const { top, left } = getOffsetRect(containerRef.current);\n        const x = coordX(originalEvent) - (left ?? 0);\n        const y = coordY(originalEvent) - (top ?? 0);\n        addClick(x, y);\n      }\n\n      delayStart();\n    }\n  }\n\n  function onMove({ isSlide }: TouchEvent) {\n    if (isSlide) {\n      stop();\n    }\n  }\n\n  function onEnd({ duration }: TouchEvent) {\n    if (activity === TapState.none) {\n      return;\n    }\n    if (activity === TapState.pending) {\n      // активировать при коротком тапе\n      start();\n    }\n\n    // отключить без задержки при длинном тапе\n    const activeDuration = duration - ACTIVE_DELAY;\n    stop(activeDuration >= 100 ? 0 : activeEffectDelay - activeDuration);\n  }\n\n  const classes = classNames(\n    \"Tappable\",\n    platform === IOS && \"Tappable--ios\",\n    `Tappable--sizeX-${sizeX}`,\n    hasHover && `Tappable--hasHover`,\n    hasActive && `Tappable--hasActive`,\n    hasHover && hovered && !isPresetHoverMode && hoverMode,\n    hasActive && active && !isPresetActiveMode && activeMode,\n    focusVisible && !isPresetFocusVisibleMode && focusVisibleMode,\n    hasActive && active && \"Tappable--active\",\n    hasMouse && \"Tappable--mouse\",\n    hasHover && hovered && isPresetHoverMode && `Tappable--hover-${hoverMode}`,\n    hasActive &&\n      active &&\n      isPresetActiveMode &&\n      `Tappable--active-${activeMode}`,\n    focusVisible && \"Tappable--focus-visible\"\n  );\n\n  const handlers: RootComponentProps = {\n    onStart: callMultiple(onStart, props.onStart),\n    onMove: callMultiple(onMove, props.onMove),\n    onEnd: callMultiple(onEnd, props.onEnd),\n    onClick,\n    onKeyDown: callMultiple(onKeyDown, _onKeyDown),\n  };\n  const role = props.href ? \"link\" : \"button\";\n\n  return (\n    <Touch\n      onEnter={callMultiple(setHoveredTrue, onEnter)}\n      onLeave={callMultiple(setHoveredFalse, onLeave)}\n      type={Component === \"button\" ? \"button\" : undefined}\n      tabIndex={isCustomElement && !props.disabled ? 0 : undefined}\n      role={isCustomElement ? role : undefined}\n      aria-disabled={isCustomElement ? props.disabled : undefined}\n      stopPropagation={stopPropagation && !insideTouchRoot && !props.disabled}\n      {...props}\n      slideThreshold={20}\n      usePointerHover\n      vkuiClass={classes}\n      Component={Component}\n      getRootRef={containerRef}\n      onBlur={callMultiple(onBlur, props.onBlur)}\n      onFocus={callMultiple(onFocus, props.onFocus)}\n      {...(props.disabled ? {} : handlers)}\n    >\n      <TappableContext.Provider value={childContext}>\n        {children}\n      </TappableContext.Provider>\n      {needWaves && (\n        <span aria-hidden=\"true\" vkuiClass=\"Tappable__waves\">\n          {clicks.map((wave) => (\n            <span\n              key={wave.id}\n              vkuiClass=\"Tappable__wave\"\n              style={{ top: wave.y, left: wave.x }}\n            />\n          ))}\n        </span>\n      )}\n      {hasHover && hoverMode === \"background\" && (\n        <span aria-hidden=\"true\" vkuiClass=\"Tappable__hoverShadow\" />\n      )}\n      {!props.disabled && isPresetFocusVisibleMode && (\n        <FocusVisible mode={focusVisibleMode as FocusVisibleMode} />\n      )}\n    </Touch>\n  );\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Tappable\n */\nexport const Tappable = withAdaptivity(TappableComponent, {\n  sizeX: true,\n  hasMouse: true,\n  deviceHasHover: true,\n});\n\nTappable.displayName = \"Tappable\";\n"],"mappings":"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"}