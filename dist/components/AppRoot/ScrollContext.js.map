{"version":3,"sources":["../../../src/components/AppRoot/ScrollContext.tsx"],"names":["React","noop","useIsomorphicLayoutEffect","clamp","useDOM","useAdaptivityIsDesktop","clearDisableScrollStyle","node","Object","assign","style","position","top","left","right","overflowY","overflowX","getPageYOffsetWithoutKeyboardHeight","window","diffOfClientHeightAndViewportHeight","document","documentElement","clientHeight","innerHeight","pageYOffset","ScrollContext","createContext","getScroll","x","y","scrollTo","isScrollLock","enableScrollLock","disableScrollLock","useScroll","useContext","GlobalScrollController","children","useState","setScrollLock","beforeScrollLockFnSetRef","useRef","Set","useCallback","pageXOffset","body","scrollWidth","innerWidth","scrollHeight","current","forEach","fn","scrollY","scrollX","clientWidth","parseInt","scrollController","useMemo","ElementScrollController","elRef","scrollLeft","scrollTop","el","useScrollLockEffect","effect","deps","destructorRef","effectCallback","useEffect","beforeSet","add","delete","useScrollLock","enabled","isDesktop"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,IAAT;AACA,SAASC,yBAAT;AACA,SAASC,KAAT;AACA,SAASC,MAAT;AACA,SAASC,sBAAT;;AAEA,IAAMC,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACC,IAAD,EAAuB;AACrDC,EAAAA,MAAM,CAACC,MAAP,CAAcF,IAAI,CAACG,KAAnB,EAA0B;AACxBC,IAAAA,QAAQ,EAAE,EADc;AAExBC,IAAAA,GAAG,EAAE,EAFmB;AAGxBC,IAAAA,IAAI,EAAE,EAHkB;AAIxBC,IAAAA,KAAK,EAAE,EAJiB;AAKxBC,IAAAA,SAAS,EAAE,EALa;AAMxBC,IAAAA,SAAS,EAAE;AANa,GAA1B;AAQD,CATD;;AAWA,IAAMC,mCAAmC,GAAG,SAAtCA,mCAAsC,CAACC,MAAD,EAAoB;AAC9D;AACA;AACA;AACA,MAAMC,mCAAmC,GACvCD,MAAM,CAACE,QAAP,CAAgBC,eAAhB,CAAgCC,YAAhC,GAA+CJ,MAAM,CAACK,WADxD;AAEA,SAAOL,MAAM,CAACM,WAAP,GAAqBL,mCAA5B;AACD,CAPD;;AAkBA,OAAO,IAAMM,aAAa,gBAAGzB,KAAK,CAAC0B,aAAN,CAA4C;AACvEC,EAAAA,SAAS,EAAE;AAAA,WAAO;AAAEC,MAAAA,CAAC,EAAE,CAAL;AAAQC,MAAAA,CAAC,EAAE;AAAX,KAAP;AAAA,GAD4D;AAEvEC,EAAAA,QAAQ,EAAE7B,IAF6D;AAGvE8B,EAAAA,YAAY,EAAE,KAHyD;AAIvEC,EAAAA,gBAAgB,EAAE/B,IAJqD;AAKvEgC,EAAAA,iBAAiB,EAAEhC;AALoD,CAA5C,CAAtB;AAQP,OAAO,IAAMiC,SAAS,GAAG,SAAZA,SAAY;AAAA,SAAMlC,KAAK,CAACmC,UAAN,CAAiBV,aAAjB,CAAN;AAAA,CAAlB;AAOP,OAAO,IAAMW,sBAAsB,GAAG,SAAzBA,sBAAyB,OAAyC;AAAA,MAAtCC,QAAsC,QAAtCA,QAAsC;;AAC7E,gBAA6BjC,MAAM,EAAnC;AAAA,MAAQc,MAAR,WAAQA,MAAR;AAAA,MAAgBE,QAAhB,WAAgBA,QAAhB;;AACA,wBAAsCpB,KAAK,CAACsC,QAAN,CAAe,KAAf,CAAtC;AAAA;AAAA,MAAOP,YAAP;AAAA,MAAqBQ,aAArB;;AACA,MAAMC,wBAAwB,GAAGxC,KAAK,CAACyC,MAAN,CAA8B,IAAIC,GAAJ,EAA9B,CAAjC;AAEA,MAAMf,SAAS,GAAG3B,KAAK,CAAC2C,WAAN,CAChB;AAAA,WAAO;AACLf,MAAAA,CAAC,EAAEV,MAAM,CAAE0B,WADN;AAELf,MAAAA,CAAC,EAAEZ,mCAAmC,CAACC,MAAD;AAFjC,KAAP;AAAA,GADgB,EAKhB,CAACA,MAAD,CALgB,CAAlB;AAOA,MAAMY,QAAQ,GAAG9B,KAAK,CAAC2C,WAAN,CACf,YAAkB;AAAA,QAAjBf,CAAiB,uEAAb,CAAa;AAAA,QAAVC,CAAU,uEAAN,CAAM;AAChB;AACAX,IAAAA,MAAM,CAAEY,QAAR,CACEF,CAAC,GAAGzB,KAAK,CAACyB,CAAD,EAAI,CAAJ,EAAOR,QAAQ,CAAEyB,IAAV,CAAeC,WAAf,GAA6B5B,MAAM,CAAE6B,UAA5C,CAAR,GAAkE,CADrE,EAEElB,CAAC,GAAG1B,KAAK,CAAC0B,CAAD,EAAI,CAAJ,EAAOT,QAAQ,CAAEyB,IAAV,CAAeG,YAAf,GAA8B9B,MAAM,CAAEK,WAA7C,CAAR,GAAoE,CAFvE;AAID,GAPc,EAQf,CAACH,QAAD,EAAWF,MAAX,CARe,CAAjB;AAWA,MAAMc,gBAAgB,GAAGhC,KAAK,CAAC2C,WAAN,CAEvB,YAAM;AACNH,IAAAA,wBAAwB,CAACS,OAAzB,CAAiCC,OAAjC,CAAyC,UAACC,EAAD,EAAQ;AAC/CA,MAAAA,EAAE;AACH,KAFD;AAIA,QAAMC,OAAO,GAAGlC,MAAM,CAAEM,WAAxB;AACA,QAAM6B,OAAO,GAAGnC,MAAM,CAAE0B,WAAxB;AACA,QAAM7B,SAAS,GACbG,MAAM,CAAE6B,UAAR,GAAqB3B,QAAQ,CAAEC,eAAV,CAA0BiC,WAA/C,GACI,QADJ,GAEI,EAHN;AAIA,QAAMtC,SAAS,GACbE,MAAM,CAAEK,WAAR,GAAsBH,QAAQ,CAAEC,eAAV,CAA0BC,YAAhD,GACI,QADJ,GAEI,EAHN;AAKAd,IAAAA,MAAM,CAACC,MAAP,CAAcW,QAAQ,CAAEyB,IAAV,CAAenC,KAA7B,EAAoC;AAClCC,MAAAA,QAAQ,EAAE,OADwB;AAElCC,MAAAA,GAAG,aAAMwC,OAAN,OAF+B;AAGlCvC,MAAAA,IAAI,aAAMwC,OAAN,OAH8B;AAIlCvC,MAAAA,KAAK,EAAE,GAJ2B;AAKlCC,MAAAA,SAAS,EAATA,SALkC;AAMlCC,MAAAA,SAAS,EAATA;AANkC,KAApC;AAQAuB,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GA3BwB,EA2BtB,CAACnB,QAAD,EAAWF,MAAX,CA3BsB,CAAzB;AA6BA,MAAMe,iBAAiB,GAAGjC,KAAK,CAAC2C,WAAN,CAExB,YAAM;AACN,QAAMS,OAAO,GAAGhC,QAAQ,CAAEyB,IAAV,CAAenC,KAAf,CAAqBE,GAArC;AACA,QAAMyC,OAAO,GAAGjC,QAAQ,CAAEyB,IAAV,CAAenC,KAAf,CAAqBG,IAArC;AAEAP,IAAAA,uBAAuB,CAACc,QAAQ,CAAEyB,IAAX,CAAvB;AACA3B,IAAAA,MAAM,CAAEY,QAAR,CAAiB,CAACyB,QAAQ,CAACF,OAAO,IAAI,GAAZ,CAA1B,EAA4C,CAACE,QAAQ,CAACH,OAAO,IAAI,GAAZ,CAArD;AACAb,IAAAA,aAAa,CAAC,KAAD,CAAb;AACD,GATyB,EASvB,CAACnB,QAAD,EAAWF,MAAX,CATuB,CAA1B;AAWA,MAAMsC,gBAAgB,GAAGxD,KAAK,CAACyD,OAAN,CACvB;AAAA,WAAO;AACL9B,MAAAA,SAAS,EAATA,SADK;AAELG,MAAAA,QAAQ,EAARA,QAFK;AAGLC,MAAAA,YAAY,EAAZA,YAHK;AAILE,MAAAA,iBAAiB,EAAjBA,iBAJK;AAKLD,MAAAA,gBAAgB,EAAhBA,gBALK;AAOLQ,MAAAA,wBAAwB,EAAEA;AAPrB,KAAP;AAAA,GADuB,EAUvB,CAACb,SAAD,EAAYG,QAAZ,EAAsBC,YAAtB,EAAoCE,iBAApC,EAAuDD,gBAAvD,CAVuB,CAAzB;AAaA,SACE,oBAAC,aAAD,CAAe,QAAf;AAAwB,IAAA,KAAK,EAAEwB;AAA/B,KACGnB,QADH,CADF;AAKD,CAjFM;AAmFP,OAAO,IAAMqB,uBAAuB,GAAG,SAA1BA,uBAA0B,QAGV;AAAA,MAF3BC,KAE2B,SAF3BA,KAE2B;AAAA,MAD3BtB,QAC2B,SAD3BA,QAC2B;;AAC3B,yBAAsCrC,KAAK,CAACsC,QAAN,CAAe,KAAf,CAAtC;AAAA;AAAA,MAAOP,YAAP;AAAA,MAAqBQ,aAArB;;AACA,MAAMC,wBAAwB,GAAGxC,KAAK,CAACyC,MAAN,CAA8B,IAAIC,GAAJ,EAA9B,CAAjC;AAEA,MAAMf,SAAS,GAAG3B,KAAK,CAAC2C,WAAN,CAChB;AAAA;;AAAA,WAAO;AACLf,MAAAA,CAAC,6CAAE+B,KAAK,CAACV,OAAR,mDAAE,eAAeW,UAAjB,yEAA+B,CAD3B;AAEL/B,MAAAA,CAAC,+CAAE8B,KAAK,CAACV,OAAR,oDAAE,gBAAeY,SAAjB,2EAA8B;AAF1B,KAAP;AAAA,GADgB,EAKhB,CAACF,KAAD,CALgB,CAAlB;AAOA,MAAM7B,QAAQ,GAAG9B,KAAK,CAAC2C,WAAN,CACf,YAAkB;AAAA,QAAjBf,CAAiB,uEAAb,CAAa;AAAA,QAAVC,CAAU,uEAAN,CAAM;AAChB,QAAMiC,EAAE,GAAGH,KAAK,CAACV,OAAjB,CADgB,CAEhB;;AACAa,IAAAA,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAEhC,QAAJ,CACEF,CAAC,GAAGzB,KAAK,CAACyB,CAAD,EAAI,CAAJ,EAAOkC,EAAE,CAAChB,WAAH,GAAiBgB,EAAE,CAACR,WAA3B,CAAR,GAAkD,CADrD,EAEEzB,CAAC,GAAG1B,KAAK,CAAC0B,CAAD,EAAI,CAAJ,EAAOiC,EAAE,CAACd,YAAH,GAAkBc,EAAE,CAACxC,YAA5B,CAAR,GAAoD,CAFvD;AAID,GARc,EASf,CAACqC,KAAD,CATe,CAAjB;AAYA,MAAM3B,gBAAgB,GAAGhC,KAAK,CAAC2C,WAAN,CAEvB,YAAM;AACN,QAAMmB,EAAE,GAAGH,KAAK,CAACV,OAAjB;;AACA,QAAI,CAACa,EAAL,EAAS;AACP;AACD;;AACDtB,IAAAA,wBAAwB,CAACS,OAAzB,CAAiCC,OAAjC,CAAyC,UAACC,EAAD,EAAQ;AAC/CA,MAAAA,EAAE;AACH,KAFD;AAIA,QAAMC,OAAO,GAAGU,EAAE,CAACD,SAAnB;AACA,QAAMR,OAAO,GAAGS,EAAE,CAACF,UAAnB;AACA,QAAM7C,SAAS,GAAG+C,EAAE,CAAChB,WAAH,GAAiBgB,EAAE,CAACR,WAApB,GAAkC,QAAlC,GAA6C,EAA/D;AACA,QAAMtC,SAAS,GAAG8C,EAAE,CAACd,YAAH,GAAkBc,EAAE,CAACxC,YAArB,GAAoC,QAApC,GAA+C,EAAjE;AAEAd,IAAAA,MAAM,CAACC,MAAP,CAAcqD,EAAE,CAACpD,KAAjB,EAAwB;AACtBC,MAAAA,QAAQ,EAAE,UADY;AAEtBC,MAAAA,GAAG,aAAMwC,OAAN,OAFmB;AAGtBvC,MAAAA,IAAI,aAAMwC,OAAN,OAHkB;AAItBvC,MAAAA,KAAK,EAAE,GAJe;AAKtBC,MAAAA,SAAS,EAATA,SALsB;AAMtBC,MAAAA,SAAS,EAATA;AANsB,KAAxB;AAQAuB,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GAzBwB,EAyBtB,CAACoB,KAAD,CAzBsB,CAAzB;AA2BA,MAAM1B,iBAAiB,GAAGjC,KAAK,CAAC2C,WAAN,CAExB,YAAM;AACN,QAAMmB,EAAE,GAAGH,KAAK,CAACV,OAAjB;;AACA,QAAI,CAACa,EAAL,EAAS;AACP;AACD;;AAED,QAAMV,OAAO,GAAGU,EAAE,CAACpD,KAAH,CAASE,GAAzB;AACA,QAAMyC,OAAO,GAAGS,EAAE,CAACpD,KAAH,CAASG,IAAzB;AAEAP,IAAAA,uBAAuB,CAACwD,EAAD,CAAvB;AACAA,IAAAA,EAAE,CAAChC,QAAH,CAAY,CAACyB,QAAQ,CAACF,OAAO,IAAI,GAAZ,CAArB,EAAuC,CAACE,QAAQ,CAACH,OAAO,IAAI,GAAZ,CAAhD;AACAb,IAAAA,aAAa,CAAC,KAAD,CAAb;AACD,GAdyB,EAcvB,CAACoB,KAAD,CAduB,CAA1B;AAgBA,MAAMH,gBAAgB,GAAGxD,KAAK,CAACyD,OAAN,CACvB;AAAA,WAAO;AACL9B,MAAAA,SAAS,EAATA,SADK;AAELG,MAAAA,QAAQ,EAARA,QAFK;AAGLC,MAAAA,YAAY,EAAZA,YAHK;AAILE,MAAAA,iBAAiB,EAAjBA,iBAJK;AAKLD,MAAAA,gBAAgB,EAAhBA,gBALK;AAMLQ,MAAAA,wBAAwB,EAAxBA;AANK,KAAP;AAAA,GADuB,EASvB,CAACb,SAAD,EAAYG,QAAZ,EAAsBC,YAAtB,EAAoCE,iBAApC,EAAuDD,gBAAvD,CATuB,CAAzB;AAYA,SACE,oBAAC,aAAD,CAAe,QAAf;AAAwB,IAAA,KAAK,EAAEwB;AAA/B,KACGnB,QADH,CADF;AAKD,CAtFM;AAwFP;AACA;AACA;AACA;AACA;;AACA,OAAO,IAAM0B,mBAAmB,GAAG,SAAtBA,mBAAsB,CACjCC,MADiC,EAEjCC,IAFiC,EAG9B;AACH,MAAMC,aAAa,GAAGlE,KAAK,CAACyC,MAAN,CAA+CxC,IAA/C,CAAtB;;AACA,mBAAmDiC,SAAS,EAA5D;AAAA,MAAQH,YAAR,cAAQA,YAAR;AAAA,MAAsBS,wBAAtB,cAAsBA,wBAAtB,CAFG,CAIH;;;AACA,MAAM2B,cAAc,GAAGnE,KAAK,CAAC2C,WAAN,CAAkB,YAAM;AAC7CuB,IAAAA,aAAa,CAACjB,OAAd,GAAwBe,MAAM,EAA9B,CAD6C,CAE7C;AACD,GAHsB,EAGpBC,IAHoB,CAAvB,CALG,CAUH;AACA;;AACAjE,EAAAA,KAAK,CAACoE,SAAN,CAAgB,YAAM;AACpB,QAAMC,SAAS,GAAG7B,wBAAH,aAAGA,wBAAH,uBAAGA,wBAAwB,CAAES,OAA5C;;AACA,QAAI,CAACoB,SAAL,EAAgB;AACd,aAAOpE,IAAP;AACD;;AAEDoE,IAAAA,SAAS,CAACC,GAAV,CAAcH,cAAd;AAEA,WAAO,YAAM;AACXE,MAAAA,SAAS,CAACE,MAAV,CAAiBJ,cAAjB;AACD,KAFD;AAGD,GAXD,EAWG,CAAC3B,wBAAD,EAA2B2B,cAA3B,CAXH,EAZG,CAyBH;;AACAnE,EAAAA,KAAK,CAACoE,SAAN,CAAgB,YAAM;AACpB,QAAI,CAACrC,YAAD,IAAiBmC,aAAa,CAACjB,OAAnC,EAA4C;AAC1CiB,MAAAA,aAAa,CAACjB,OAAd;AACD;AACF,GAJD,EAIG,CAAClB,YAAD,CAJH;AAKD,CAlCM;AAoCP,OAAO,IAAMyC,aAAa,GAAG,SAAhBA,aAAgB,GAAoB;AAAA,MAAnBC,OAAmB,uEAAT,IAAS;;AAC/C,oBAAgDvC,SAAS,EAAzD;AAAA,MAAQF,gBAAR,eAAQA,gBAAR;AAAA,MAA0BC,iBAA1B,eAA0BA,iBAA1B;;AACA,MAAMyC,SAAS,GAAGrE,sBAAsB,EAAxC;AAEAoE,EAAAA,OAAO,GAAG,CAACC,SAAD,GAAaD,OAAb,GAAuB,KAAjC;AAEAvE,EAAAA,yBAAyB,CAAC,YAAM;AAC9B,QAAIuE,OAAJ,EAAa;AACXzC,MAAAA,gBAAgB;AAChB,aAAOC,iBAAP;AACD;;AACD,WAAOhC,IAAP;AACD,GANwB,EAMtB,CAAC+B,gBAAD,EAAmBC,iBAAnB,EAAsCwC,OAAtC,CANsB,CAAzB;AAOD,CAbM","sourcesContent":["import * as React from \"react\";\nimport { noop } from \"../../lib/utils\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { clamp } from \"../../helpers/math\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useAdaptivityIsDesktop } from \"../../hooks/useAdaptivity\";\n\nconst clearDisableScrollStyle = (node: HTMLElement) => {\n  Object.assign(node.style, {\n    position: \"\",\n    top: \"\",\n    left: \"\",\n    right: \"\",\n    overflowY: \"\",\n    overflowX: \"\",\n  });\n};\n\nconst getPageYOffsetWithoutKeyboardHeight = (window: Window) => {\n  // Note: здесь расчёт на то, что `clientHeight` равен `window.innerHeight`.\n  //  Это достигается тем, что тегу `html` задали`height: 100%` и у него нет отступов сверху и снизу. Если есть отступы,\n  //  то надо задать `box-sizing: border-box`, чтобы они не учитывались.\n  const diffOfClientHeightAndViewportHeight =\n    window.document.documentElement.clientHeight - window.innerHeight;\n  return window.pageYOffset - diffOfClientHeightAndViewportHeight;\n};\n\nexport interface ScrollContextInterface {\n  getScroll(this: void): { x: number; y: number };\n  scrollTo(this: void, x?: number, y?: number): void;\n  isScrollLock: boolean;\n  enableScrollLock(this: void): void;\n  disableScrollLock(this: void): void;\n  beforeScrollLockFnSetRef?: React.RefObject<Set<() => void>>;\n}\n\nexport const ScrollContext = React.createContext<ScrollContextInterface>({\n  getScroll: () => ({ x: 0, y: 0 }),\n  scrollTo: noop,\n  isScrollLock: false,\n  enableScrollLock: noop,\n  disableScrollLock: noop,\n});\n\nexport const useScroll = () => React.useContext(ScrollContext);\n\nexport interface ScrollControllerProps {\n  elRef: React.RefObject<HTMLElement>;\n  children?: React.ReactNode;\n}\n\nexport const GlobalScrollController = ({ children }: ScrollControllerProps) => {\n  const { window, document } = useDOM();\n  const [isScrollLock, setScrollLock] = React.useState(false);\n  const beforeScrollLockFnSetRef = React.useRef<Set<() => void>>(new Set());\n\n  const getScroll = React.useCallback<ScrollContextInterface[\"getScroll\"]>(\n    () => ({\n      x: window!.pageXOffset,\n      y: getPageYOffsetWithoutKeyboardHeight(window!),\n    }),\n    [window]\n  );\n  const scrollTo = React.useCallback<ScrollContextInterface[\"scrollTo\"]>(\n    (x = 0, y = 0) => {\n      // Some iOS versions do not normalize scroll — do it manually.\n      window!.scrollTo(\n        x ? clamp(x, 0, document!.body.scrollWidth - window!.innerWidth) : 0,\n        y ? clamp(y, 0, document!.body.scrollHeight - window!.innerHeight) : 0\n      );\n    },\n    [document, window]\n  );\n\n  const enableScrollLock = React.useCallback<\n    ScrollContextInterface[\"enableScrollLock\"]\n  >(() => {\n    beforeScrollLockFnSetRef.current.forEach((fn) => {\n      fn();\n    });\n\n    const scrollY = window!.pageYOffset;\n    const scrollX = window!.pageXOffset;\n    const overflowY =\n      window!.innerWidth > document!.documentElement.clientWidth\n        ? \"scroll\"\n        : \"\";\n    const overflowX =\n      window!.innerHeight > document!.documentElement.clientHeight\n        ? \"scroll\"\n        : \"\";\n\n    Object.assign(document!.body.style, {\n      position: \"fixed\",\n      top: `-${scrollY}px`,\n      left: `-${scrollX}px`,\n      right: \"0\",\n      overflowY,\n      overflowX,\n    });\n    setScrollLock(true);\n  }, [document, window]);\n\n  const disableScrollLock = React.useCallback<\n    ScrollContextInterface[\"disableScrollLock\"]\n  >(() => {\n    const scrollY = document!.body.style.top;\n    const scrollX = document!.body.style.left;\n\n    clearDisableScrollStyle(document!.body);\n    window!.scrollTo(-parseInt(scrollX || \"0\"), -parseInt(scrollY || \"0\"));\n    setScrollLock(false);\n  }, [document, window]);\n\n  const scrollController = React.useMemo<ScrollContextInterface>(\n    () => ({\n      getScroll,\n      scrollTo,\n      isScrollLock,\n      disableScrollLock,\n      enableScrollLock,\n\n      beforeScrollLockFnSetRef: beforeScrollLockFnSetRef,\n    }),\n    [getScroll, scrollTo, isScrollLock, disableScrollLock, enableScrollLock]\n  );\n\n  return (\n    <ScrollContext.Provider value={scrollController}>\n      {children}\n    </ScrollContext.Provider>\n  );\n};\n\nexport const ElementScrollController = ({\n  elRef,\n  children,\n}: ScrollControllerProps) => {\n  const [isScrollLock, setScrollLock] = React.useState(false);\n  const beforeScrollLockFnSetRef = React.useRef<Set<() => void>>(new Set());\n\n  const getScroll = React.useCallback<ScrollContextInterface[\"getScroll\"]>(\n    () => ({\n      x: elRef.current?.scrollLeft ?? 0,\n      y: elRef.current?.scrollTop ?? 0,\n    }),\n    [elRef]\n  );\n  const scrollTo = React.useCallback<ScrollContextInterface[\"scrollTo\"]>(\n    (x = 0, y = 0) => {\n      const el = elRef.current;\n      // Some iOS versions do not normalize scroll — do it manually.\n      el?.scrollTo(\n        x ? clamp(x, 0, el.scrollWidth - el.clientWidth) : 0,\n        y ? clamp(y, 0, el.scrollHeight - el.clientHeight) : 0\n      );\n    },\n    [elRef]\n  );\n\n  const enableScrollLock = React.useCallback<\n    ScrollContextInterface[\"enableScrollLock\"]\n  >(() => {\n    const el = elRef.current;\n    if (!el) {\n      return;\n    }\n    beforeScrollLockFnSetRef.current.forEach((fn) => {\n      fn();\n    });\n\n    const scrollY = el.scrollTop;\n    const scrollX = el.scrollLeft;\n    const overflowY = el.scrollWidth > el.clientWidth ? \"scroll\" : \"\";\n    const overflowX = el.scrollHeight > el.clientHeight ? \"scroll\" : \"\";\n\n    Object.assign(el.style, {\n      position: \"absolute\",\n      top: `-${scrollY}px`,\n      left: `-${scrollX}px`,\n      right: \"0\",\n      overflowY,\n      overflowX,\n    });\n    setScrollLock(true);\n  }, [elRef]);\n\n  const disableScrollLock = React.useCallback<\n    ScrollContextInterface[\"disableScrollLock\"]\n  >(() => {\n    const el = elRef.current;\n    if (!el) {\n      return;\n    }\n\n    const scrollY = el.style.top;\n    const scrollX = el.style.left;\n\n    clearDisableScrollStyle(el);\n    el.scrollTo(-parseInt(scrollX || \"0\"), -parseInt(scrollY || \"0\"));\n    setScrollLock(false);\n  }, [elRef]);\n\n  const scrollController = React.useMemo<ScrollContextInterface>(\n    () => ({\n      getScroll,\n      scrollTo,\n      isScrollLock,\n      disableScrollLock,\n      enableScrollLock,\n      beforeScrollLockFnSetRef,\n    }),\n    [getScroll, scrollTo, isScrollLock, disableScrollLock, enableScrollLock]\n  );\n\n  return (\n    <ScrollContext.Provider value={scrollController}>\n      {children}\n    </ScrollContext.Provider>\n  );\n};\n\n/**\n * Вызывает функцию effect, до блокировки прокрутки\n * @param effect функция, которая может возвращать функцию очистки\n * @param deps effect обновится только при изменении значений в списке.\n */\nexport const useScrollLockEffect = (\n  effect: React.EffectCallback,\n  deps: React.DependencyList\n) => {\n  const destructorRef = React.useRef<ReturnType<React.EffectCallback>>(noop);\n  const { isScrollLock, beforeScrollLockFnSetRef } = useScroll();\n\n  // Изменяем effectCallback только при изменении deps\n  const effectCallback = React.useCallback(() => {\n    destructorRef.current = effect();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps);\n\n  // Добавляем effectCallback в список функций, которые необходимо вызвать\n  // до блокировки\n  React.useEffect(() => {\n    const beforeSet = beforeScrollLockFnSetRef?.current;\n    if (!beforeSet) {\n      return noop;\n    }\n\n    beforeSet.add(effectCallback);\n\n    return () => {\n      beforeSet.delete(effectCallback);\n    };\n  }, [beforeScrollLockFnSetRef, effectCallback]);\n\n  // Вызываем сбрасывающую функцию, после отключения блокировки\n  React.useEffect(() => {\n    if (!isScrollLock && destructorRef.current) {\n      destructorRef.current();\n    }\n  }, [isScrollLock]);\n};\n\nexport const useScrollLock = (enabled = true) => {\n  const { enableScrollLock, disableScrollLock } = useScroll();\n  const isDesktop = useAdaptivityIsDesktop();\n\n  enabled = !isDesktop ? enabled : false;\n\n  useIsomorphicLayoutEffect(() => {\n    if (enabled) {\n      enableScrollLock();\n      return disableScrollLock;\n    }\n    return noop;\n  }, [enableScrollLock, disableScrollLock, enabled]);\n};\n"],"file":"ScrollContext.js"}