{"version":3,"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"names":["React","useDOM","classNames","AppRootContext","withAdaptivity","SizeType","useIsomorphicLayoutEffect","classScopingMode","IconSettingsProvider","ElementScrollController","GlobalScrollController","noop","warnOnce","useKeyboardInputTracker","useInsets","ConfigProviderContext","isRefObject","warn","AppRoot","children","_mode","mode","_embedded","embedded","sizeX","hasMouse","noLegacyClasses","scroll","portalRoot","portalRootProp","disablePortal","props","isKeyboardInputActive","rootRef","useRef","useState","setPortalRoot","document","insets","useContext","appearance","noConflict","process","env","NODE_ENV","portal","current","createElement","classList","add","body","appendChild","parentElement","removeChild","parent","classes","concat","remove","documentElement","undefined","key","hasOwnProperty","inset","style","setProperty","removeProperty","REGULAR","container","ScrollController","useMemo","content","appRoot","keyboardInput","displayName"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport {\n  withAdaptivity,\n  SizeType,\n  AdaptivityProps,\n} from \"../../hoc/withAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { classScopingMode } from \"../../lib/classScopingMode\";\nimport { IconSettingsProvider } from \"@vkontakte/icons\";\nimport {\n  ElementScrollController,\n  GlobalScrollController,\n} from \"./ScrollContext\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useKeyboardInputTracker } from \"../../hooks/useKeyboardInputTracker\";\nimport { useInsets } from \"../../hooks/useInsets\";\nimport { Insets } from \"@vkontakte/vk-bridge\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { isRefObject } from \"../../lib/isRefObject\";\nimport \"./AppRoot.css\";\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    Pick<AdaptivityProps, \"sizeX\" | \"hasMouse\"> {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: \"partial\" | \"embedded\" | \"full\";\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: \"global\" | \"contain\";\n  /** Элемент используемый в качестве root для порталов\n   * При передаче своего элемента необходимо задать ему class=\"vkui__portal-root\" и добавить в DOM\n   */\n  // TODO: v5.0.0 изменить тип на HTMLElement\n  portalRoot?: HTMLDivElement | React.RefObject<HTMLDivElement> | null;\n  /** Disable portal for components */\n  disablePortal?: boolean;\n}\n\nconst warn = warnOnce(\"AppRoot\");\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AppRoot\n */\nexport const AppRoot = withAdaptivity<AppRootProps>(\n  ({\n    children,\n    mode: _mode,\n    embedded: _embedded,\n    sizeX,\n    hasMouse,\n    noLegacyClasses = false,\n    scroll = \"global\",\n    portalRoot: portalRootProp = null,\n    disablePortal,\n    ...props\n  }) => {\n    // normalize mode\n    const mode = _mode || (_embedded ? \"embedded\" : \"full\");\n    const isKeyboardInputActive = useKeyboardInputTracker();\n    const rootRef = React.useRef<HTMLDivElement | null>(null);\n    const [portalRoot, setPortalRoot] = React.useState<HTMLDivElement | null>(\n      null\n    );\n    const { document } = useDOM();\n    const insets = useInsets();\n    const { appearance } = React.useContext(ConfigProviderContext);\n\n    classScopingMode.noConflict = noLegacyClasses;\n\n    if (process.env.NODE_ENV === \"development\") {\n      if (scroll !== \"global\" && mode !== \"embedded\") {\n        warn(\n          `Свойство scroll=\"${scroll}\" поддерживается только в режиме embedded`,\n          \"error\"\n        );\n      }\n      if (_mode && _embedded) {\n        warn(`Свойство mode=\"${mode}\" приоритетнее, чем \"embedded\"`);\n      }\n    }\n\n    // setup portal\n    useIsomorphicLayoutEffect(() => {\n      let portal: HTMLDivElement | null = null;\n      if (portalRootProp) {\n        if (isRefObject(portalRootProp)) {\n          portal = portalRootProp.current;\n        } else {\n          portal = portalRootProp;\n        }\n      }\n      if (!portal) {\n        portal = document!.createElement(\"div\");\n        portal.classList.add(\"vkui__portal-root\");\n        document!.body.appendChild(portal);\n      }\n      setPortalRoot(portal);\n      return () => {\n        portal?.parentElement?.removeChild(portal);\n      };\n    }, [portalRootProp]);\n\n    // setup root classes\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\") {\n        return noop;\n      }\n\n      const parent = rootRef.current?.parentElement;\n      const classes = [\"vkui__root\"].concat(\n        mode === \"embedded\" ? \"vkui__root--embedded\" : []\n      );\n      parent?.classList.add(...classes);\n\n      return () => {\n        parent?.classList.remove(...classes);\n      };\n    }, []);\n\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"full\") {\n        document!.documentElement.classList.add(\"vkui\");\n\n        return () => {\n          document!.documentElement.classList.remove(\"vkui\");\n        };\n      }\n\n      return undefined;\n    }, [document, mode]);\n\n    // setup insets\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\" || !rootRef.current?.parentElement) {\n        return noop;\n      }\n\n      const parent = rootRef.current.parentElement;\n\n      for (const key in insets) {\n        if (\n          insets.hasOwnProperty(key) &&\n          typeof insets[key as keyof Insets] === \"number\"\n        ) {\n          const inset = insets[key as keyof Insets];\n          parent.style.setProperty(`--safe-area-inset-${key}`, `${inset}px`);\n          portalRoot &&\n            portalRoot.style.setProperty(\n              `--safe-area-inset-${key}`,\n              `${inset}px`\n            );\n        }\n      }\n\n      return () => {\n        for (const key in insets) {\n          if (insets.hasOwnProperty(key)) {\n            parent.style.removeProperty(`--safe-area-inset-${key}`);\n            portalRoot &&\n              portalRoot.style.removeProperty(`--safe-area-inset-${key}`);\n          }\n        }\n      };\n    }, [insets, portalRoot]);\n\n    // adaptivity handler\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\" || sizeX !== SizeType.REGULAR) {\n        return noop;\n      }\n      const container =\n        mode === \"embedded\" ? rootRef.current?.parentElement : document!.body;\n      container?.classList.add(\"vkui--sizeX-regular\");\n      return () => container?.classList.remove(\"vkui--sizeX-regular\");\n    }, [sizeX]);\n\n    useIsomorphicLayoutEffect(() => {\n      if (mode !== \"full\" || appearance === undefined) {\n        return noop;\n      }\n      document!.documentElement.style.setProperty(\"color-scheme\", appearance);\n\n      return () =>\n        document!.documentElement.style.removeProperty(\"color-scheme\");\n    }, [appearance]);\n\n    const ScrollController = React.useMemo(\n      () =>\n        scroll === \"contain\" ? ElementScrollController : GlobalScrollController,\n      [scroll]\n    );\n\n    const content = (\n      <AppRootContext.Provider\n        value={{\n          appRoot: rootRef,\n          portalRoot,\n          embedded: mode === \"embedded\",\n          keyboardInput: isKeyboardInputActive,\n          mode,\n          disablePortal,\n        }}\n      >\n        <ScrollController elRef={rootRef}>\n          <IconSettingsProvider\n            classPrefix=\"vkui\"\n            globalClasses={!noLegacyClasses}\n          >\n            {children}\n          </IconSettingsProvider>\n        </ScrollController>\n      </AppRootContext.Provider>\n    );\n\n    return mode === \"partial\" ? (\n      content\n    ) : (\n      <div\n        ref={rootRef}\n        // eslint-disable-next-line vkui/no-object-expression-in-arguments\n        vkuiClass={classNames(\"AppRoot\", {\n          \"AppRoot--no-mouse\": !hasMouse,\n        })}\n        {...props}\n      >\n        {content}\n      </div>\n    );\n  },\n  {\n    sizeX: true,\n    hasMouse: true,\n  }\n);\n\nAppRoot.displayName = \"AppRoot\";\n"],"file":"AppRoot.js"}