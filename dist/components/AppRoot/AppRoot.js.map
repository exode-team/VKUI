{"version":3,"file":"AppRoot.js","names":["React","useDOM","classNames","AppRootContext","withAdaptivity","SizeType","useIsomorphicLayoutEffect","classScopingMode","IconSettingsProvider","ElementScrollController","GlobalScrollController","noop","warnOnce","useKeyboardInputTracker","useInsets","ConfigProviderContext","isRefObject","warn","AppRoot","children","_mode","mode","_embedded","embedded","sizeX","hasMouse","noLegacyClasses","scroll","portalRoot","portalRootProp","disablePortal","props","isKeyboardInputActive","rootRef","useRef","useState","setPortalRoot","document","insets","useContext","appearance","noConflict","process","env","NODE_ENV","portal","current","createElement","classList","add","body","appendChild","parentElement","removeChild","parent","classes","concat","remove","documentElement","undefined","key","hasOwnProperty","inset","style","setProperty","removeProperty","REGULAR","container","ScrollController","useMemo","content","appRoot","keyboardInput","displayName"],"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport {\n  withAdaptivity,\n  SizeType,\n  AdaptivityProps,\n} from \"../../hoc/withAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { classScopingMode } from \"../../lib/classScopingMode\";\nimport { IconSettingsProvider } from \"@vkontakte/icons\";\nimport {\n  ElementScrollController,\n  GlobalScrollController,\n} from \"./ScrollContext\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useKeyboardInputTracker } from \"../../hooks/useKeyboardInputTracker\";\nimport { useInsets } from \"../../hooks/useInsets\";\nimport { Insets } from \"@vkontakte/vk-bridge\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { isRefObject } from \"../../lib/isRefObject\";\nimport \"./AppRoot.css\";\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    Pick<AdaptivityProps, \"sizeX\" | \"hasMouse\"> {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: \"partial\" | \"embedded\" | \"full\";\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: \"global\" | \"contain\";\n  /** Элемент используемый в качестве root для порталов\n   * При передаче своего элемента необходимо задать ему class=\"vkui__portal-root\" и добавить в DOM\n   */\n  // TODO: v5.0.0 изменить тип на HTMLElement\n  portalRoot?: HTMLDivElement | React.RefObject<HTMLDivElement> | null;\n  /** Disable portal for components */\n  disablePortal?: boolean;\n}\n\nconst warn = warnOnce(\"AppRoot\");\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AppRoot\n */\nexport const AppRoot = withAdaptivity<AppRootProps>(\n  ({\n    children,\n    mode: _mode,\n    embedded: _embedded,\n    sizeX,\n    hasMouse,\n    noLegacyClasses = false,\n    scroll = \"global\",\n    portalRoot: portalRootProp = null,\n    disablePortal,\n    ...props\n  }) => {\n    // normalize mode\n    const mode = _mode || (_embedded ? \"embedded\" : \"full\");\n    const isKeyboardInputActive = useKeyboardInputTracker();\n    const rootRef = React.useRef<HTMLDivElement | null>(null);\n    const [portalRoot, setPortalRoot] = React.useState<HTMLDivElement | null>(\n      null\n    );\n    const { document } = useDOM();\n    const insets = useInsets();\n    const { appearance } = React.useContext(ConfigProviderContext);\n\n    classScopingMode.noConflict = noLegacyClasses;\n\n    if (process.env.NODE_ENV === \"development\") {\n      if (scroll !== \"global\" && mode !== \"embedded\") {\n        warn(\n          `Свойство scroll=\"${scroll}\" поддерживается только в режиме embedded`,\n          \"error\"\n        );\n      }\n      if (_mode && _embedded) {\n        warn(`Свойство mode=\"${mode}\" приоритетнее, чем \"embedded\"`);\n      }\n    }\n\n    // setup portal\n    useIsomorphicLayoutEffect(() => {\n      let portal: HTMLDivElement | null = null;\n      if (portalRootProp) {\n        if (isRefObject(portalRootProp)) {\n          portal = portalRootProp.current;\n        } else {\n          portal = portalRootProp;\n        }\n      }\n      if (!portal) {\n        portal = document!.createElement(\"div\");\n        portal.classList.add(\"vkui__portal-root\");\n        document!.body.appendChild(portal);\n      }\n      setPortalRoot(portal);\n      return () => {\n        portal?.parentElement?.removeChild(portal);\n      };\n    }, [portalRootProp]);\n\n    // setup root classes\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\") {\n        return noop;\n      }\n\n      const parent = rootRef.current?.parentElement;\n      const classes = [\"vkui__root\"].concat(\n        mode === \"embedded\" ? \"vkui__root--embedded\" : []\n      );\n      parent?.classList.add(...classes);\n\n      return () => {\n        parent?.classList.remove(...classes);\n      };\n    }, []);\n\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"full\") {\n        document!.documentElement.classList.add(\"vkui\");\n\n        return () => {\n          document!.documentElement.classList.remove(\"vkui\");\n        };\n      }\n\n      return undefined;\n    }, [document, mode]);\n\n    // setup insets\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\" || !rootRef.current?.parentElement) {\n        return noop;\n      }\n\n      const parent = rootRef.current.parentElement;\n\n      for (const key in insets) {\n        if (\n          insets.hasOwnProperty(key) &&\n          typeof insets[key as keyof Insets] === \"number\"\n        ) {\n          const inset = insets[key as keyof Insets];\n          parent.style.setProperty(`--safe-area-inset-${key}`, `${inset}px`);\n          portalRoot &&\n            portalRoot.style.setProperty(\n              `--safe-area-inset-${key}`,\n              `${inset}px`\n            );\n        }\n      }\n\n      return () => {\n        for (const key in insets) {\n          if (insets.hasOwnProperty(key)) {\n            parent.style.removeProperty(`--safe-area-inset-${key}`);\n            portalRoot &&\n              portalRoot.style.removeProperty(`--safe-area-inset-${key}`);\n          }\n        }\n      };\n    }, [insets, portalRoot]);\n\n    // adaptivity handler\n    useIsomorphicLayoutEffect(() => {\n      if (mode === \"partial\" || sizeX !== SizeType.REGULAR) {\n        return noop;\n      }\n      const container =\n        mode === \"embedded\" ? rootRef.current?.parentElement : document!.body;\n      container?.classList.add(\"vkui--sizeX-regular\");\n      return () => container?.classList.remove(\"vkui--sizeX-regular\");\n    }, [sizeX]);\n\n    useIsomorphicLayoutEffect(() => {\n      if (mode !== \"full\" || appearance === undefined) {\n        return noop;\n      }\n      document!.documentElement.style.setProperty(\"color-scheme\", appearance);\n\n      return () =>\n        document!.documentElement.style.removeProperty(\"color-scheme\");\n    }, [appearance]);\n\n    const ScrollController = React.useMemo(\n      () =>\n        scroll === \"contain\" ? ElementScrollController : GlobalScrollController,\n      [scroll]\n    );\n\n    const content = (\n      <AppRootContext.Provider\n        value={{\n          appRoot: rootRef,\n          portalRoot,\n          embedded: mode === \"embedded\",\n          keyboardInput: isKeyboardInputActive,\n          mode,\n          disablePortal,\n        }}\n      >\n        <ScrollController elRef={rootRef}>\n          <IconSettingsProvider\n            classPrefix=\"vkui\"\n            globalClasses={!noLegacyClasses}\n          >\n            {children}\n          </IconSettingsProvider>\n        </ScrollController>\n      </AppRootContext.Provider>\n    );\n\n    return mode === \"partial\" ? (\n      content\n    ) : (\n      <div\n        ref={rootRef}\n        vkuiClass={classNames(\"AppRoot\", !hasMouse && \"AppRoot--no-mouse\")}\n        {...props}\n      >\n        {content}\n      </div>\n    );\n  },\n  {\n    sizeX: true,\n    hasMouse: true,\n  }\n);\n\nAppRoot.displayName = \"AppRoot\";\n"],"mappings":"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"}